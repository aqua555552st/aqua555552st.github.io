<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>1.AOP基本介绍</title>
      <link href="/2024/02/17/AOP%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/"/>
      <url>/2024/02/17/AOP%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="AOP基本介绍"><a href="#AOP基本介绍" class="headerlink" title="AOP基本介绍"></a>AOP基本介绍</h1><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><p><strong>AOP为Aspect Oriented Programming的缩写，意为：面向切面编程，通过预编译方式和运行期动态代理实现程序功能的统一维护的一种技术。</strong></p><p>AOP是OOP的延续，是软件开发中的一个热点，也是Spring框架中的一个重要内容，是函数式编程的一种衍生范型。利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</p><h3 id="简易说明图"><a href="#简易说明图" class="headerlink" title="简易说明图"></a>简易说明图</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240119095619347.png" alt=""  /><h3 id="详细说明图"><a href="#详细说明图" class="headerlink" title="详细说明图"></a>详细说明图</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240119101750746.png"></p><p><strong>核心<code>aspect包</code>下的切面类的<u>声明通知方法</u>：</strong></p><ol><li><strong>前置通知：@Before</strong></li><li><strong>返回通知：@AfterReturning</strong></li><li><strong>异常通知：@AfterThrowin</strong></li><li><strong>后置通知：@After</strong></li><li><strong>环绕通知：@Around</strong></li></ol><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240119103515843.png"></p><hr><h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/B6126605C99A298F2A0ABE3D63804C87.png"></p><blockquote><p><strong>参考下图，完成代码</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240119103515843.png" alt="" style="zoom:50%;" /></blockquote><p><strong>导入AOP编程需要的包：</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240119150423693.png" alt="" style="zoom: 67%;" /><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240119150444496.png" alt="" style="zoom:67%;" /><p>SmartAnimalable接口</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aspectj</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SmartAnimalable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">float</span> <span class="token function">getSum</span><span class="token punctuation">(</span><span class="token keyword">float</span> i<span class="token punctuation">,</span> <span class="token keyword">float</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">float</span> <span class="token function">getSub</span><span class="token punctuation">(</span><span class="token keyword">float</span> i<span class="token punctuation">,</span> <span class="token keyword">float</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>SmartDog类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aspectj</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmartDog</span> <span class="token keyword">implements</span> <span class="token class-name">SmartAnimalable</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">getSum</span><span class="token punctuation">(</span><span class="token keyword">float</span> i<span class="token punctuation">,</span> <span class="token keyword">float</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">float</span> result <span class="token operator">=</span> i <span class="token operator">+</span> j<span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"方法内部打印result = "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">getSub</span><span class="token punctuation">(</span><span class="token keyword">float</span> i<span class="token punctuation">,</span> <span class="token keyword">float</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">float</span> result <span class="token operator">=</span> i <span class="token operator">-</span> j<span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"方法内部打印result = "</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> result<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>SmartAnimalAspect类[切面类]</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aspectj</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">JoinPoint</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">Signature</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span><span class="token comment">//切面类:@Aspect[表明是一个切面类，底层切面编程的支撑(动态代理+注解+反射)]</span><span class="token annotation punctuation">@Aspect</span><span class="token annotation punctuation">@Component</span><span class="token comment">//注入容器</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmartAnimalAspect</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 1. @Before 希望将f1方法切入到SmartDog-getSum前执行-前置通知     * 2. value = "execution(访问修饰符 返回类型 全类名.方法名(形参列表)"     * 3. JoinPoint joinPoint 在底层执行时，会给该切入方法传入(invoke的参数打包封装)     *    >通过JoinPoint对象的方法，可以得到 切入时方法执行得到的各种信息     */</span>    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(public float com.lhyedu.spring.aspectj.SmartDog.getSum(float, float))"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//通过连接点对象(JoinPoint)，可获得方法签名</span>        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"切面类f1(前置通知)-日志--方法名:"</span> <span class="token operator">+</span> signature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token operator">+</span> <span class="token string">"--方法参数:"</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>joinPoint<span class="token punctuation">.</span><span class="token function">getArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//返回通知：把f2方法切入到目标方法正常执行完毕后的地方</span>    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(public float com.lhyedu.spring.aspectj.SmartDog.getSum(float, float))"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">f2</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"切面类f2(返回通知)-方法执行接收--日志--方法名:"</span>                <span class="token operator">+</span> signature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//异常通知[若没有出现异常-则不会执行]</span>    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(public float com.lhyedu.spring.aspectj.SmartDog.getSum(float, float))"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">f3</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"切面类f3(异常通知)-出现异常--日志--方法名:"</span>                <span class="token operator">+</span> signature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//最终通知：切入到最终方法执行后，不管是否发生异常都要执行！(finally块)</span>    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(public float com.lhyedu.spring.aspectj.SmartDog.getSum(float, float))"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">f4</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">Signature</span> signature <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"切面类f4(最终通知)-方法最终执行完毕--日志--方法名:"</span>                <span class="token operator">+</span> signature<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>beans.xml</strong></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--扫描包--></span><span class="token comment">&lt;!--2个bean对象:SmartDog类 &amp; SmartDogAspect类--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.aspectj<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment">&lt;!--易忘：开启基于注解的AOP功能！--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">smartDogTestProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//得到容器</span>    <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>            <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//易错：接口类型接收注入的是：代理对象！！！(即小案例的Proxy内部类)</span>    <span class="token comment">//sd的编译类型不能用：SmartDog类接收！因为不是！</span>    <span class="token class-name">SmartAnimalable</span> sd <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"sd"</span><span class="token punctuation">,</span> <span class="token class-name">SmartAnimalable</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//System.out.println("sd的运行类型为:" + sd.getClass());</span>    <span class="token comment">//sd的运行类型为:class com.sun.proxy.$Proxy18</span>    <span class="token keyword">float</span> sum <span class="token operator">=</span> sd<span class="token punctuation">.</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token number">101.0f</span><span class="token punctuation">,</span> <span class="token number">11.2f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"sum = "</span> <span class="token operator">+</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java">切面类<span class="token function">f1</span><span class="token punctuation">(</span>前置通知<span class="token punctuation">)</span><span class="token operator">-</span>日志<span class="token operator">--</span>方法名<span class="token operator">:</span>getSum<span class="token operator">--</span>方法参数<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">101.0</span><span class="token punctuation">,</span> <span class="token number">11.2</span><span class="token punctuation">]</span>方法内部打印result <span class="token operator">=</span> <span class="token number">112.2</span>切面类<span class="token function">f2</span><span class="token punctuation">(</span>返回通知<span class="token punctuation">)</span><span class="token operator">-</span>方法执行接收<span class="token operator">--</span>日志<span class="token operator">--</span>方法名<span class="token operator">:</span>getSum切面类<span class="token function">f4</span><span class="token punctuation">(</span>最终通知<span class="token punctuation">)</span><span class="token operator">-</span>方法最终执行完毕<span class="token operator">--</span>日志<span class="token operator">--</span>方法名<span class="token operator">:</span>getSumsum <span class="token operator">=</span> <span class="token number">112.2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/574208C91D4CABB2FA530B78BE6722D3.png"></p><hr><h2 id="作业布置"><a href="#作业布置" class="headerlink" title="作业布置"></a>作业布置</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/72B46B2DFE84689272CC5AB7AA468FAB.png"></p><p>UsbInterface接口</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>homework</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UsbInterface</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Phone类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>homework</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Phone</span> <span class="token keyword">implements</span> <span class="token class-name">UsbInterface</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Phone 执行 work().."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Camera类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>homework</span><span class="token punctuation">;</span>、<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span> <span class="token keyword">implements</span> <span class="token class-name">UsbInterface</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Camera 执行 work().."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>SmartAnimalAspect类[&#x3D;&#x3D;切面类&#x3D;&#x3D;]</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>homework</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span><span class="token class-name">JoinPoint</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>aspectj<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Component</span><span class="token annotation punctuation">@Aspect</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmartAnimalAspect</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//1.前置通知</span>    <span class="token comment">//注意：切入方法的类与切面类在同一个目录->可用简单类名</span>    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(public void UsbInterface.work())"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">showBeginLog</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"前置通知-执行showBeginLog方法.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//2.返回通知</span>    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(public void UsbInterface.work())"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">showSuccessEndLog</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"前置通知-执行showSuccessEndLog方法.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//3.异常通知</span>    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(public void com.lhyedu.spring.aop.homework.UsbInterface.work())"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">showExceptionLog</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"异常通知-执行showExceptionLog方法.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//4.最终通知</span>    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"execution(public void com.lhyedu.spring.aop.homework.UsbInterface.work())"</span><span class="token punctuation">)</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">showFinallyEndLog</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"最终通知-执行showFinallyEndLog方法.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">homework</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>            <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">UsbInterface</span> phone <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"phone"</span><span class="token punctuation">,</span> <span class="token class-name">UsbInterface</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    phone<span class="token punctuation">.</span><span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">UsbInterface</span> camera <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"camera"</span><span class="token punctuation">,</span> <span class="token class-name">UsbInterface</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    camera<span class="token punctuation">.</span><span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java">前置通知<span class="token operator">-</span>执行showBeginLog方法<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token class-name">Phone</span> 执行 <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span>前置通知<span class="token operator">-</span>执行showSuccessEndLog方法<span class="token punctuation">.</span><span class="token punctuation">.</span>最终通知<span class="token operator">-</span>执行showFinallyEndLog方法<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>前置通知<span class="token operator">-</span>执行showBeginLog方法<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token class-name">Camera</span> 执行 <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span>前置通知<span class="token operator">-</span>执行showSuccessEndLog方法<span class="token punctuation">.</span><span class="token punctuation">.</span>最终通知<span class="token operator">-</span>执行showFinallyEndLog方法<span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AOP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>动态代理-精致小案例</title>
      <link href="/2024/02/17/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86-%E7%B2%BE%E8%87%B4%E5%B0%8F%E6%A1%88%E4%BE%8B/"/>
      <url>/2024/02/17/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86-%E7%B2%BE%E8%87%B4%E5%B0%8F%E6%A1%88%E4%BE%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="动态代理—精致小案例"><a href="#动态代理—精致小案例" class="headerlink" title="动态代理—精致小案例"></a>动态代理—精致小案例</h1><h2 id="需求说明"><a href="#需求说明" class="headerlink" title="需求说明"></a>需求说明</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/F2376053699EFA3A14DCBE6134991CBC.png"></p><hr><h2 id="传统方式"><a href="#传统方式" class="headerlink" title="传统方式"></a>传统方式</h2><p>Vehicle接口</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>proxy2</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Car类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>proxy2</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Car</span> <span class="token keyword">implements</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"交通工具开始运行了.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"小汽车在公路 running.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"交通工具停止运行了.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ship类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>proxy2</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Ship</span> <span class="token keyword">implements</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"交通工具开始运行了.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"大轮船在水上 running.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"交通工具停止运行了.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">traditionalSolution</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">Vehicle</span> vehicle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    vehicle<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"====================="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    vehicle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ship</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    vehicle<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java">交通工具开始运行了<span class="token punctuation">.</span><span class="token punctuation">.</span>小汽车在公路 running<span class="token punctuation">.</span><span class="token punctuation">.</span>交通工具停止运行了<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>交通工具开始运行了<span class="token punctuation">.</span><span class="token punctuation">.</span>大轮船在水上 running<span class="token punctuation">.</span><span class="token punctuation">.</span>交通工具停止运行了<span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>问题说明：代码冗余，起始就是单个对象的调用，并没有很好地解决，无法对同一类型的多个对象进行统一管理</strong></p></blockquote><hr><h2 id="动态代理方式"><a href="#动态代理方式" class="headerlink" title="动态代理方式"></a>动态代理方式</h2><blockquote><p><strong>注意：理解<code>动态代理</code>，是掌握AOP的核心</strong></p></blockquote><p><strong>动态代理解决思路，在调用方法时，使用反射机制，根据方法去决定调用哪个对象。</strong></p><p><strong>VehicleProxyProvider类</strong></p><blockquote><p><strong>该类可以返回一个代理对象</strong></p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>proxy2</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span><span class="token comment">//该类可以返回一个 代理对象</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VehicleProxyProvider</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//定义一个属性</span>    <span class="token comment">//设置一个将来真正要运行的对象，只要是实现了Vehicle接口的就ok</span>    <span class="token keyword">private</span> <span class="token class-name">Vehicle</span> target_vehicle<span class="token punctuation">;</span>    <span class="token comment">//构造器</span>    <span class="token keyword">public</span> <span class="token class-name">VehicleProxyProvider</span><span class="token punctuation">(</span><span class="token class-name">Vehicle</span> target_vehicle<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>target_vehicle <span class="token operator">=</span> target_vehicle<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//编写一个方法，返回一个代理对象(重点！！！)</span>    <span class="token keyword">public</span> <span class="token class-name">Vehicle</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">/**         *     public static Object newProxyInstance(ClassLoader loader,         *                                           Class&lt;?>[] interfaces,         *                                           InvocationHandler h)         * 解读：         * 0.Proxy.newProxyInstance()：可以返回一个"代理对象"         * 1.ClassLoader loader：类的加载器         * 2.Class&lt;?>[] interfaces：将来要代理的对象的接口信息         * 3.InvocationHandler h：调用处理器/对象 有一个非常重要的方法invoke         */</span>        <span class="token comment">//1.得到类加载器</span>        <span class="token class-name">ClassLoader</span> cl <span class="token operator">=</span> target_vehicle<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.得到 被代理/被执行对象 的接口信息</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces <span class="token operator">=</span> target_vehicle<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3.创建InvocationHandler 对象</span>        <span class="token comment">/**         * public interface InvocationHandler &#123;         *     public Object invoke(Object proxy, Method method, Object[] args)         *     throws Throwable;//接口的抽象方法         * &#125;         */</span>        <span class="token comment">//因为InvocationHandler是接口 -> 可以通过匿名对象方式来创建该方式</span>        <span class="token class-name">InvocationHandler</span> invocationHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token comment">//invoke():将来执行target_vehicle的方法时，会调用到的</span>            <span class="token comment">//Object o：代理对象</span>            <span class="token comment">//Method method：反射中的方法类</span>            <span class="token comment">//Object[] args：表示代理对象的方法的参数</span>            <span class="token comment">//返回：代理对象调用(invoke)后返回的结果</span>            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>                    <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"交通工具开始运行了.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//执行(重点！)。以下是我们的反射基础</span>                <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target_vehicle<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"交通工具停止运行了.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> result<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token comment">//获取代理对象，该对象可以代理执行方法</span>        <span class="token class-name">Vehicle</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Vehicle</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>cl<span class="token punctuation">,</span> interfaces<span class="token punctuation">,</span> invocationHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> proxy<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">proxySolution</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//创建一个Ship对象</span>    <span class="token class-name">Vehicle</span> vehicle <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Ship</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//创建VehicleProxyProvider对象，并传入要代理的对象</span>    <span class="token class-name">VehicleProxyProvider</span> vehicleProxyProvider <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VehicleProxyProvider</span><span class="token punctuation">(</span>vehicle<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//获取代理对象(非常关键!!!) -> 代理执行方法</span>    <span class="token comment">//1.proxy编译类型：Vehicle</span>    <span class="token comment">//2.proxy运行类型：class com.sun.proxy.$Proxy9(代理类型)</span>    <span class="token class-name">Vehicle</span> proxy <span class="token operator">=</span> vehicleProxyProvider<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"(proxy运行类型是:"</span> <span class="token operator">+</span> proxy<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">")"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    proxy<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>注意：proxy的编译类型&amp;运行类型</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240118101421208.png"></p><p><strong>执行<code>proxy.run()</code>语句时：</strong></p><ul><li><strong>没有执行Ship对象的run()方法</strong></li><li><strong>通过：反射 + 动态代理机制</strong></li><li><strong>执行的是proxy对象的newProxyInstance方法的参数(即：InvocationHandler实现类对象)</strong></li></ul></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token punctuation">(</span>proxy运行类型是<span class="token operator">:</span><span class="token keyword">class</span> com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>proxy<span class="token punctuation">.</span>$<span class="token class-name">Proxy9</span><span class="token punctuation">)</span>交通工具开始运行了<span class="token punctuation">.</span><span class="token punctuation">.</span>大轮船在水上 running<span class="token punctuation">.</span><span class="token punctuation">.</span>交通工具停止运行了<span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="解读"><a href="#解读" class="headerlink" title="解读"></a>解读</h3><p><strong><code>proxy.run()</code>的具体执行过程</strong></p><p>设置断点</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240118102910707.png" alt="" style="zoom: 50%;" /><p>step into</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240117221859555.png" alt="" style="zoom: 50%;" /><p>step over</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240117222541472.png" alt="" style="zoom: 50%;" /><p>step into</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240117222700781.png" alt="" style="zoom: 50%;" /><p>step over + step into</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240117222840457.png" alt="" style="zoom: 50%;" /><p>step into</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240117222937383.png" alt="" style="zoom: 50%;" /><p>step into</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240117223251908.png" alt="" style="zoom: 50%;" /><p>step into</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240117223447188.png" alt="" style="zoom: 50%;" /><hr><h2 id="课后作业—动态代理深入-横切关注点"><a href="#课后作业—动态代理深入-横切关注点" class="headerlink" title="课后作业—动态代理深入[横切关注点]"></a>课后作业—动态代理深入[横切关注点]</h2><p><strong>有一个<code>SmartAnimal</code>接口，可以完成简单的加减法，要求在执行<code>getSum()</code>和<code>getSub()</code>时，输出执行前，执行过程，执行后的日志输出，思考如何用<u>动态代理方式</u>实现？</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/2E054AAFC773E60E37894079E8E83B3E.png" alt="" style="zoom: 40%;" /><p>SmartAnimalable接口</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>proxy</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SmartAnimalable</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">float</span> <span class="token function">getSum</span><span class="token punctuation">(</span><span class="token keyword">float</span> i<span class="token punctuation">,</span> <span class="token keyword">float</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">float</span> <span class="token function">getSub</span><span class="token punctuation">(</span><span class="token keyword">float</span> i<span class="token punctuation">,</span> <span class="token keyword">float</span> j<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>SmartDog类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>proxy</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SmartDog</span> <span class="token keyword">implements</span> <span class="token class-name">SmartAnimalable</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">getSum</span><span class="token punctuation">(</span><span class="token keyword">float</span> i<span class="token punctuation">,</span> <span class="token keyword">float</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> i <span class="token operator">+</span> j<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">getSub</span><span class="token punctuation">(</span><span class="token keyword">float</span> i<span class="token punctuation">,</span> <span class="token keyword">float</span> j<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> i <span class="token operator">-</span> j<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>MyProxyProvide类[重点]</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>proxy</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyProxyProvide</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">SmartAnimalable</span> target_obj<span class="token punctuation">;</span>    <span class="token comment">//构造器</span>    <span class="token keyword">public</span> <span class="token class-name">MyProxyProvide</span><span class="token punctuation">(</span><span class="token class-name">SmartAnimalable</span> target_obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>target_obj <span class="token operator">=</span> target_obj<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">SmartAnimalable</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1.得到类加载器</span>        <span class="token class-name">ClassLoader</span> loader <span class="token operator">=</span> target_obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.得到接口信息</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces <span class="token operator">=</span> target_obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.得到InvocationHandler实现类</span>        <span class="token class-name">InvocationHandler</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>                    <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//这里从AOP看，就是一个横切关注点-"前置通知"</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"日志--方法名:"</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token operator">+</span> <span class="token string">"--方法参数:"</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target_obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//也是一个横切关注点-"返回通知"</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"日志--方法名:"</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token operator">+</span> <span class="token string">"--方法正常结束--返回结果:"</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//反射执行方法出现异常-> 横切关注点-"异常通知"</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"方法执行异常-日志-方法名:"</span> <span class="token operator">+</span>                                       method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"--异常类型:"</span>                                       <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//横切关注点-"最终通知"</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"方法最终结束-日志-方法名-"</span> <span class="token operator">+</span>                                       method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">return</span> result<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token class-name">SmartAnimalable</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SmartAnimalable</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>loader<span class="token punctuation">,</span> interfaces<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">proxySolution2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">SmartAnimalable</span> smartDog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SmartDog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">MyProxyProvide</span> myProxyProvide <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyProxyProvide</span><span class="token punctuation">(</span>smartDog<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">SmartAnimalable</span> proxy <span class="token operator">=</span> myProxyProvide<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    proxy<span class="token punctuation">.</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token number">10.87f</span><span class="token punctuation">,</span> <span class="token number">89.7f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"========================================"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    proxy<span class="token punctuation">.</span><span class="token function">getSub</span><span class="token punctuation">(</span><span class="token number">10.87f</span><span class="token punctuation">,</span> <span class="token number">89.7f</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java">日志<span class="token operator">--</span>方法名<span class="token operator">:</span>getSum<span class="token operator">--</span>方法参数<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">10.87</span><span class="token punctuation">,</span> <span class="token number">89.7</span><span class="token punctuation">]</span>日志<span class="token operator">--</span>方法名<span class="token operator">:</span>getSum<span class="token operator">--</span>方法正常结束<span class="token operator">--</span>返回结果<span class="token operator">:</span><span class="token number">100.57</span>方法最终结束<span class="token operator">-</span>日志<span class="token operator">-</span>方法名<span class="token operator">-</span>getSum<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>日志<span class="token operator">--</span>方法名<span class="token operator">:</span>getSub<span class="token operator">--</span>方法参数<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">10.87</span><span class="token punctuation">,</span> <span class="token number">89.7</span><span class="token punctuation">]</span>日志<span class="token operator">--</span>方法名<span class="token operator">:</span>getSub<span class="token operator">--</span>方法正常结束<span class="token operator">--</span>返回结果<span class="token operator">:</span><span class="token operator">-</span><span class="token number">78.829994</span>方法最终结束<span class="token operator">-</span>日志<span class="token operator">-</span>方法名<span class="token operator">-</span>getSub<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>问题</strong></p><p><strong>在<code>MyProxyProvide.java</code>中，我们输出的语句功能比较弱，而且是硬编码。在实际开发中，我们希望是以一个方法，嵌入到真正执行的目标方法前，怎么办？</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240118195632967.png" alt="" style="zoom: 60%;" /><p><strong>改进：将以上几种<code>&quot;横切关注点&quot;</code>打包成<code>函数</code>，即可以在这些地方写日志和其他业务逻辑</strong></p></blockquote><h3 id="土方法解决"><a href="#土方法解决" class="headerlink" title="土方法解决"></a>土方法解决</h3><p><strong>将<code>横切关注点-&quot;前置通知&quot;</code>、<code>横切关注点-&quot;返回通知&quot;</code>等封装到AOP类中。这里LHYAOP视为一个切面类，达成解耦效果。</strong></p><p><strong>LHYAOP类[简易的AOP]</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>proxy3</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span></span><span class="token punctuation">;</span><span class="token comment">//极简的AOP类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LHYAOP</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//函数参数 = invoke()的参数</span>    <span class="token comment">//将 横切关注点-"前置通知" 封装成before方法</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"LHYAOP-before-日志--方法名:"</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token operator">+</span> <span class="token string">"--方法参数:"</span> <span class="token operator">+</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//将 横切关注点-"返回通知" 封装成after方法</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span> result<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"LHYAOP-after-日志--方法名:"</span> <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token operator">+</span> <span class="token string">"--方法正常结束--返回结果:"</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>MyProxyProvide类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>aop<span class="token punctuation">.</span>proxy3</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">InvocationHandler</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Proxy</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyProxyProvide</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">SmartAnimalable</span> target_obj<span class="token punctuation">;</span>    <span class="token comment">//构造器</span>    <span class="token keyword">public</span> <span class="token class-name">MyProxyProvide</span><span class="token punctuation">(</span><span class="token class-name">SmartAnimalable</span> target_obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>target_obj <span class="token operator">=</span> target_obj<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">SmartAnimalable</span> <span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1.得到类加载器</span>        <span class="token class-name">ClassLoader</span> loader <span class="token operator">=</span> target_obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.得到接口信息</span>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> interfaces <span class="token operator">=</span> target_obj<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.得到InvocationHandler实现类</span>        <span class="token class-name">InvocationHandler</span> h <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token annotation punctuation">@Override</span>            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span>                    <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>                <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//横切关注点-"前置通知"</span>                    <span class="token constant">LHYAOP</span><span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>target_obj<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>                    result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target_obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//横切关注点-"返回通知"</span>                    <span class="token constant">LHYAOP</span><span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//反射执行方法出现异常-> 横切关注点-"异常通知"</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"方法执行异常-日志-方法名:"</span>                                        <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                            <span class="token operator">+</span> <span class="token string">"--异常类型:"</span> <span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//横切关注点-"最终通知"</span>                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"方法最终结束-日志-方法名-"</span>                                        <span class="token operator">+</span> method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>                <span class="token keyword">return</span> result<span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        <span class="token class-name">SmartAnimalable</span> s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">SmartAnimalable</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>loader<span class="token punctuation">,</span> interfaces<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> s<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token annotation punctuation">@Test</span><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">proxySolution2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">SmartAnimalable</span> smartDog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SmartDog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">MyProxyProvide</span> myProxyProvide <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyProxyProvide</span><span class="token punctuation">(</span>smartDog<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">SmartAnimalable</span> proxy <span class="token operator">=</span> myProxyProvide<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    proxy<span class="token punctuation">.</span><span class="token function">getSum</span><span class="token punctuation">(</span><span class="token number">10.87f</span><span class="token punctuation">,</span> <span class="token number">89.7f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"========================================"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    proxy<span class="token punctuation">.</span><span class="token function">getSub</span><span class="token punctuation">(</span><span class="token number">10.87f</span><span class="token punctuation">,</span> <span class="token number">89.7f</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token constant">LHYAOP</span><span class="token operator">-</span>before<span class="token operator">-</span>日志<span class="token operator">--</span>方法名<span class="token operator">:</span>getSum<span class="token operator">--</span>方法参数<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">10.87</span><span class="token punctuation">,</span> <span class="token number">89.7</span><span class="token punctuation">]</span><span class="token constant">LHYAOP</span><span class="token operator">-</span>after<span class="token operator">-</span>日志<span class="token operator">--</span>方法名<span class="token operator">:</span>getSum<span class="token operator">--</span>方法正常结束<span class="token operator">--</span>返回结果<span class="token operator">:</span><span class="token number">100.57</span>方法最终结束<span class="token operator">-</span>日志<span class="token operator">-</span>方法名<span class="token operator">-</span>getSum<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token constant">LHYAOP</span><span class="token operator">-</span>before<span class="token operator">-</span>日志<span class="token operator">--</span>方法名<span class="token operator">:</span>getSub<span class="token operator">--</span>方法参数<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">10.87</span><span class="token punctuation">,</span> <span class="token number">89.7</span><span class="token punctuation">]</span><span class="token constant">LHYAOP</span><span class="token operator">-</span>after<span class="token operator">-</span>日志<span class="token operator">--</span>方法名<span class="token operator">:</span>getSub<span class="token operator">--</span>方法正常结束<span class="token operator">--</span>返回结果<span class="token operator">:</span><span class="token operator">-</span><span class="token number">78.829994</span>方法最终结束<span class="token operator">-</span>日志<span class="token operator">-</span>方法名<span class="token operator">-</span>getSub<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="pring-AOP解决"><a href="#pring-AOP解决" class="headerlink" title="pring AOP解决"></a>pring AOP解决</h3><blockquote><p>土方法缺点：不够灵活、复用性差、是一种硬编码(没有反射和注解支撑)</p><p><strong>&#x3D;&#x3D;&#x3D;&#x3D;&gt;引出：<code>Spring AOP（底层：ASPECTJ）</code></strong></p></blockquote><p><strong>AOP的全称：<code>aspect oriented programming</code>，面向切面编程。<u>具体实现看下一章的快速入门</u>。</strong></p>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AOP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20.权限</title>
      <link href="/2024/02/16/20-%E6%9D%83%E9%99%90/"/>
      <url>/2024/02/16/20-%E6%9D%83%E9%99%90/</url>
      
        <content type="html"><![CDATA[<h1 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h1><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><p><strong><code>ls -l</code>中显示的内容如下</strong>👇</p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/qw.png"></p><p><strong>前面字符<u>共10位</u></strong></p><h3 id="0-9位说明"><a href="#0-9位说明" class="headerlink" title="0-9位说明"></a>0-9位说明</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/F163C83FBF3C7924470EF085691B2AF9.png"></p><blockquote><p><strong>其他说明：</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/QQ%E5%9B%BE%E7%89%8720220810190038.png"></p></blockquote><hr><h2 id="2-rwx权限详解-重点"><a href="#2-rwx权限详解-重点" class="headerlink" title="2.rwx权限详解[重点]"></a>2.rwx权限详解[重点]</h2><h3 id="rwx作用到文件"><a href="#rwx作用到文件" class="headerlink" title="rwx作用到文件"></a>rwx作用到<u>文件</u></h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220810162228773.png"></p><h3 id="rwx作用到目录"><a href="#rwx作用到目录" class="headerlink" title="rwx作用到目录"></a>rwx作用到<u>目录</u></h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220810162323446.png"></p><hr><h2 id="修改权限-—-方式1"><a href="#修改权限-—-方式1" class="headerlink" title="修改权限 — 方式1(+ - &#x3D;)"></a>修改权限 — 方式1(+ - &#x3D;)</h2><h3 id="基本介绍-1"><a href="#基本介绍-1" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/0300F080DBF590E1153CE3F16F15E591.png" alt="img"></p><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/24FF506A5A7B962DC29E33938CC815C1.png" alt="" style="zoom: 80%;" /><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/61F15433AACFD328B9BFB5304948A519.png" alt="" style="zoom: 67%;" /><blockquote><p>注意：赋予可执行权限后，显示为 <strong>绿色</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220810195601529.png"></p></blockquote><h3 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/14332EDFAEAD326FBEC973A70BE20821.png"></p><hr><h2 id="修改权限-—-方式2-数字"><a href="#修改权限-—-方式2-数字" class="headerlink" title="修改权限 — 方式2(数字)"></a>修改权限 — 方式2(数字)</h2><h3 id="基本介绍-2"><a href="#基本介绍-2" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/3212BE5639559FCD17861E382540F1C5.png"></p><blockquote><p><strong>权限的各个组合</strong>刚好可以排列成 <strong>&#x3D;&#x3D;0~7&#x3D;&#x3D;</strong></p></blockquote><h3 id="应用实例-1"><a href="#应用实例-1" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/DD1B659DB19FDAF01AE7E39D2163D0E4.png"></p><hr><h2 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/AC187AFCA8A03583084CA46D711D233A.png"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>19.组</title>
      <link href="/2024/02/16/19-%E7%BB%84/"/>
      <url>/2024/02/16/19-%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<h1 id="组"><a href="#组" class="headerlink" title="组"></a>组</h1><h2 id="Linux组的介绍"><a href="#Linux组的介绍" class="headerlink" title="Linux组的介绍"></a>Linux组的介绍</h2><h3 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/E3DE405FB8AEC99FD37F28FEF6FDB286.png"></p><blockquote><p><strong>文件</strong>对应得<strong>3个概念</strong>(1~3)：<img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/B2F45EF72E80E2BFD97273BC967676F2.png" alt="" style="zoom:50%;" /></p></blockquote><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/254F907341298597CEF8B37761ED8078.png" alt="" style="zoom: 33%;" /><hr><h2 id="文件-目录-所有者"><a href="#文件-目录-所有者" class="headerlink" title="文件&#x2F;目录 所有者"></a>文件&#x2F;目录 所有者</h2><h3 id="基本介绍-1"><a href="#基本介绍-1" class="headerlink" title="基本介绍"></a>基本介绍</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/73A5F2B254D1FB779A30B80A91F1A80C.png" alt="" style="zoom: 67%;" /><h3 id="查看文件所有者"><a href="#查看文件所有者" class="headerlink" title="查看文件所有者"></a><u>查看</u>文件所有者</h3><p><strong>基本语法</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ls</span> <span class="token parameter variable">-ahl</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>应用实例</strong>：                      <img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220810104956556.png" alt="" style="zoom: 67%;" /></p><h3 id="修改文件所有者-后面第7条也有"><a href="#修改文件所有者-后面第7条也有" class="headerlink" title="修改文件所有者(后面第7条也有)"></a><u>修改</u>文件所有者(后面第7条也有)</h3><p><strong>基本语法</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">chown</span> 用户名 文件/目录名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>应用实例</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/1D554D95D14FCB4039515506E5E290D4.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220810103425866.png" alt="" style="zoom:80%;" /><hr><h2 id="组的创建"><a href="#组的创建" class="headerlink" title="组的创建"></a>组的<u>创建</u></h2><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ group 组名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a><strong>应用实例</strong></h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/145B946F9C36E8149E8AFCD8725C1A43.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220810104147899.png" alt="" style="zoom:80%;" /><hr><h2 id="文件-目录-所在组"><a href="#文件-目录-所在组" class="headerlink" title="文件&#x2F;目录 所在组"></a>文件&#x2F;目录 所在组</h2><h3 id="基本介绍-2"><a href="#基本介绍-2" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/A36503E0406884708D20BA7CAD97AB4B.png"></p><h3 id="查看-文件-目录-所在组"><a href="#查看-文件-目录-所在组" class="headerlink" title="查看 文件&#x2F;目录 所在组"></a><u>查看</u> 文件&#x2F;目录 所在组</h3><p><strong>基本语法</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ls</span> <span class="token parameter variable">-ahl</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>应用实例</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/056FE8239D717830DE9656FC4F894CD3.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220810105625800.png" alt="" style="zoom:67%;" /><h3 id="修改-文件-目录-所在组-后面第8条也有"><a href="#修改-文件-目录-所在组-后面第8条也有" class="headerlink" title="修改 文件&#x2F;目录 所在组(后面第8条也有)"></a><u>修改</u> 文件&#x2F;目录 所在组(后面第8条也有)</h3><p><strong>基本语法</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">chgrp</span> 组名 文件/目录名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>应用实例</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/5574A042EBE9D6922652C93346AE332C.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220810110356058.png"></p><hr><h2 id="其他组"><a href="#其他组" class="headerlink" title="其他组"></a>其他组</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/73EF615307FB8069FCD463801218FAEE.png"></p><hr><h2 id="改变用户-所在组"><a href="#改变用户-所在组" class="headerlink" title="改变用户 所在组"></a>改变用户 所在组</h2><h3 id="基本介绍-3"><a href="#基本介绍-3" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/3383EDFFD6F98B7E53EE0926CD3687F7.png"></p><h3 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">usermod</span> <span class="token parameter variable">-g</span> 新组名 用户名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>改变该用户登录的初始方式</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">usermod</span> <span class="token parameter variable">-d</span> 目录名 用户名 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>特别说明：用户需要有进入到新目录的权限</strong></p></blockquote><h3 id="应用实例-1"><a href="#应用实例-1" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/CC30DE19560F41C29D70B9E4289D8D51.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220810152545001.png" alt="" style="zoom:80%;" /><hr><h2 id="修改-文件-目录-所有者"><a href="#修改-文件-目录-所有者" class="headerlink" title="修改 文件&#x2F;目录 所有者"></a>修改 文件&#x2F;目录 所有者</h2><h3 id="基本语法-2"><a href="#基本语法-2" class="headerlink" title="基本语法"></a>基本语法</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/A51AB65453B20EA5D735024301228A08.png"></p><h3 id="应用实例-2"><a href="#应用实例-2" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/A2689E9F951E678E9420DCF3394866E2.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/04C76EF540B0C1DD29F97F851ADE42F5.png"></p><hr><h2 id="修改-文件-目录-所在组"><a href="#修改-文件-目录-所在组" class="headerlink" title="修改 文件&#x2F;目录 所在组"></a>修改 文件&#x2F;目录 所在组</h2><h3 id="基本介绍-4"><a href="#基本介绍-4" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/A25192C01D908060FBDAD72A473254FE.png"></p><h3 id="应用实例-3"><a href="#应用实例-3" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/DD2FBCDFC1314100573DA621F8D4248A.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/C82535A6070EA6B9029E48033F0E857D.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>18.5.压缩和解压类</title>
      <link href="/2024/02/16/18-5-%E5%8E%8B%E7%BC%A9%E5%92%8C%E8%A7%A3%E5%8E%8B%E7%B1%BB/"/>
      <url>/2024/02/16/18-5-%E5%8E%8B%E7%BC%A9%E5%92%8C%E8%A7%A3%E5%8E%8B%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h2 id="gzip-gunzip指令"><a href="#gzip-gunzip指令" class="headerlink" title="gzip&#x2F;gunzip指令"></a>gzip&#x2F;gunzip指令</h2><h3 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/0C28206BC11CE74397573F3BEF989C28.png"></p><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><p><strong>压缩</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">gzip</span> 文件<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>解压缩</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ gunzip 文件.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/4C25F7E9FC7CC6869F6E0C92391E14D7.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809222617594.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/37A6B8A2834C976A8F8BE17C70264E2F.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809222637530.png" alt="" style="zoom:80%;" /><hr><h2 id="zip-unzip指令"><a href="#zip-unzip指令" class="headerlink" title="zip&#x2F;unzip指令"></a>zip&#x2F;unzip指令</h2><h3 id="基本介绍-1"><a href="#基本介绍-1" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/93E3DA6725B2B1DD7497DB216FEC04D3.png" alt="img"></p><h3 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">zip</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> XXX.zip 将要压缩的内容                     //功能描述：压缩文件和目录的命令<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>zip常用选项</strong>：<img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/6408C9F389FBDF9AB74E416260834D7F.png" alt="" style="zoom: 50%;" /></p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">unzip</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> XXX.zip                                        //功能描述：解压缩文件<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>unzip常用选项</strong>：<img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/9A35DFAE82ACEDE7042385A6922EE360.png" alt="" style="zoom:50%;" /></p></blockquote><h3 id="2-2应用实例"><a href="#2-2应用实例" class="headerlink" title="2.2应用实例"></a>2.2应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/A71FF130E9E717F6A5E4D23047C7BA9B.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809224547807.png" alt="" style="zoom:80%;" /><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809224617021.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/05CE37D931E1320A6B252632BF9A7ACE.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809224956839.png" alt="" style="zoom:80%;" /><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809225021264.png" alt="" style="zoom:80%;" /><hr><h2 id="tar指令-最常用"><a href="#tar指令-最常用" class="headerlink" title="tar指令[最常用]"></a>tar指令[最常用]</h2><h3 id="基本介绍-2"><a href="#基本介绍-2" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/00AD0AE81E9730D6EA78F90A04D91D49.png"></p><h3 id="基本语法-2"><a href="#基本语法-2" class="headerlink" title="基本语法"></a>基本语法</h3><p>压缩还是解压？通过<strong>选项</strong>处理！</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">tar</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> XXX.tar.gz 打包的内容              //功能描述：打包目录，压缩后格式.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>选项说明</strong>：<img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/3829F6F6F6491E73B0EA0CFCC7771CF4.png" alt="" style="zoom: 65%;" /></p></blockquote><h3 id="应用实例-1"><a href="#应用实例-1" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/6575EB5FCD117CFE7C41D25C368B5A3A.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809231338890.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/6BDCF1A6F4D5197B83627DC091AD2B0C.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809231502591.png" alt="" style="zoom:80%;" /><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809231528753.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/5C7FCEEEA153EF43DF5E933E8F0B5B53.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809231812270.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/78D084F1D08E3FE1F2E7DFBC13380F3B.png"></p><blockquote><p><strong><code>-C</code> 后面代表解压后要存放的位置</strong></p></blockquote><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809232124717.png" alt="" style="zoom:80%;" /><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809232145318.png" alt="" style="zoom:80%;" />]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>18.搜索查找类</title>
      <link href="/2024/02/16/18-%E6%90%9C%E7%B4%A2%E6%9F%A5%E6%89%BE%E7%B1%BB/"/>
      <url>/2024/02/16/18-%E6%90%9C%E7%B4%A2%E6%9F%A5%E6%89%BE%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="搜索查找类"><a href="#搜索查找类" class="headerlink" title="搜索查找类"></a>搜索查找类</h1><h2 id="find指令"><a href="#find指令" class="headerlink" title="find指令"></a>find指令</h2><h3 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/77E05E562997ABC261D4D859767BC055.png"></p><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">find</span> <span class="token punctuation">[</span>搜索范围<span class="token punctuation">]</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>选项说明：<img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/89308E08108BD82D9C28FE9FCB853179.png" alt="" style="zoom:67%;" /></strong></p></blockquote><h3 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/FC7D779F892DEDE491B4B0276D043D72.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809203729224.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/56AAC01C77797BFA4BE171C6571C451B.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809203754895.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/5D1E767F9D74A70483ECD927B639880A.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809203941290.png" alt="" style="zoom:80%;" /><hr><h2 id="locate指令"><a href="#locate指令" class="headerlink" title="locate指令"></a>locate指令</h2><h3 id="基本介绍-1"><a href="#基本介绍-1" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/2D4DA6D9DA3AD87F245410E09B87A508.png"></p><h3 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">locate</span> 搜索文件<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="特别说明"><a href="#特别说明" class="headerlink" title="特别说明"></a>特别说明</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/ED51517B6B96577F33ADA3A653FF1E7B.png"></p><h3 id="应用实例-1"><a href="#应用实例-1" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/D07A184817F40B3DE3450B9C44BFE2C0.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809204741792.png" alt="" style="zoom:80%;" /><h3 id="补充指令：which"><a href="#补充指令：which" class="headerlink" title="补充指令：which"></a>补充指令：which</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/0E9F0AAF988D08738CA9C0588433A68A.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809204936863.png" alt="" style="zoom:80%;" /><hr><h2 id="grep指令与管道符号"><a href="#grep指令与管道符号" class="headerlink" title="grep指令与管道符号"></a>grep指令与管道符号</h2><h3 id="基本介绍-2"><a href="#基本介绍-2" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/5BD96628FC2E829C6F856339098F4CD9.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/F84B0FD905AF51FD95B03F68BC8FD671.png" alt="" style="zoom:33%;" /><h3 id="基本语法-2"><a href="#基本语法-2" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-none"><code class="language-none">$ grep [选项] 查找内容 源文件<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>常用选项</strong>：<img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/93A718A964C3CE67C840C3A8EA984D7B.png" alt="" style="zoom:67%;" /></p></blockquote><h3 id="应用实例-2"><a href="#应用实例-2" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/CCB351D055CEE05C0B1F0FC7A469BD67.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809212950788.png" alt="" style="zoom:80%;" />]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>17.时间日期类</title>
      <link href="/2024/02/16/17-%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E7%B1%BB/"/>
      <url>/2024/02/16/17-%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="时间日期类"><a href="#时间日期类" class="headerlink" title="时间日期类"></a>时间日期类</h1><h2 id="1-date指令"><a href="#1-date指令" class="headerlink" title="1.date指令"></a>1.date指令</h2><h3 id="1-0基本介绍"><a href="#1-0基本介绍" class="headerlink" title="1.0基本介绍"></a>1.0基本介绍</h3><p><strong>显示&#x2F;设置 时间日期</strong></p><h3 id="1-1基本语法"><a href="#1-1基本语法" class="headerlink" title="1.1基本语法"></a>1.1基本语法</h3><p><strong>显示当前时间</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">date</span>                                                      //功能描述：显示当前时间<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>显示当前年份</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">date</span> +%Y                                                  //功能描述：显示当前年份<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>显示当前月份</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">date</span> +%m                                                  //功能描述：显示当前月份<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>显示当前是哪天</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">date</span> +%d                                              //功能描述：显示当前是那一天<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>显示年月日时分秒</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">date</span> <span class="token string">"+%Y-%m-%d %H:%M:%S"</span>                             //功能描述：显示年月日时分秒<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>设置日期</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">date</span> <span class="token parameter variable">-s</span> <span class="token string">"字符串时间"</span>                                           //功能描述：设置日期<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>改回来：hwclock -s</strong></p></blockquote><h3 id="1-2应用实例"><a href="#1-2应用实例" class="headerlink" title="1.2应用实例"></a>1.2应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/8ABF75B3728F8E15A7A48380F4CBAA16.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809194535631.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/6A6C769E3C834DA359762B9339039691.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809194555687.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/C6B54D889AE2962F7C47FE3A6950049A.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809194612029.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/7B502BA4F722643C6C191B98FBF697AC.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809195358342.png" alt="" style="zoom:80%;" /><hr><h2 id="2-cal指令"><a href="#2-cal指令" class="headerlink" title="2.cal指令"></a>2.cal指令</h2><h3 id="2-0基本介绍"><a href="#2-0基本介绍" class="headerlink" title="2.0基本介绍"></a>2.0基本介绍</h3><p><strong>查看日历指令</strong></p><h3 id="2-1基本语法"><a href="#2-1基本语法" class="headerlink" title="2.1基本语法"></a>2.1基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cal</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span>                                        //功能描述：不加选项，显示本月日历<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-2应用实例"><a href="#2-2应用实例" class="headerlink" title="2.2应用实例"></a>2.2应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/72092FC33B3DB20EFF86EA61799FECE1.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809195920702.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/2B727A72DB4806E0A7554F6572938296.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809200037461.png" alt="" style="zoom:67%;" />]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>16.文件目录类</title>
      <link href="/2024/02/16/16-%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E7%B1%BB/"/>
      <url>/2024/02/16/16-%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="文件目录类-常用"><a href="#文件目录类-常用" class="headerlink" title="文件目录类[常用]"></a>文件目录类[常用]</h1><h2 id="pwd指令"><a href="#pwd指令" class="headerlink" title="pwd指令"></a>pwd指令</h2><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">pwd</span>                                           //功能描述：显示当前工作目录的绝对路径<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>绝对路径：从<code>根目录</code>开始定位</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/5BFEEA3D5941A8DB05D2BF56925D42D6.png" alt="" style="zoom: 30%;" /></blockquote><h3 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/06AB2E3B982F1220AA07AD12ACABF477.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808215443937.png" alt="" style="zoom:80%;" /><hr><h2 id="ls指令"><a href="#ls指令" class="headerlink" title="ls指令"></a>ls指令</h2><h3 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ls</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> <span class="token punctuation">[</span>目录/文件<span class="token punctuation">]</span>-a:显示当前目录所有的文件和目录，包含隐藏的-l:以列表的方式逐行显示信息<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="应用实例-1"><a href="#应用实例-1" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/290A10A6F2C14905C5052275034B013B.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808215838834.png" alt="" style="zoom:80%;" /><hr><h2 id="cd指令"><a href="#cd指令" class="headerlink" title="cd指令"></a>cd指令</h2><h3 id="基本语法-2"><a href="#基本语法-2" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">cd</span> <span class="token punctuation">[</span>参数<span class="token punctuation">]</span>                                                //功能描述：切换到指定目录<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/1C6640B77A1B355CF3D91CC031E669A6.png"></p></blockquote><h3 id="应用实例-2"><a href="#应用实例-2" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/DDEB9FA6E319E0BB61FB6D353A20C984.png"></p><hr><h2 id="mkdir指令"><a href="#mkdir指令" class="headerlink" title="mkdir指令"></a>mkdir指令</h2><h3 id="基本语法-3"><a href="#基本语法-3" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">mkdir</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> 要创建的目录                                   //功能描述：用于创建目录<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>常用选项:</strong><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/36234DAE996873593851C4DFA8F8FC51.png" alt="" style="zoom:67%;" /></p></blockquote><h3 id="4-2应用实例"><a href="#4-2应用实例" class="headerlink" title="4.2应用实例"></a>4.2应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/AC9BFA47A2B382B3F5116DE7A4047017.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808222758130.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/94FD9B7904FFB0FD858CD51F0C74515E.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808223004858.png" alt="" style="zoom:80%;" /><hr><h2 id="rmdir指令"><a href="#rmdir指令" class="headerlink" title="rmdir指令"></a>rmdir指令</h2><h3 id="基本语法-4"><a href="#基本语法-4" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">rmdir</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> 要删除的空目录                                   //功能描述：删除空目录<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用实例-3"><a href="#应用实例-3" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/0C79D717F2808E80E4C5EE319BDC9549.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808224254517.png" alt="" style="zoom:80%;" /><h3 id="5-3使用细节"><a href="#5-3使用细节" class="headerlink" title="5.3使用细节"></a>5.3使用细节</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/EEFB371B20FC8CE074436D8BBD3CAE61.png"></p><blockquote><p>删除非空目录：</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808224907559.png" alt="" style="zoom:80%;" /></blockquote><hr><h2 id="touch指令"><a href="#touch指令" class="headerlink" title="touch指令"></a>touch指令</h2><h3 id="基本语法-5"><a href="#基本语法-5" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">touch</span> 文件名称                                               //功能描述：创建空文件<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用实例-4"><a href="#应用实例-4" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/B7BAEE2D84551F87C1F8C188B1AAAEDF.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808225333077.png" alt="" style="zoom:80%;" /><hr><h2 id="cp指令"><a href="#cp指令" class="headerlink" title="cp指令"></a>cp指令</h2><h3 id="基本语法-6"><a href="#基本语法-6" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cp</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> <span class="token builtin class-name">source</span> dest                                //功能描述：拷贝文件到指定目录<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>常用选项</strong>：<img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/69AEEA6A68975415E01FE67B8F2EEB27.png" alt="" style="zoom: 50%;" /></p></blockquote><h3 id="应用实例-5"><a href="#应用实例-5" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/A23F6DBCFA00A0ECBADD2773B6965781.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809095204102.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/544BDFFB9126FD723FAD6437396869D4.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809095653318.png" alt="" style="zoom:80%;" /><h3 id="使用细节"><a href="#使用细节" class="headerlink" title="使用细节"></a>使用细节</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/8257277E544CADD064E6B642A2E786EA.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809100401502.png" alt="" style="zoom:80%;" /><hr><h2 id="rm指令"><a href="#rm指令" class="headerlink" title="rm指令"></a>rm指令</h2><h3 id="基本语法-7"><a href="#基本语法-7" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">rm</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> 要删除的文件或目录                            //功能描述：拷贝文件到指定目录<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>常用选项</strong>：<img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/9631072DC60DDD2F64AF92F26EAA8720.png" alt="" style="zoom: 50%;" /></p></blockquote><h3 id="8-2应用实例"><a href="#8-2应用实例" class="headerlink" title="8.2应用实例"></a>8.2应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/219740ECE7CC1D81673F4453F22B67F7.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809101752020.png" alt="" style="zoom:80%;" /><h3 id="8-3使用细节"><a href="#8-3使用细节" class="headerlink" title="8.3使用细节"></a>8.3使用细节</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/45E05A5A6AC0222BB91CC7C3EBF19CAE.png"></p><hr><h2 id="mv指令"><a href="#mv指令" class="headerlink" title="mv指令"></a>mv指令</h2><h3 id="基本语法-8"><a href="#基本语法-8" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">mv</span> oldNmaeFile newNameFile<span class="token punctuation">(</span>两个文件在同一个目录下<span class="token punctuation">)</span>             //功能描述：文件重命名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">mv</span> /temp/movefile /targetFolder<span class="token punctuation">(</span>两个文件不在同一个目录下<span class="token punctuation">)</span>        //功能描述：移动文件<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用实例-6"><a href="#应用实例-6" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/2AF41756999C7EBF56D09AA298198A0B.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809103529491.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/87105DAD59CD0DDA11AC0A1E071D27F2.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809104034678.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/59FA862DF9138E21E9D36F48BD045BF2.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809104641715.png" alt="" style="zoom:80%;" /><hr><h2 id="cat指令"><a href="#cat指令" class="headerlink" title="cat指令"></a>cat指令</h2><h3 id="基本语法-9"><a href="#基本语法-9" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> 要查看的文件                                     //功能描述：查看文件内容<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>常用选项</strong>：<img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/59FBE286B7C30585DE17009B13AE2102.png" alt="" style="zoom: 55%;" /></p></blockquote><p>注意：cat指令比vim指令查看文件<strong>更安全</strong></p><h3 id="应用实例-7"><a href="#应用实例-7" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/80C7678A8ADED443BF0055B5FADEFF8E.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809105425110.png" alt="" style="zoom:80%;" /><h3 id="使用细节-1"><a href="#使用细节-1" class="headerlink" title="使用细节"></a>使用细节</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/0325A14873CE307A4CFDCFB8D188E8A0.png"></p><hr><h2 id="more指令"><a href="#more指令" class="headerlink" title="more指令"></a>more指令</h2><h3 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/1E8397467466EE3607D365F06D04606D.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/A955AECD9819E251DA90E4068D56DA3D.png" alt="" style="zoom:50%;" /><h3 id="基本语法-10"><a href="#基本语法-10" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">more</span> 要查看的文件 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用实例-8"><a href="#应用实例-8" class="headerlink" title="应用实例"></a>应用实例</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/C5125A17BAFFCFCB96339E062133575D.png" alt="" style="zoom:67%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809110553303.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809110457994.png" alt="" style="zoom:80%;" /><hr><h2 id="less指令"><a href="#less指令" class="headerlink" title="less指令"></a>less指令</h2><h3 id="基本介绍-1"><a href="#基本介绍-1" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/5B5E09B2CBEC251FA45CCABEAB8DBAAA.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/0CBE4BB02F3EDEE51B10187A53E3DD1F.png" alt="" style="zoom:50%;" /><h3 id="基本语法-11"><a href="#基本语法-11" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">less</span> 要查看的文件<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用实例-9"><a href="#应用实例-9" class="headerlink" title="应用实例"></a>应用实例</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/35600645C57975A2B293E78FBB969481.png" alt="" style="zoom:67%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809160652448.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809161137027.png"></p><hr><h2 id="echo指令"><a href="#echo指令" class="headerlink" title="echo指令"></a>echo指令</h2><h3 id="基本语法-12"><a href="#基本语法-12" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> <span class="token punctuation">[</span>输出内容<span class="token punctuation">]</span>                                      //功能描述：查看文件内容<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用实例-10"><a href="#应用实例-10" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/35628673C35DE637CD9BC5E290F425BA.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809161635980.png" alt="" style="zoom:80%;" /><hr><h2 id="head指令"><a href="#head指令" class="headerlink" title="head指令"></a>head指令</h2><h3 id="基本介绍-2"><a href="#基本介绍-2" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/C46DE5EB667D513C2BE1B546E7D54219.png"></p><h3 id="基本语法-13"><a href="#基本语法-13" class="headerlink" title="基本语法"></a>基本语法</h3><p><strong>默认情况</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">head</span> 文件                                            //功能描述：查看文件前10行内容<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>指定情况</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">head</span> <span class="token parameter variable">-n</span> num 文件                           //功能描述：查看文件前num行内容,num自定义<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用实例-11"><a href="#应用实例-11" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/0D147FBE46745962A5925441B9871505.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809162351878.png" alt="" style="zoom: 67%;" /><hr><h2 id="tail指令"><a href="#tail指令" class="headerlink" title="tail指令"></a>tail指令</h2><h3 id="基本介绍-3"><a href="#基本介绍-3" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/AED45DD37A623585D1572E3167C468AA.png"></p><h3 id="基本语法-14"><a href="#基本语法-14" class="headerlink" title="基本语法"></a>基本语法</h3><p><strong>默认情况</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">tail</span> 文件                                            //功能描述：查看文件尾10行内容<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>指定情况</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">tail</span> <span class="token parameter variable">-n</span> num 文件                           //功能描述：查看文件尾num行内容,num自定义<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>特别指令</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">tail</span> <span class="token parameter variable">-f</span> 文件                                    //功能描述：实时追踪该文档的所有更新<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>Ctrl + c 退出实时监控</strong></p></blockquote><h3 id="应用实例-12"><a href="#应用实例-12" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/5E7F0B87D825A69DE67480185F1D6F1A.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809163224422.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/3222C9B563BE3F12FA823E0263E819E8.png"></p><blockquote><p><strong>&#x3D;&#x3D;用处&#x3D;&#x3D;：监控文件&#x2F;网络等…</strong></p></blockquote><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809164020747.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809164117348.png"></p><hr><h2 id="指令与-指令"><a href="#指令与-指令" class="headerlink" title="&gt;指令与&gt;&gt;指令"></a>&gt;指令与&gt;&gt;指令</h2><h3 id="基本介绍-4"><a href="#基本介绍-4" class="headerlink" title="基本介绍"></a>基本介绍</h3><blockquote><p><strong><code>&gt;</code>：覆盖</strong></p><p><strong><code>&gt;&gt;</code>：追加</strong></p></blockquote><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/771905E40006674D892B6E0950698097.png"></p><h3 id="基本语法-15"><a href="#基本语法-15" class="headerlink" title="基本语法"></a>基本语法</h3><p><strong>覆盖写入</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ls</span> <span class="token parameter variable">-l</span> <span class="token operator">></span> 文件                            //功能描述：列表的内容写入文件a.txt中<span class="token punctuation">(</span>覆盖写<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>追加写入</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ls</span> <span class="token parameter variable">-l</span> <span class="token operator">>></span> 文件                              //功能描述：列表的内容追加到文件a.txt末尾<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>文件内容覆盖</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> 文件1 <span class="token operator">></span> 文件2                                //功能描述：将文件1的内容覆盖到文件2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>文件写入</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token string">"内容"</span> <span class="token operator">></span> 文件                        //功能描述：将输出的内容写入文件末尾<span class="token punctuation">(</span>覆盖写<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>注意：以上写入文件对象不存在，会自动创建</p><h3 id="应用实例-13"><a href="#应用实例-13" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/57BAA03371EF4F03712C605AB7A77C7E.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809171050174.png" alt="" style="zoom: 67%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/BC12BA7AB549C2B7D9E9DC94EA7DC6D2.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809171430005.png" alt="" style="zoom: 67%;" /><hr><h2 id="ln指令"><a href="#ln指令" class="headerlink" title="ln指令"></a>ln指令</h2><h3 id="基本介绍-5"><a href="#基本介绍-5" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/67705F66BD1CC7097D016577A899277B.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/09953E345B25D0B16F09ED4A875AD51D.png" alt="" style="zoom: 25%;" /><h3 id="基本语法-16"><a href="#基本语法-16" class="headerlink" title="基本语法"></a>基本语法</h3><p><strong>创建软链接</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ln</span> <span class="token parameter variable">-s</span> <span class="token punctuation">[</span>原文件或目录<span class="token punctuation">]</span> <span class="token punctuation">[</span>软链接名<span class="token punctuation">]</span>                      //功能描述：给原文件创建一个软链接<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>删除软链接</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">rm</span> <span class="token punctuation">[</span>选项<span class="token punctuation">]</span> 要删除的文件或目录                  //注意：末尾带<span class="token string">'/'</span>表示目录；不带<span class="token string">'/'</span>表示文件<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用实例-14"><a href="#应用实例-14" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/E80DA331A3A9DACE7981E5F45CD45740.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809173607418.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/DC3E94F054E4D682982D910C143D1212.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809174251638.png" alt="" style="zoom:80%;" /><h3 id="细节说明"><a href="#细节说明" class="headerlink" title="细节说明"></a>细节说明</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/039984280F207E01E0BAC2E92B6DB00C.png"></p><hr><h2 id="history指令"><a href="#history指令" class="headerlink" title="history指令"></a>history指令</h2><h3 id="基本介绍-6"><a href="#基本介绍-6" class="headerlink" title="基本介绍"></a>基本介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/9B8B9CFF97A87A183175FD04E840C8D5.png"></p><h3 id="基本语法-17"><a href="#基本语法-17" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">history</span>                                          //功能描述：查看已执行过的历史指令<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用实例-15"><a href="#应用实例-15" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/020D75CF2547651F0D4E421F7181A904.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809175319279.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/81C584A7834914093909EDC86068BF1A.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809175350555.png" alt="" style="zoom:80%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/C100CBC9FDB2B891D062661FC52E3DCB.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220809175432914.png" alt="" style="zoom:80%;" />]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>15.帮助指令</title>
      <link href="/2024/02/16/15-%E5%B8%AE%E5%8A%A9%E6%8C%87%E4%BB%A4/"/>
      <url>/2024/02/16/15-%E5%B8%AE%E5%8A%A9%E6%8C%87%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="帮助指令"><a href="#帮助指令" class="headerlink" title="帮助指令"></a>帮助指令</h1><h2 id="man-获得帮助信息"><a href="#man-获得帮助信息" class="headerlink" title="man 获得帮助信息"></a>man 获得帮助信息</h2><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">man</span> <span class="token punctuation">[</span>命令或配置文件<span class="token punctuation">]</span>                                   //功能描述：获得指令的具体用法<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/2CB488C962EA1E8B9BC5C25F8CBC00A5.png" alt="img"></p><p>查看 <strong>ls命令的 帮助信息</strong>         👉👉👉<img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808204321570.png" alt="" style="zoom:80%;" /></p><p><strong>信息1</strong></p><blockquote><p>linux中，<strong>隐藏文件</strong>以’ <code>.</code> ‘开头<img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/15550A3AB97558C3537E81E37E65A477.png" alt="" style="zoom: 67%;" /></p><p><strong>指令：<code>ls -a</code></strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808205136279.png" alt="" style="zoom:80%;" /></blockquote><p><strong>信息2</strong></p><blockquote><p><strong>指令：<code>ls -l</code></strong> <img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808205945006.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808210122531.png" alt="" style="zoom:80%;" /></blockquote><p><strong>信息3 [信息1 与 信息2的指令混合使用]</strong></p><blockquote><p><strong>指令：<code>ls -la (/文件目录) / ls -al (/文件目录)</code></strong> <strong>单列输出，并包含隐藏文件</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808211320199.png" alt="" style="zoom:80%;" /></blockquote><hr><h2 id="help-指令"><a href="#help-指令" class="headerlink" title="help 指令"></a>help 指令</h2><h3 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">help</span> 命令                                    //功能描述：获得shell内置命令的帮助信息<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用实例-1"><a href="#应用实例-1" class="headerlink" title="应用实例"></a>应用实例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/F230BB3F0485C869E783792D09725B03.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808212002581.png" alt="" style="zoom: 67%;" />]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>14.找回root密码</title>
      <link href="/2024/02/16/14-%E6%89%BE%E5%9B%9Eroot%E5%AF%86%E7%A0%81/"/>
      <url>/2024/02/16/14-%E6%89%BE%E5%9B%9Eroot%E5%AF%86%E7%A0%81/</url>
      
        <content type="html"><![CDATA[<h1 id="找回root密码"><a href="#找回root密码" class="headerlink" title="找回root密码"></a>找回root密码</h1><h2 id="面试题"><a href="#面试题" class="headerlink" title="面试题"></a>面试题</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/ABBFAB012CBF2DF13C2FECB57D8F4914.png"></p><hr><h2 id="答案"><a href="#答案" class="headerlink" title="答案"></a>答案</h2><h3 id="step1"><a href="#step1" class="headerlink" title="step1"></a>step1</h3><p><strong>开机时， 选项界面 press “e” [注意只有5秒]</strong></p><h3 id="step2"><a href="#step2" class="headerlink" title="step2"></a>step2</h3><p><strong>找到 <code>linux16开头</code>段落，移动下标到  <code>\zh_CN.UTF8</code>后面。空一格。</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/456D8EC021F0AA33D277488F528422D0.png"></p><p><strong>输入：<code>init=/bin/sh。</code>回车。</strong></p><h3 id="step3"><a href="#step3" class="headerlink" title="step3"></a>step3</h3><p>输入完成后，直接按<code>快捷键：Ctrl + x</code> ，<strong>进入单用户模式</strong>。</p><h3 id="step4"><a href="#step4" class="headerlink" title="step4"></a>step4</h3><p>接着，在光标闪烁位置中<strong>输入：<code>mount -o remount,rw /</code></strong> [注意空格！]，回车</p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/F1DB67A6475EA8AAFF183E77ED7D8251.png"></p><h3 id="step5"><a href="#step5" class="headerlink" title="step5"></a>step5</h3><p>在最新的一行，**<code>输入：passwd</code><strong>，完成后回车。</strong>输入密码，然后再次确认密码(最好8位以上)**</p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/E2F53817149E7FB14E2DA2E97F9ABDF7.png"></p><p>密码修改成功后，会显示 passwd…的样式，说明密码修改成功。</p><h3 id="step6"><a href="#step6" class="headerlink" title="step6"></a>step6</h3><p>接着，在鼠标闪烁位置，**<code>输入：touch /.autorelabel</code>**(注意：touch 与 &#x2F; 之间有空格)，按回车键。</p><h3 id="step7"><a href="#step7" class="headerlink" title="step7"></a>step7</h3><p><strong><code>输入：exec /sbin/init</code></strong>(注意：exec 与 &#x2F; 之间有空格)，按回车键,等待系统自动修改密码(时间可能有点长，耐心等待)，完成后，系统会自动重启，<strong>新的密码生效</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/EF9168DE6FD9F7A732D84B298DA02286.png"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>13.指定运行级别</title>
      <link href="/2024/02/16/13-%E6%8C%87%E5%AE%9A%E8%BF%90%E8%A1%8C%E7%BA%A7%E5%88%AB/"/>
      <url>/2024/02/16/13-%E6%8C%87%E5%AE%9A%E8%BF%90%E8%A1%8C%E7%BA%A7%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="指定运行级别"><a href="#指定运行级别" class="headerlink" title="指定运行级别"></a>指定运行级别</h1><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/A91A43F420123ECE49E540B571F692EF.png"></p><hr><h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><h3 id="查看当前用户级别"><a href="#查看当前用户级别" class="headerlink" title="查看当前用户级别"></a>查看当前用户级别</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ systemctl get-default<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="设置当前用户级别"><a href="#设置当前用户级别" class="headerlink" title="设置当前用户级别"></a>设置当前用户级别</h3><p><strong>方法1</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ systemctl set-default muili-user.target                      //设置用户级别为3<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ systemctl set-default graphical.target                       //设置用户级别为5<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p><strong>注意：</strong><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/BDF2B9EDC3054AF7F59A99FF6E4CA2AF.png" alt="" style="zoom: 50%;" /></p></blockquote><p><strong>方法2</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ init <span class="token punctuation">[</span>0123456<span class="token punctuation">]</span>                                               //运行级别3,5最常用<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="应用案例"><a href="#应用案例" class="headerlink" title="应用案例"></a>应用案例</h2><p><strong>在XSHELL上远程登录Linux系统，并查询和更改运行级</strong></p><h3 id="查询运行级别"><a href="#查询运行级别" class="headerlink" title="查询运行级别"></a>查询运行级别</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/6Q8T@8RL4GEMJEHR09_%7BFP1.png"></p><h3 id="更改运行级别"><a href="#更改运行级别" class="headerlink" title="更改运行级别"></a>更改运行级别</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/L8CGF%7BJ8Y5P%600@N7NCI8NPN.png"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>12.用户管理</title>
      <link href="/2024/02/16/12-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/"/>
      <url>/2024/02/16/12-%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h1><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/041D29E0D261FE9E42E253562D1A85D9.png"></p><hr><h2 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h2><h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">useradd</span> 用户名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用案例"><a href="#应用案例" class="headerlink" title="应用案例"></a>应用案例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/C1F0215FAEBE978AD3EF4F3A06C3A768.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808105613284.png" alt="" style="zoom:80%;" /><h3 id="细节说明"><a href="#细节说明" class="headerlink" title="细节说明"></a>细节说明</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/6F531BDCA0DEEBE64E110DD9B22B2431.png"></p><p><strong>举例2：在指定的 家目录&#x2F;home&#x2F;test 下创建用户king</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808110145779.png"></p><hr><h2 id="指定-修改密码"><a href="#指定-修改密码" class="headerlink" title="指定&#x2F;修改密码"></a>指定&#x2F;修改密码</h2><h3 id="基本语法-1"><a href="#基本语法-1" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ password 用户名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用案例-1"><a href="#应用案例-1" class="headerlink" title="应用案例"></a>应用案例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/4888467CD642A0AAEEF1C745C7264012.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808110732358.png" alt="" style="zoom:80%;" /><p><strong>shell登录 milan账号：</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/9478656E47937E570F8B1DCE03F51B32.png" alt="" style="zoom:30%;" /><hr><h2 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h2><h3 id="基本语法-2"><a href="#基本语法-2" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">userdel</span> <span class="token punctuation">[</span>-r<span class="token punctuation">]</span> 用户名                                 //-r会连家目录也删除！ //家目录包含账号的所有代码资料<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="应用案例-2"><a href="#应用案例-2" class="headerlink" title="应用案例"></a>应用案例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/2057E303961414334DE3BA1172282B4C.png"></p><p>1.删除milan，保存家目录</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808112546840.png" alt="" style="zoom:80%;" /><p>2.删除用户以及主目录</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808112914154.png" alt="" style="zoom:80%;" /><h3 id="细节说明-1"><a href="#细节说明-1" class="headerlink" title="细节说明"></a>细节说明</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/78DCA294BD0AEC20BD3336CCB6C4D4C6.png"></p><hr><h2 id="查询用户信息指令"><a href="#查询用户信息指令" class="headerlink" title="查询用户信息指令"></a>查询用户信息指令</h2><h3 id="基本语法-3"><a href="#基本语法-3" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">id</span> 用户名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用案例-3"><a href="#应用案例-3" class="headerlink" title="应用案例"></a>应用案例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/36022A3B622112A23DA50CA8977AE464.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808114621931.png" alt="" style="zoom:80%;" /><h3 id="细节说明-2"><a href="#细节说明-2" class="headerlink" title="细节说明"></a>细节说明</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/3AA73C075EE92A2612A7CEC3A7970347.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808114646973.png" alt="" style="zoom:80%;" /><hr><h2 id="切换用户"><a href="#切换用户" class="headerlink" title="切换用户"></a>切换用户</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/C1CD72D380A2F1F3275C1AA6D385220C.png"></p><h3 id="基本语法-4"><a href="#基本语法-4" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">su</span> - 切换用户名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用案例-4"><a href="#应用案例-4" class="headerlink" title="应用案例"></a>应用案例</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/A1A85A4B93AFBE9433C3D44F44206EAC.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808115328807.png" alt="" style="zoom:80%;" /><h3 id="细节说明-3"><a href="#细节说明-3" class="headerlink" title="细节说明"></a>细节说明</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/19E971738C02A9017E376447EACDF52D.png"></p><hr><h2 id="查看当前用户信息"><a href="#查看当前用户信息" class="headerlink" title="查看当前用户信息"></a>查看当前用户信息</h2><h3 id="基本语法-5"><a href="#基本语法-5" class="headerlink" title="基本语法"></a>基本语法</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">whoami</span> / <span class="token function">who</span> am i                                 //带空格显示登陆时间,ip等信息<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="应用案例-5"><a href="#应用案例-5" class="headerlink" title="应用案例"></a>应用案例</h3><p><strong>查询当店用户信息</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808120013528.png" alt="" style="zoom:80%;" /><hr><h2 id="用户组"><a href="#用户组" class="headerlink" title="用户组"></a>用户组</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/C22037CD5F18527D3B3B756CC95DCEDE.png"></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/57E1D8FC3698D208D8131860F8EAC0C3.png" alt="" style="zoom: 33%;" /><h3 id="基本语法-6"><a href="#基本语法-6" class="headerlink" title="基本语法"></a>基本语法</h3><p><strong>新增组</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">groupadd</span> 组名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>删除组</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">groupdel</span> 组名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>增加用户时直接加上组</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">useradd</span> <span class="token parameter variable">-g</span> 用户组名 用户名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>默认情况下，增加的用户加在 <strong>与用户名同名的组</strong></p></blockquote><p><strong>修改用户组</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">usermod</span> <span class="token parameter variable">-g</span> 用户组 用户名<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="案例演示"><a href="#案例演示" class="headerlink" title="案例演示"></a>案例演示</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808144446933.png" alt="" style="zoom:80%;" /><hr><h2 id="用户和组相关文件"><a href="#用户和组相关文件" class="headerlink" title="用户和组相关文件"></a>用户和组相关文件</h2><h3 id="etc-passwd-文件"><a href="#etc-passwd-文件" class="headerlink" title="&#x2F;etc&#x2F;passwd 文件"></a>&#x2F;etc&#x2F;passwd 文件</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/BCA70EADC13DD0BC2F8E5743EDEA8C09.png"></p><blockquote><p>vim &#x2F;etc&#x2F;passwd ⬇️</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808145718070.png" alt="" style="zoom:80%;" /></blockquote><h3 id="etc-shadow-文件"><a href="#etc-shadow-文件" class="headerlink" title="&#x2F;etc&#x2F;shadow 文件"></a>&#x2F;etc&#x2F;shadow 文件</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/29079501739AFD987C7DB998FFA3CB82.png"></p><blockquote><p>vim &#x2F;etc&#x2F;shadow ⬇️</p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808150023967.png"></p></blockquote><h3 id="etc-group-文件"><a href="#etc-group-文件" class="headerlink" title="&#x2F;etc&#x2F;group 文件"></a>&#x2F;etc&#x2F;group 文件</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/9C33BA804848AC093F46D6A1650BEF90.png"></p><blockquote><p>vim &#x2F;etc&#x2F;group ⬇️</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808150243660.png" alt="" style="zoom:80%;" /></blockquote>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>11.用户登录和注销</title>
      <link href="/2024/02/16/11-%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E5%92%8C%E6%B3%A8%E9%94%80/"/>
      <url>/2024/02/16/11-%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E5%92%8C%E6%B3%A8%E9%94%80/</url>
      
        <content type="html"><![CDATA[<h1 id="用户登录和注销"><a href="#用户登录和注销" class="headerlink" title="用户登录和注销"></a>用户登录和注销</h1><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/962D3B825E0B898BC95969D50B9D666A.png"></p><blockquote><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/37E6A6468062834EEAFFEA32B2236197.png"></p></blockquote><hr><h2 id="使用细节"><a href="#使用细节" class="headerlink" title="使用细节"></a>使用细节</h2><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/7BEA15983E9E756510103947AB302A61.png" alt="" style="zoom: 67%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220808091126667.png"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>10.关机&amp;重启命令</title>
      <link href="/2024/02/16/10-%E5%85%B3%E6%9C%BA-%E9%87%8D%E5%90%AF%E5%91%BD%E4%BB%A4/"/>
      <url>/2024/02/16/10-%E5%85%B3%E6%9C%BA-%E9%87%8D%E5%90%AF%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="关机-重启命令"><a href="#关机-重启命令" class="headerlink" title="关机&amp;重启命令"></a>关机&amp;重启命令</h1><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/3EB81BA1E6BB74FDBC5F598900BB4288.png"></p><blockquote><p>h：halt(停止)                             r：reboot(重启)</p></blockquote><h3 id="注意细节"><a href="#注意细节" class="headerlink" title="注意细节"></a>注意细节</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/7EDC7ED6AEC39F4331AE2D4D284E2B12.png"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>9.Vi与Vim编辑器</title>
      <link href="/2024/02/16/9-Vi%E4%B8%8EVim%E7%BC%96%E8%BE%91%E5%99%A8/"/>
      <url>/2024/02/16/9-Vi%E4%B8%8EVim%E7%BC%96%E8%BE%91%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Vi与Vim编辑器"><a href="#Vi与Vim编辑器" class="headerlink" title="Vi与Vim编辑器"></a>Vi与Vim编辑器</h1><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/8061A92A202F07186252E6B4A6B16274.png"></p><h2 id="1-Vi与Vim常用的三种模式"><a href="#1-Vi与Vim常用的三种模式" class="headerlink" title="1.Vi与Vim常用的三种模式"></a>1.Vi与Vim常用的三种模式</h2><h3 id="1-正常模式-默认模式"><a href="#1-正常模式-默认模式" class="headerlink" title="1.正常模式[默认模式]"></a>1.正常模式[默认模式]</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/E1303355543223B6CCAEB9695FCD3DE0.png"></p><h3 id="2-插入模式"><a href="#2-插入模式" class="headerlink" title="2.插入模式"></a>2.插入模式</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/5C3B478E79C6435225263FC6D8192128.png"></p><h3 id="3-命令行模式"><a href="#3-命令行模式" class="headerlink" title="3.命令行模式"></a>3.命令行模式</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/CF89347E1F96D8FC0D6CFCD999E52C60.png"></p><hr><h2 id="2-快速入门"><a href="#2-快速入门" class="headerlink" title="2.快速入门"></a>2.快速入门</h2><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/38C385C572193EA2312D1FF730D9F21E.png" alt="" style="zoom:50%;" /><hr><h2 id="3-Vi与Vim各个模式的切换图"><a href="#3-Vi与Vim各个模式的切换图" class="headerlink" title="3.Vi与Vim各个模式的切换图"></a>3.Vi与Vim各个模式的切换图</h2><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/D9E464FBC7B1975837FA735004E376C4.png" alt="" style="zoom:50%;" /><hr><h2 id="4-快捷键使用练习-多练"><a href="#4-快捷键使用练习-多练" class="headerlink" title="4.快捷键使用练习[多练]"></a>4.快捷键使用练习[多练]</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/0059A4BB149C2CEDD2071085DC1362F7.png"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>8.远程登录 &amp;&amp; 远程文件传输</title>
      <link href="/2024/02/16/8-%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95-%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/"/>
      <url>/2024/02/16/8-%E8%BF%9C%E7%A8%8B%E7%99%BB%E5%BD%95-%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93/</url>
      
        <content type="html"><![CDATA[<h1 id="远程登录-远程文件传输"><a href="#远程登录-远程文件传输" class="headerlink" title="远程登录 &amp;&amp; 远程文件传输"></a>远程登录 &amp;&amp; 远程文件传输</h1><h2 id="为什么需要远程登录Linux？"><a href="#为什么需要远程登录Linux？" class="headerlink" title="为什么需要远程登录Linux？"></a>为什么需要远程登录Linux？</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/ED7244A74C32ED4537C779C337B1E09E.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/D662EFFF6FCC696B393FB44B7792DEB9.png"></p><blockquote><p>显然，远程登录<strong>要知道ip地址</strong></p><p><strong>Linux指令：查看本机ip地址</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token operator">></span>$ <span class="token function">ifconfig</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/CC908B7C45893F34D8678BF2492F7D11.png"></p></blockquote><hr><h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><h3 id="远程登录工具"><a href="#远程登录工具" class="headerlink" title="远程登录工具"></a>远程登录工具</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/FCB0B99133BB642883D627FAFA1BF476.png"></p><h3 id="远程上传下载文件-Xftp"><a href="#远程上传下载文件-Xftp" class="headerlink" title="远程上传下载文件[Xftp]"></a>远程上传下载文件[Xftp]</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/705F06A6E2E22C2A7A769639A3A5D221.png"></p><hr><h2 id="远程登录-XSHELL"><a href="#远程登录-XSHELL" class="headerlink" title="远程登录[XSHELL]"></a>远程登录[XSHELL]</h2><h3 id="step1：得到Linux系统下的本机ip"><a href="#step1：得到Linux系统下的本机ip" class="headerlink" title="step1：得到Linux系统下的本机ip"></a>step1：得到Linux系统下的本机ip</h3><p><strong>Linux指令：查看本机ip地址</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ifconfig</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/CC908B7C45893F34D8678BF2492F7D11.png"></p><h3 id="step2：ping-ip-看是否成功连接"><a href="#step2：ping-ip-看是否成功连接" class="headerlink" title="step2：ping ip ,看是否成功连接"></a>step2：ping ip ,看是否成功连接</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Microsoft Windows <span class="token punctuation">[</span>版本 <span class="token number">10.0</span>.22000.795<span class="token punctuation">]</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> Microsoft Corporation。保留所有权利。C:<span class="token punctuation">\</span>WINDOWS<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>></span>ping <span class="token number">192.168</span>.159.128正在 Ping <span class="token number">192.168</span>.159.128 具有 <span class="token number">32</span> 字节的数据:来自 <span class="token number">192.168</span>.159.128 的回复: 字节<span class="token operator">=</span><span class="token number">32</span> 时间<span class="token operator">&lt;</span>1ms <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span>来自 <span class="token number">192.168</span>.159.128 的回复: 字节<span class="token operator">=</span><span class="token number">32</span> 时间<span class="token operator">=</span>1ms <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span>来自 <span class="token number">192.168</span>.159.128 的回复: 字节<span class="token operator">=</span><span class="token number">32</span> 时间<span class="token operator">&lt;</span>1ms <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span>来自 <span class="token number">192.168</span>.159.128 的回复: 字节<span class="token operator">=</span><span class="token number">32</span> 时间<span class="token operator">&lt;</span>1ms <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span><span class="token number">192.168</span>.159.128 的 Ping 统计信息:    数据包: 已发送 <span class="token operator">=</span> <span class="token number">4</span>，已接收 <span class="token operator">=</span> <span class="token number">4</span>，丢失 <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>% 丢失<span class="token punctuation">)</span>，往返行程的估计时间<span class="token punctuation">(</span>以毫秒为单位<span class="token punctuation">)</span>:    最短 <span class="token operator">=</span> 0ms，最长 <span class="token operator">=</span> 1ms，平均 <span class="token operator">=</span> 0ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807175328045.png"></p><h3 id="step3-新建"><a href="#step3-新建" class="headerlink" title="step3:新建"></a>step3:新建</h3><p>打开XSHELL。点击<strong>新建</strong>。</p><img src="D:/markdown(typora)使用教程.assets/image-20220807175450624.png" alt="" style="zoom:67%;" /><p><strong>主机号：即Linux系统中 <code>ifconfig</code>得到的 ip地址</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807175754754.png" alt="" style="zoom:67%;" /><p>确定，关闭</p><img src="D:/markdown(typora)使用教程.assets/image-20220807180031125.png" alt="" style="zoom:67%;" /><p><strong>双击会话</strong></p><img src="D:/markdown(typora)使用教程.assets/image-20220807180157920.png" alt="" style="zoom: 50%;" /><blockquote><p><strong>接受并保存：保存记录，下次就不用连接</strong></p><p><strong>一次性接受：下次还要连接</strong></p></blockquote><h3 id="step4：输入Linux系统账号和密码"><a href="#step4：输入Linux系统账号和密码" class="headerlink" title="step4：输入Linux系统账号和密码"></a>step4：输入Linux系统账号和密码</h3><img src="D:/markdown(typora)使用教程.assets/image-20220807180556686.png" alt="" style="zoom:67%;" /><img src="D:/markdown(typora)使用教程.assets/image-20220807180532335.png" alt="" style="zoom:67%;" /><h3 id="step5：登录成功"><a href="#step5：登录成功" class="headerlink" title="step5：登录成功"></a>step5：登录成功</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807181155033.png"></p><hr><h2 id="远程上传下载文件-Xftp-1"><a href="#远程上传下载文件-Xftp-1" class="headerlink" title="远程上传下载文件[Xftp]"></a>远程上传下载文件[Xftp]</h2><h3 id="step1：得到Linux系统下的本机ip-1"><a href="#step1：得到Linux系统下的本机ip-1" class="headerlink" title="step1：得到Linux系统下的本机ip"></a>step1：得到Linux系统下的本机ip</h3><p><strong>Linux指令：查看本机ip地址</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ifconfig</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/CC908B7C45893F34D8678BF2492F7D11.png"></p><h3 id="step2：ping-ip-看是否成功连接-1"><a href="#step2：ping-ip-看是否成功连接-1" class="headerlink" title="step2：ping ip ,看是否成功连接"></a>step2：ping ip ,看是否成功连接</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Microsoft Windows <span class="token punctuation">[</span>版本 <span class="token number">10.0</span>.22000.795<span class="token punctuation">]</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> Microsoft Corporation。保留所有权利。C:<span class="token punctuation">\</span>WINDOWS<span class="token punctuation">\</span>system3<span class="token operator"><span class="token file-descriptor important">2</span>></span>ping <span class="token number">192.168</span>.159.128正在 Ping <span class="token number">192.168</span>.159.128 具有 <span class="token number">32</span> 字节的数据:来自 <span class="token number">192.168</span>.159.128 的回复: 字节<span class="token operator">=</span><span class="token number">32</span> 时间<span class="token operator">&lt;</span>1ms <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span>来自 <span class="token number">192.168</span>.159.128 的回复: 字节<span class="token operator">=</span><span class="token number">32</span> 时间<span class="token operator">=</span>1ms <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span>来自 <span class="token number">192.168</span>.159.128 的回复: 字节<span class="token operator">=</span><span class="token number">32</span> 时间<span class="token operator">&lt;</span>1ms <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span>来自 <span class="token number">192.168</span>.159.128 的回复: 字节<span class="token operator">=</span><span class="token number">32</span> 时间<span class="token operator">&lt;</span>1ms <span class="token assign-left variable">TTL</span><span class="token operator">=</span><span class="token number">64</span><span class="token number">192.168</span>.159.128 的 Ping 统计信息:    数据包: 已发送 <span class="token operator">=</span> <span class="token number">4</span>，已接收 <span class="token operator">=</span> <span class="token number">4</span>，丢失 <span class="token operator">=</span> <span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0</span>% 丢失<span class="token punctuation">)</span>，往返行程的估计时间<span class="token punctuation">(</span>以毫秒为单位<span class="token punctuation">)</span>:    最短 <span class="token operator">=</span> 0ms，最长 <span class="token operator">=</span> 1ms，平均 <span class="token operator">=</span> 0ms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807175328045.png"></p><h3 id="step3-新建-1"><a href="#step3-新建-1" class="headerlink" title="step3:新建"></a>step3:新建</h3><p>打开Xftp。点击&#x3D;&#x3D;<strong>新建</strong>&#x3D;&#x3D;。</p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807181955227.png"></p><p><strong>主机号：即Linux系统中 &#x3D;&#x3D;ifconfig得到的 ip地址&#x3D;&#x3D;</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807182241058.png" alt="" style="zoom:67%;" /><p>确定，关闭</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807182257136.png" alt="" style="zoom:67%;" /><p>点击：连接</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807182357816.png" alt="" style="zoom: 67%;" /><p>一次性接受</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807182429128.png" alt="" style="zoom:67%;" /><h3 id="step4-输入Linux系统账号和密码"><a href="#step4-输入Linux系统账号和密码" class="headerlink" title="step4:输入Linux系统账号和密码"></a>step4:输入Linux系统账号和密码</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807182529873.png" alt="" style="zoom:67%;" /><h3 id="step5-登录成功"><a href="#step5-登录成功" class="headerlink" title="step5:登录成功"></a>step5:登录成功</h3><p><strong>左边是windows桌面，右边是Linux桌面</strong></p><p><strong>选定文件位置，直接拖动&#x2F;右键“传输”。即可传送文件</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807182717047.png"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>7.Linux目录结构</title>
      <link href="/2024/02/16/7-Linux%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/"/>
      <url>/2024/02/16/7-Linux%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux目录结构"><a href="#Linux目录结构" class="headerlink" title="Linux目录结构"></a>Linux目录结构</h1><h2 id="基本介绍"><a href="#基本介绍" class="headerlink" title="基本介绍"></a>基本介绍</h2><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/BC8860FF38CD23C8768AE9FD867BB079.png" alt=""  /><h3 id="示意图"><a href="#示意图" class="headerlink" title="示意图"></a>示意图</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/0AAA45E049494FF7B1CA98ED26490B19.png"></p><hr><h2 id="具体的目录结构-不用背，知道即可"><a href="#具体的目录结构-不用背，知道即可" class="headerlink" title="具体的目录结构(不用背，知道即可)"></a>具体的目录结构(不用背，知道即可)</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/87ED9786DB9752B1F30812D9B39CEF98.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/96A65707359E0FE06ED591723DE9921A.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/19C9DEB919EC0CC3FC44042E491A798B.png"></p><p><strong>举例：</strong></p><p>1.创建用户jack</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">useradd</span> jack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807144236170.png" alt="" style="zoom: 67%;" /><p>2.删除用户jack</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">userdel</span> <span class="token parameter variable">-r</span> jack<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807144536516.png" alt="" style="zoom:67%;" /><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/8C9C253722BD9659B13C65A18549A828.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/8893C92010DD4478A610E304A6CD3EF0.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/0FCE09F6043C25344935E05298E68B15.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/F7B34B3A93B81EF99E05D73B40907E52.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/D30488DB9D90A2877054EFBE274340B1.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/296353B2B9F3FD35859D372A28DF6F86.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240216201818082.png"></p><blockquote><p><strong>这三个目录都不能动</strong></p></blockquote><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/A4E49BCC980066D22F85F5ADB4F300DA.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/679117FE405ECE0E0DF5B8A1FCA918C4.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/8552A3A7665E8EB08C0E62351DAAE494.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/426423CC97ED606E02F5496A2BDA2312.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/DE7045FE06B2FE26E084F3F8CD65CA7B.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/F96C724CC15C6246369584AA7721FB32.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/C4BD3775DFFE8FA11141F43AA5C80EF4.png"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/9972E8D22F1543C25B59BA6BF568C616.png"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>6.vmtools</title>
      <link href="/2024/02/16/6-vmtools/"/>
      <url>/2024/02/16/6-vmtools/</url>
      
        <content type="html"><![CDATA[<h1 id="vmtools"><a href="#vmtools" class="headerlink" title="vmtools"></a>vmtools</h1><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1.介绍"></a>1.介绍</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/292C4098333EEAE974D519A91542DF7C.png"></p><hr><h2 id="2-安装vmtools步骤"><a href="#2-安装vmtools步骤" class="headerlink" title="2.安装vmtools步骤"></a>2.安装vmtools步骤</h2><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/FF45FCF542F555368E07B743777D294E.png" alt="" style="zoom:80%;" /><blockquote><p>新版本VM自动安装</p></blockquote><hr><h2 id="3-共享文件位置"><a href="#3-共享文件位置" class="headerlink" title="3.共享文件位置"></a>3.共享文件位置</h2><p>&#x3D;&#x3D;<strong>主文件夹 -&gt; 其他位置 -&gt; 计算机 -&gt; mnt -&gt; hgfs -&gt; myshare</strong>&#x3D;&#x3D;</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807085433372.png" alt="" style="zoom:80%;" /><hr><h2 id="4-注意事项与细节说明"><a href="#4-注意事项与细节说明" class="headerlink" title="4.注意事项与细节说明"></a>4.注意事项与细节说明</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/131D96BDA7B4B3C2AAB76649D5666F91.png"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>5.虚拟机迁移和删除</title>
      <link href="/2024/02/16/5-%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%81%E7%A7%BB%E5%92%8C%E5%88%A0%E9%99%A4/"/>
      <url>/2024/02/16/5-%E8%99%9A%E6%8B%9F%E6%9C%BA%E8%BF%81%E7%A7%BB%E5%92%8C%E5%88%A0%E9%99%A4/</url>
      
        <content type="html"><![CDATA[<h1 id="虚拟机迁移和删除"><a href="#虚拟机迁移和删除" class="headerlink" title="虚拟机迁移和删除"></a>虚拟机迁移和删除</h1><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/7A606ADD24C427E5FA8E64CD947D9896.png"></p><h2 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h2><h3 id="剪切"><a href="#剪切" class="headerlink" title="剪切"></a>剪切</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807090852620.png" alt="" style="zoom: 67%;" /><h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><p><strong>方式1</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807090949278.png" alt="" style="zoom: 67%;" /><p><strong>方式2</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220807091038292.png" alt="" style="zoom: 67%;" /><blockquote><p>这一步只是删除<strong>文件的指向</strong>，<strong>文件本身</strong>没有被删除(要删除还是方式1)</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>4.虚拟机快照</title>
      <link href="/2024/02/16/4-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%BF%AB%E7%85%A7/"/>
      <url>/2024/02/16/4-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%BF%AB%E7%85%A7/</url>
      
        <content type="html"><![CDATA[<h1 id="虚拟机快照"><a href="#虚拟机快照" class="headerlink" title="虚拟机快照"></a>虚拟机快照</h1><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/DF85657C89008E8112D5210F2AA1EC38.png"></p><blockquote><p><strong>类似于数据库的 rollback，但还能往后滚，甚至能产生分支。多了还占用磁盘空间</strong></p></blockquote><h2 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/F3226598F6D713C4BC9EAA00E24EC993.png"></p><h3 id="step1："><a href="#step1：" class="headerlink" title="step1："></a>step1：</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220806233810162.png" alt="" style="zoom: 67%;" /><h3 id="step2："><a href="#step2：" class="headerlink" title="step2："></a>step2：</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220806233920476.png" alt="" style="zoom: 80%;" /><h3 id="step3：进行一些操作-创建一个文件夹"><a href="#step3：进行一些操作-创建一个文件夹" class="headerlink" title="step3：进行一些操作[创建一个文件夹]"></a>step3：进行一些操作[创建一个文件夹]</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220806234156452.png"></p><h3 id="step4：再拍一个快照"><a href="#step4：再拍一个快照" class="headerlink" title="step4：再拍一个快照"></a>step4：再拍一个快照</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220806234301801.png"></p><h3 id="step5：再进行一次操作"><a href="#step5：再进行一次操作" class="headerlink" title="step5：再进行一次操作"></a>step5：再进行一次操作</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220806235141949.png"></p><h3 id="step6：再拍一个快照"><a href="#step6：再拍一个快照" class="headerlink" title="step6：再拍一个快照"></a>step6：再拍一个快照</h3><h3 id="step7：打开快照管理器"><a href="#step7：打开快照管理器" class="headerlink" title="step7：打开快照管理器"></a>step7：打开快照管理器</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220806235518637.png" alt="" style="zoom:67%;" /><p>step8：点击A，点击<strong>转到</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220806235549930.png" alt="" style="zoom:67%;" /><blockquote><p><strong>系统会重启</strong></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>3.虚拟机克隆</title>
      <link href="/2024/02/16/3-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%85%8B%E9%9A%86/"/>
      <url>/2024/02/16/3-%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%85%8B%E9%9A%86/</url>
      
        <content type="html"><![CDATA[<h1 id="虚拟机克隆"><a href="#虚拟机克隆" class="headerlink" title="虚拟机克隆"></a>虚拟机克隆</h1><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/90004CDA94A9E9C6F2650E44F7E6322E.png"></p><hr><h2 id="方式2演示"><a href="#方式2演示" class="headerlink" title="方式2演示"></a>方式2演示</h2><h3 id="step1："><a href="#step1：" class="headerlink" title="step1："></a>step1：</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220806221303843.png" alt="" style="zoom:67%;" /><h3 id="step2："><a href="#step2：" class="headerlink" title="step2："></a>step2：</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220806221420080.png" alt="" style="zoom:67%;" /><h3 id="step3："><a href="#step3：" class="headerlink" title="step3："></a>step3：</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220806221457005.png" alt="" style="zoom:67%;" /><blockquote><p><strong>本质就是第1种克隆方式</strong></p></blockquote><h3 id="step4："><a href="#step4：" class="headerlink" title="step4："></a>step4：</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220806221657744.png" alt="" style="zoom:67%;" /><h3 id="成功："><a href="#成功：" class="headerlink" title="成功："></a>成功：</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20220806221803634.png" alt="" style="zoom:67%;" />]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2.网络连接的三种方式</title>
      <link href="/2024/02/16/2-%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F/"/>
      <url>/2024/02/16/2-%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E7%9A%84%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="网络连接的三种方式"><a href="#网络连接的三种方式" class="headerlink" title="网络连接的三种方式"></a>网络连接的三种方式</h1><h2 id="1-桥接模式"><a href="#1-桥接模式" class="headerlink" title="1.桥接模式"></a>1.桥接模式</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/7499E9E339455A8549BFAC167703C829.png"></p><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p><strong>同一个网络下ip地址的网络地址(前3个字节)必须相同，主机地址(最后一个字节0~255)不能相同，但最大只有255个，所能同时容纳的主机很少，容易造成ip冲突。</strong></p><hr><h2 id="2-NAT-网络地址转换-模式"><a href="#2-NAT-网络地址转换-模式" class="headerlink" title="2.NAT(网络地址转换)模式"></a>2.NAT(网络地址转换)模式</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/A46C4B9EAADB6089B239439B2479049F.png"></p><hr><h2 id="3-主机模式"><a href="#3-主机模式" class="headerlink" title="3.主机模式"></a>3.主机模式</h2><p><strong>独立的系统，不和外部发生通信</strong></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1.Linux与Unix的关系</title>
      <link href="/2024/02/16/1-Linux%E4%B8%8EUnix%E7%9A%84%E5%85%B3%E7%B3%BB/"/>
      <url>/2024/02/16/1-Linux%E4%B8%8EUnix%E7%9A%84%E5%85%B3%E7%B3%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux与Unix的关系"><a href="#Linux与Unix的关系" class="headerlink" title="Linux与Unix的关系"></a>Linux与Unix的关系</h1><h2 id="1-unix怎么来的"><a href="#1-unix怎么来的" class="headerlink" title="1.unix怎么来的"></a>1.unix怎么来的</h2><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/2EBDCB93E6A61DCBF80BBEFBCA80CE25.png" alt="img" style="zoom:50%;" /><hr><h2 id="2-Linux怎么来的"><a href="#2-Linux怎么来的" class="headerlink" title="2.Linux怎么来的"></a>2.Linux怎么来的</h2><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/243CF83A5A2AF501CCC86A9D02EA9DAF.png" alt="img" style="zoom: 35%;" /><hr><h2 id="3-Linux与Unix关系图"><a href="#3-Linux与Unix关系图" class="headerlink" title="3.Linux与Unix关系图"></a>3.Linux与Unix关系图</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/3AED09E5CB05D5C8530EA45745448BA5.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>0.Linux介绍</title>
      <link href="/2024/02/16/0.Linux%E4%BB%8B%E7%BB%8D/"/>
      <url>/2024/02/16/0.Linux%E4%BB%8B%E7%BB%8D/</url>
      
        <content type="html"><![CDATA[<h1 id="Linux介绍"><a href="#Linux介绍" class="headerlink" title="Linux介绍"></a>Linux介绍</h1><h2 id="1-概述"><a href="#1-概述" class="headerlink" title="1.概述"></a>1.概述</h2><p><img src="D:\markdown(typora)使用教程.assets\2683F7BA416692134E45A0C96255C5A7.png"></p><hr><h2 id="2-Linux之父"><a href="#2-Linux之父" class="headerlink" title="2.Linux之父"></a>2.Linux之父</h2><p><img src="D:\markdown(typora)使用教程.assets\A2259D8123737C9775D672FECEEFDF2D.png"></p><hr><h2 id="3-主要发行版本"><a href="#3-主要发行版本" class="headerlink" title="3.主要发行版本"></a>3.主要发行版本</h2><p><img src="D:\markdown(typora)使用教程.assets\BB0902C19CE1F75DEE276585593DC80A.png"></p><blockquote><p><strong>Linux</strong>是一个<strong>内核</strong>，其他各种发行版都是在内核上的进一步<strong>封装</strong></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> centos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>泛型依赖注入</title>
      <link href="/2024/02/16/%E6%B3%9B%E5%9E%8B%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/"/>
      <url>/2024/02/16/%E6%B3%9B%E5%9E%8B%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="泛型依赖注入"><a href="#泛型依赖注入" class="headerlink" title="泛型依赖注入"></a>泛型依赖注入</h1><p>[TOC]</p><h2 id="基本说明"><a href="#基本说明" class="headerlink" title="基本说明"></a>基本说明</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240114195428691.png"></p><h3 id="案例分析"><a href="#案例分析" class="headerlink" title="案例分析"></a>案例分析</h3><p><strong>要求：将多个Dao对象作为属性注入到多个Service对象中，怎么做？</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240114225329629.png"></p><p><strong><code>传统方法</code>：将多个Dao对象装配&#x2F;注入到Service对象中 -&gt; 分别对Dao对象标识id并引用(&#x3D;&#x3D;问题：麻烦&#x3D;&#x3D;)</strong></p><p><strong><code>泛型依赖注入</code>：Service和Dao都有自己父类 -&gt; 父类之间装配(BaseDao装配到BaseService，形式上，因为不会实例化)，<u>在得到BaseService对象时传入泛型(Dao类)</u>，即可完成装配。</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240114231608796.png" alt="" style="zoom: 67%;" /><p>Book类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>depinjection</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Book</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Phone类</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">package com.lhyedu.spring.depinjection;public class Phone &#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>BaseDao类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>depinjection</span><span class="token punctuation">;</span><span class="token comment">//自定义泛型类，子类继承时就要传参数</span><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">BaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>BookDao类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>depinjection</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhoneDao</span> <span class="token keyword">extends</span> <span class="token class-name">BaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"PhoneDao 的 save()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>PhoneDao类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>depinjection</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhoneDao</span> <span class="token keyword">extends</span> <span class="token class-name">BaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"PhoneDao 的 save()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>BaseService类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>depinjection</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Autowired</span><span class="token punctuation">(</span>required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>    <span class="token keyword">private</span> <span class="token class-name">BaseDao</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> baseDao<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        baseDao<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>BookService类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>depinjection</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BookService</span> <span class="token keyword">extends</span> <span class="token class-name">BaseService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token comment">//通过泛型传入T=Book</span>    <span class="token comment">//父类BaseService有BaseDao属性</span>    <span class="token comment">//BaseDao&lt;T>可将泛型T注入子类</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>PhoneService类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>depinjection</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PhoneService</span> <span class="token keyword">extends</span> <span class="token class-name">BaseService</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Phone</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span><span class="token comment">//通过泛型传入T=Phone</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//通过"泛型依赖"配置bean</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProByDependencyInjection</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">PhoneService</span> phoneService <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"phoneService"</span><span class="token punctuation">,</span> <span class="token class-name">PhoneService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        phoneService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//实际调用属性phoneDao的save方法</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">PhoneDao</span> 的 <span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ioc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring模拟-Spring基于注解配置的程序</title>
      <link href="/2024/02/16/Spring%E6%A8%A1%E6%8B%9F-Spring%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E7%9A%84%E7%A8%8B%E5%BA%8F/"/>
      <url>/2024/02/16/Spring%E6%A8%A1%E6%8B%9F-Spring%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E7%9A%84%E7%A8%8B%E5%BA%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring模拟—Spring基于注解配置的程序"><a href="#Spring模拟—Spring基于注解配置的程序" class="headerlink" title="Spring模拟—Spring基于注解配置的程序"></a>Spring模拟—Spring基于注解配置的程序</h1><ol><li><strong>自己写一个简单的Spring容器，通过读取类的注解(@Component @Controller @Service @Reponsitory)，将对象注入到IOC容器中。</strong></li><li><strong>也就是说。不使用Spring原生框架，自己使用IO+Annotation+反射+集合 实现，打通Spring注解方式的计数痛点。</strong></li></ol><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240109092903430.png" alt="image-20240109092903430"></p><hr><p><strong>项目结构：</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110105107756.png" alt="" style="zoom: 67%;" /><p><strong>MyComponent类</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>component</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token comment">/** * @Component:标识该类是个组件，是一个通用的注解 */</span><span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">"lhy1"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyComponent</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ComponentScan注解</strong></p><blockquote><p>&#x3D;&#x3D;<strong>自定义注解</strong>&#x3D;&#x3D;</p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">ElementType</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Retention</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RetentionPolicy</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Target</span></span><span class="token punctuation">;</span><span class="token comment">//@Target(ElementType.TYPE)指定我们的ComponentScan注解可以修饰Type程序元素</span><span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">)</span><span class="token comment">//@Retention(RetentionPolicy.RUNTIME)指定注解保留范围</span><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">ComponentScan</span> <span class="token punctuation">&#123;</span>    <span class="token class-name">String</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">""</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>LhySpringConfig类</strong></p><blockquote><p><strong>作用：类似于Spring原生框架下的 <em>&#x3D;&#x3D;Beans.xml文件&#x3D;&#x3D;</em></strong></p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation</span><span class="token punctuation">;</span><span class="token comment">/** * 这是一个配置之类 * 作用：类似：原生Spring框架的 beans.xml文件 */</span><span class="token annotation punctuation">@ComponentScan</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"com.lhyedu.spring.component"</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LhySpringConfig</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>LhySpringApplicationContext类</strong></p><blockquote><p><strong>作用：类似于Spring原生框架下的 <em>&#x3D;&#x3D;ioc容器&#x3D;&#x3D;</em></strong></p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URL</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">ConcurrentHashMap</span></span><span class="token punctuation">;</span><span class="token comment">/** * 类似于Spring原生框架的 IOC */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LhySpringApplicationContext</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Class</span> configClass<span class="token punctuation">;</span>    <span class="token comment">//ioc存放的就是通过反射创建的对象</span>    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> ioc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//构造器</span>    <span class="token keyword">public</span> <span class="token class-name">LhySpringApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">Class</span> configClass<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>configClass <span class="token operator">=</span> configClass<span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"this.configClass = "</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configClass<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//获取要扫描的包</span>        <span class="token comment">//1.得到configClass的 @ComponentScan(value = "com.lhyedu.spring.component")注解</span>        <span class="token class-name">ComponentScan</span> componentScan <span class="token operator">=</span>                <span class="token punctuation">(</span><span class="token class-name">ComponentScan</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>configClass<span class="token punctuation">.</span><span class="token function">getDeclaredAnnotation</span><span class="token punctuation">(</span><span class="token class-name">ComponentScan</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.通过ComponentScan的value得到要扫描的包</span>        <span class="token class-name">String</span> path <span class="token operator">=</span> componentScan<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3.获取扫描路径下的所有类文件(.class文件)</span>        <span class="token comment">//(1)先要得到类的加载器</span>        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token class-name">LhySpringApplicationContext</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//(2)通过类加载器 获取到要扫描包的url</span>        <span class="token comment">//将"com.lhyedu.spring.component"换为"com/lhyedu/spring/component"</span>        path <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//file:/D:/lhy_spring/spring5/out/production/spring5/com/lhyedu/spring/component</span>        <span class="token class-name">URL</span> resource <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//3.将要加载的资源路径下的文件进行遍历(I/O)</span>        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">getFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//文件可能是:普通文件/目录文件</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//若为目录文件</span>            <span class="token class-name">File</span><span class="token punctuation">[</span><span class="token punctuation">]</span> files <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">listFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">File</span> f <span class="token operator">:</span> files<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token comment">//获取当前目录的所有文件(.class文件)</span>                <span class="token class-name">String</span> fileAbsolutePath <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment">// System.out.println("======================================");</span>                <span class="token comment">//System.out.println("文件的绝对路径=" + fileAbsolutePath);</span>                <span class="token comment">//(1)获取类名</span>                <span class="token comment">//file:/D:/.../com/lhyedu/spring/component/UserDao.class</span>                <span class="token comment">//切割成:UserDao</span>                <span class="token class-name">String</span> className <span class="token operator">=</span> fileAbsolutePath                        <span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>fileAbsolutePath<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>                                fileAbsolutePath<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">".class"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//className = UserDao</span>                <span class="token comment">//(2)获取类的全路径(全类名)</span>                <span class="token class-name">String</span> classFullPath <span class="token operator">=</span>                        path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"."</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"."</span> <span class="token operator">+</span> className<span class="token punctuation">;</span>                <span class="token comment">//(3)判断该类是否需要注入到容器中(过滤没加注解的类)</span>                <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>                    <span class="token comment">//这是就得到了该类(classFullPath)对应的class对象</span>                    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> aClass <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>classFullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">//判断是否有注解</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>aClass<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">Component</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token operator">||</span>                        aClass<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">Controller</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token operator">||</span>                        aClass<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">Service</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span> <span class="token operator">||</span>                        aClass<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">Repository</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                        <span class="token comment">//将注解的value设为对象的名字</span>                        <span class="token comment">//仅以Component为例，其他同理...</span>                        <span class="token keyword">if</span> <span class="token punctuation">(</span>aClass<span class="token punctuation">.</span><span class="token function">isAnnotationPresent</span><span class="token punctuation">(</span><span class="token class-name">Component</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                            <span class="token class-name">Component</span> component <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">getDeclaredAnnotation</span><span class="token punctuation">(</span><span class="token class-name">Component</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token class-name">String</span> id <span class="token operator">=</span> component<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                                className <span class="token operator">=</span> id<span class="token punctuation">;</span>                            <span class="token punctuation">&#125;</span>                        <span class="token punctuation">&#125;</span>                        <span class="token comment">//这是就可以反射对象，并放入容器中</span>                        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>classFullPath<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token class-name">Object</span> instance <span class="token operator">=</span> clazz<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">//放入到容器中</span>                        ioc<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> instance<span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">&#125;</span>                <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> ioc<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Test类(主方法)</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//这里相当于：</span>        <span class="token comment">//ApplicationContext ioc =</span>        <span class="token comment">//    new ClassPathXmlApplicationContext("beans03.xml");</span>        <span class="token class-name">LhySpringApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">LhySpringApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">LhySpringConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Object</span> bean <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"lhy1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>运行结果</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">this</span><span class="token punctuation">.</span>configClass <span class="token operator">=</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span>LhySpringConfig</span>com<span class="token operator">/</span>lhyedu<span class="token operator">/</span>spring<span class="token operator">/</span>component<span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>component<span class="token punctuation">.</span></span>MyComponent</span><span class="token annotation punctuation">@30f39991</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110105601810.png"></p>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ioc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring配置Bean</title>
      <link href="/2024/02/16/Spring%E9%85%8D%E7%BD%AEBean/"/>
      <url>/2024/02/16/Spring%E9%85%8D%E7%BD%AEBean/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring配置Bean"><a href="#Spring配置Bean" class="headerlink" title="Spring配置Bean"></a>Spring配置Bean</h1><p>[TOC]</p><p><strong>以Monster类为例</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Monster</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> monsterId<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> skill<span class="token punctuation">;</span>    <span class="token comment">//无参构造器一定要写，反射时需要使用无参构造器！！！</span>    <span class="token keyword">public</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> monsterId<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> skill<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>monsterId <span class="token operator">=</span> monsterId<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>skill <span class="token operator">=</span> skill<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//set方法一定要写，反射时用这个方法初始化类的属性！！！</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMonsterId</span><span class="token punctuation">(</span><span class="token keyword">int</span> monsterId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>monsterId <span class="token operator">=</span> monsterId<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSkill</span><span class="token punctuation">(</span><span class="token class-name">String</span> skill<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>skill <span class="token operator">=</span> skill<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Monster&#123;"</span> <span class="token operator">+</span>                <span class="token string">"monsterId='"</span> <span class="token operator">+</span> monsterId <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>                <span class="token string">", name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>                <span class="token string">", skill='"</span> <span class="token operator">+</span> skill <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>                <span class="token char">'&#125;'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="基于xml文件配置"><a href="#基于xml文件配置" class="headerlink" title="基于xml文件配置"></a>基于xml文件配置</h2><h3 id="1-创建Bean对象"><a href="#1-创建Bean对象" class="headerlink" title="1.创建Bean对象"></a>1.创建Bean对象</h3><h4 id="①通过类型获取bean"><a href="#①通过类型获取bean" class="headerlink" title="①通过类型获取bean"></a>①通过类型获取bean</h4><p><strong>要求ioc容器中的同一个类的bean只能有一个，否则会抛出NoUniqueBeanDefinitionException！</strong></p><blockquote><p><strong>应用场景：比如XxxAction&#x2F;Servlet&#x2F;Controller在一个线程中只需要一个对象实例(单例)</strong></p></blockquote><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterId<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>白骨精<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>skill<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>吃人<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanByConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Monster</span> bean <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">Monster</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>bean<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Monster</span><span class="token punctuation">&#123;</span>monsterId<span class="token operator">=</span><span class="token char">'2'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token char">'蜘蛛精'</span><span class="token punctuation">,</span> skill<span class="token operator">=</span><span class="token char">'吐丝'</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="②通过构造器配置bean"><a href="#②通过构造器配置bean" class="headerlink" title="②通过构造器配置bean"></a>②通过构造器配置bean</h4><p>方法1</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--在Spring的IOC容器中，通过 构造器 配置bean--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Monster<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster03<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--index标识 构造器的参数下标--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>蜘蛛精<span class="token punctuation">"</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>吐丝<span class="token punctuation">"</span></span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>方法2</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Monster<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster04<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--index标识 构造器的参数下标--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.Integer<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>白骨精<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.String<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>白骨鞭<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.lang.String<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanByConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Monster</span> monster03 <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"monster03"</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>monster03<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Monster</span> monster04 <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"monster04"</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>monster04<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Monster</span><span class="token punctuation">&#123;</span>monsterId<span class="token operator">=</span><span class="token char">'2'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token char">'蜘蛛精'</span><span class="token punctuation">,</span> skill<span class="token operator">=</span><span class="token char">'吐丝'</span><span class="token punctuation">&#125;</span><span class="token class-name">Monster</span><span class="token punctuation">&#123;</span>monsterId<span class="token operator">=</span><span class="token char">'3'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token char">'白骨精'</span><span class="token punctuation">,</span> skill<span class="token operator">=</span><span class="token char">'白骨鞭'</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-注入其他bean对象-常用"><a href="#2-注入其他bean对象-常用" class="headerlink" title="2.注入其他bean对象(常用)"></a>2.注入其他bean对象(常用)</h3><p><strong>ioc容器中的某个bean对象的业务逻辑需要引用到ioc容器的另一个bean对象</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240111153013789.png" alt="" style="zoom:50%;" /><p>MemberDAOImpl类(Dao层)</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token comment">//Dao类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberDAOImpl</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//构造器</span>    <span class="token keyword">public</span> <span class="token class-name">MemberDAOImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"MemberDAOImpl 构造器..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"MemberDAOImpl add方法..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>MemberServiceImpl类(Service层)</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">MemberDAOImpl</span></span><span class="token punctuation">;</span><span class="token comment">//Service层</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberServiceImpl</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">MemberDAOImpl</span> memberDAO<span class="token punctuation">;</span><span class="token comment">//属性:引用DAO层对象</span>    <span class="token comment">//getter&amp;setter</span>    <span class="token keyword">public</span> <span class="token class-name">MemberDAOImpl</span> <span class="token function">getMemberDAO</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> memberDAO<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMemberDAO</span><span class="token punctuation">(</span><span class="token class-name">MemberDAOImpl</span> memberDAO<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>memberDAO <span class="token operator">=</span> memberDAO<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">//调用Dao层的属性的方法！</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"MemberServiceImpl add方法..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        memberDAO<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>beans.xml</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token constant">DAO</span>层<span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"memberDAO"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.lhyedu.spring.dao.MemberDAOImpl"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token class-name">Service</span>层<span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"ms"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.lhyedu.spring.Service.MemberServiceImpl"</span><span class="token operator">></span>    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>property标签内的ref标签，填引用的 对象id<span class="token operator">--</span><span class="token operator">></span>    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"memberDAO"</span> ref<span class="token operator">=</span><span class="token string">"memberDAO"</span><span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanByRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">MemberServiceImpl</span> ms <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"ms"</span><span class="token punctuation">,</span> <span class="token class-name">MemberServiceImpl</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        ms<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">MemberDAOImpl</span> 构造器<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token class-name">MemberServiceImpl</span> add方法<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token class-name">MemberDAOImpl</span> add方法<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="3-注入内部bean对象"><a href="#3-注入内部bean对象" class="headerlink" title="3.注入内部bean对象"></a>3.注入内部bean对象</h3><p><strong>直接将某个bean 作为属性(内部bean对象)注入另一个bean中。</strong></p><p>以前面的MemberDAOImpl类(Dao层)和MemberServiceImpl类(Service层)为例：</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ms2<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.Service.MemberServiceImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberDAO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token comment">&lt;!--注入一个内部bean--></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.dao.MemberDAOImpl<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><u>以Master类为例</u></strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Master</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> monsterList<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">></span></span> monsterMap<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> monsterSet<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> monsterName<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Properties</span> pros<span class="token punctuation">;</span><span class="token comment">//HashTable的子类，是key-value的形式</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMonsterList</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> monsterList<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>monsterList <span class="token operator">=</span> monsterList<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMonsterMap</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">></span></span> monsterMap<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>monsterMap <span class="token operator">=</span> monsterMap<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMonsterSet</span><span class="token punctuation">(</span><span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> monsterSet<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>monsterSet <span class="token operator">=</span> monsterSet<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMonsterName</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> monsterName<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>monsterName <span class="token operator">=</span> monsterName<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPros</span><span class="token punctuation">(</span><span class="token class-name">Properties</span> pros<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>pros <span class="token operator">=</span> pros<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="①注入List属性"><a href="#①注入List属性" class="headerlink" title="①注入List属性"></a>①注入List属性</h4><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--配置Master对象--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Master<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>master<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>太上老君<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!--给List属性赋值--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterList<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>list</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster01<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster02<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>老鼠精<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>list</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="②注入Map属性"><a href="#②注入Map属性" class="headerlink" title="②注入Map属性"></a>②注入Map属性</h4><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--配置Master对象--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Master<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>master<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>太上老君<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!--给Map属性赋值--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterMap<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>map</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>entry</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>key</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--key--></span>                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>monsterket01<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>key</span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster01<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment">&lt;!--value--></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>entry</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>map</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="③注入Set属性"><a href="#③注入Set属性" class="headerlink" title="③注入Set属性"></a>③注入Set属性</h4><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--配置Master对象--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Master<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>master<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>太上老君<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!--给Set属性赋值--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterSet<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ref</span> <span class="token attr-name">bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster01<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>牛魔王<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterId<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>999<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>skill<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>unknown<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="④注入Array-数组-属性"><a href="#④注入Array-数组-属性" class="headerlink" title="④注入Array(数组)属性"></a>④注入Array(数组)属性</h4><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--配置Master对象--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Master<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>master<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>太上老君<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!--给Array(数组)属性赋值--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterName<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>array</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>金角大王<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">></span></span>银角大王<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>array</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="⑤注入Properties属性"><a href="#⑤注入Properties属性" class="headerlink" title="⑤注入Properties属性"></a>⑤注入Properties属性</h4><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--配置Master对象--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Master<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>master<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>太上老君<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!--给Properties属性赋值--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pros<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>props</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>k1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Java工程师<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>k2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>前端工程师<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>prop</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>k3<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>大数据工程师<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>prop</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>props</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-级联属性赋值"><a href="#4-级联属性赋值" class="headerlink" title="4.级联属性赋值"></a>4.级联属性赋值</h3><p><strong>spring的ioc容器，可以&#x3D;&#x3D;直接给bean对象的属性的属性赋值&#x3D;&#x3D;，即：级联属性赋值</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240111210408994.png" alt="" style="zoom:50%;" /><p>Dept类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span><span class="token comment">//部门类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dept</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Dept&#123;"</span> <span class="token operator">+</span>                <span class="token string">"name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>                <span class="token char">'&#125;'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Emp类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span><span class="token comment">//员工类</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Emp</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Dept</span> dept<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Emp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Dept</span> <span class="token function">getDept</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> dept<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDept</span><span class="token punctuation">(</span><span class="token class-name">Dept</span> dept<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>dept <span class="token operator">=</span> dept<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Emp&#123;"</span> <span class="token operator">+</span>                <span class="token string">"name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>                <span class="token string">", dept="</span> <span class="token operator">+</span> dept <span class="token operator">+</span>                <span class="token char">'&#125;'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--配置Dept对象--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Dept<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dept<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--配置Emp对象--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Emp<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>emp<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--给Emp类的 属性的属性赋值--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lhy<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dept<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dept<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token comment">&lt;!--这里希望给dept的name属性赋值[级联属性赋值] -> 格式：--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dept.name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Java开发部门<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-JAVA" data-language="JAVA"><code class="language-JAVA">public class SpringBeanTest &#123;    @Test    public void setProByRelation() &#123;        ApplicationContext ioc &#x3D;                new ClassPathXmlApplicationContext(&quot;beans.xml&quot;);        Emp emp &#x3D; ioc.getBean(&quot;emp&quot;, Emp.class);        System.out.println(emp);    &#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Emp</span><span class="token punctuation">&#123;</span>name<span class="token operator">=</span><span class="token char">'lhy'</span><span class="token punctuation">,</span> dept<span class="token operator">=</span><span class="token class-name">Dept</span><span class="token punctuation">&#123;</span>name<span class="token operator">=</span>'<span class="token class-name">Java</span>开发部门'<span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="5-工厂模式获取bean对象"><a href="#5-工厂模式获取bean对象" class="headerlink" title="5.工厂模式获取bean对象"></a>5.工厂模式获取bean对象</h3><h4 id="①静态工厂获取bean对象"><a href="#①静态工厂获取bean对象" class="headerlink" title="①静态工厂获取bean对象"></a>①静态工厂获取bean对象</h4><p><strong>在spring的ioc容器，可以通过<u>静态工厂</u>获取bean对象。</strong></p><p>静态工厂类：MyStaticFactory</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>factory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Monster</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span><span class="token comment">//静态工厂类，可以返回Monster对象</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyStaticFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">></span></span> monsterMap<span class="token punctuation">;</span>    <span class="token comment">//使用 静态代码块 进行初始化</span>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>        monsterMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        monsterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"monster_01"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"黄袍怪"</span><span class="token punctuation">,</span> <span class="token string">"一阳指"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        monsterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"monster_02"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"九头金雕"</span><span class="token punctuation">,</span> <span class="token string">"如来神掌"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//[重点！]提供一个方法返回Monster对象</span>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Monster</span> <span class="token function">getMonster</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> monsterMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--配置monster对象，通过静态工厂获取--></span><span class="token comment">&lt;!--重点！！！    1.class标签：填写 静态工厂类的全类名    2.factory-method标签：填写获取对象的方法--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>m1<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.factory.MyStaticFactory<span class="token punctuation">"</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getMonster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--constructor-arg:factory-method方法的参数--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster_01<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getBeanByStaticFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Monster</span> m1 <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"m1"</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Monster</span><span class="token punctuation">&#123;</span>monsterId<span class="token operator">=</span><span class="token char">'100'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token char">'黄袍怪'</span><span class="token punctuation">,</span> skill<span class="token operator">=</span><span class="token char">'一阳指'</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="②实例工厂获取bean对象"><a href="#②实例工厂获取bean对象" class="headerlink" title="②实例工厂获取bean对象"></a>②实例工厂获取bean对象</h4><p><strong>在spring的ioc容器，可以通过<u>实例工厂</u>获取bean对象。</strong></p><p>静态工厂类：MyInstanceFactory</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>factory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Monster</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span><span class="token comment">//实例工厂类，可以返回Monster对象</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyInstanceFactory</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span>  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">></span></span> monsterMap<span class="token punctuation">;</span>    <span class="token comment">//使用 静态代码块 进行初始化</span>    <span class="token punctuation">&#123;</span>        monsterMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        monsterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"monster_01"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"黄袍怪"</span><span class="token punctuation">,</span> <span class="token string">"一阳指"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        monsterMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"monster_02"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"九头金雕"</span><span class="token punctuation">,</span> <span class="token string">"如来神掌"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Monster</span> <span class="token function">getMonster</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> monsterMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--配置monster对象，通过实例工厂获取--></span><span class="token comment">&lt;!--1.先配置实例工厂类的bean--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mif<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.factory.MyInstanceFactory<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment">&lt;!--2.再配置要实例工厂返回的类对象        factory-bean：需要使用的实例工厂的bean        factory-method标签：填写获取对象的方法--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>m2<span class="token punctuation">"</span></span> <span class="token attr-name">factory-bean</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mif<span class="token punctuation">"</span></span> <span class="token attr-name">factory-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getMonster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--constructor-arg:factory-method方法的参数--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster_01<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getBeanByInstanceFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Monster</span> m2 <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"m2"</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>m2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Monster</span><span class="token punctuation">&#123;</span>monsterId<span class="token operator">=</span><span class="token char">'200'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token char">'九头金雕'</span><span class="token punctuation">,</span> skill<span class="token operator">=</span><span class="token char">'如来神掌'</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="③通过FactoryBean获取对象-重点"><a href="#③通过FactoryBean获取对象-重点" class="headerlink" title="③通过FactoryBean获取对象(重点)"></a>③通过FactoryBean获取对象(重点)</h4><p><strong>在Spring的ioc容器，通过FactoryBean获取bean对象(重点)。</strong></p><p><strong>通过创建 ：类 implements FactoryBean<Monster>。维护一个<code>Map</code>和<code>key</code>属性&#x3D;&#x3D;，&#x3D;&#x3D;并实现以下三个方法：</strong></p><ol><li><code>getObject()</code>：返回 Map属性中与keyVal对应的 对象</li><li><code>getObjectType()</code>：返回 Map属性中value的.class对象</li><li><code>isSingleton()</code>：是否以单例形式保存bean对象</li></ol><p>MyFactoryBean类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>factory</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Monster</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">FactoryBean</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyFactoryBean</span> <span class="token keyword">implements</span> <span class="token class-name">FactoryBean</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Monster</span><span class="token punctuation">></span></span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> key<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">></span></span> monster_map<span class="token punctuation">;</span>    <span class="token punctuation">&#123;</span>        monster_map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        monster_map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"monster03"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">"黄袍怪"</span><span class="token punctuation">,</span> <span class="token string">"一阳指"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        monster_map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"monster04"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"九头金雕"</span><span class="token punctuation">,</span> <span class="token string">"如来神掌"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//返回 Map属性中与keyVal对应的 对象</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Monster</span> <span class="token function">getObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> monster_map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//返回 Map属性中value的.class对象</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">getObjectType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token class-name">Monster</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//是否以单例形式保存bean对象</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--配置Monster对象，通过FactoryBean获取--></span><span class="token comment">&lt;!--class：指定使用的FactoryBean    name="key"：标识属性key; value="monster04":key的值--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster_04<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.factory.MyFactoryBean<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>key<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster04<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getBeanByFactoryBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Monster</span> my_monster_05 <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"my_monster_05"</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>my_monster_05<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Monster</span><span class="token punctuation">&#123;</span>monsterId<span class="token operator">=</span><span class="token char">'100'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token char">'黄袍怪'</span><span class="token punctuation">,</span> skill<span class="token operator">=</span><span class="token char">'一阳指'</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="Bean相关"><a href="#Bean相关" class="headerlink" title="Bean相关"></a>Bean相关</h2><h3 id="1-bean配置信息重用-继承"><a href="#1-bean配置信息重用-继承" class="headerlink" title="1.bean配置信息重用(继承)"></a>1.bean配置信息重用(继承)</h3><p><strong>在spring的ioc容器中，提供了一种继承的方式来实现bean配置信息的重用。&#x3D;&#x3D;&gt;parent标签</strong></p><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup">    <span class="token comment">&lt;!--配置Monster对象--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster04<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterId<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>蜈蚣精<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>skill<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>哲人<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--再配置一个Monster对象        但这个对象的属性值 和monster04一样！！        parent标签:表示与parent="~"对象的属性一致--></span><span class="token comment">&lt;!--注意：当再bean标签中加入 abstract="true"后，这个bean只能被继承，不能实例化！--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster05<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Monster<span class="token punctuation">"</span></span> <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster04<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getBeanByExtend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"monster04"</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"monster05"</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Monster</span><span class="token punctuation">&#123;</span>monsterId<span class="token operator">=</span><span class="token char">'10'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token char">'蜈蚣精'</span><span class="token punctuation">,</span> skill<span class="token operator">=</span><span class="token char">'哲人'</span><span class="token punctuation">&#125;</span><span class="token class-name">Monster</span><span class="token punctuation">&#123;</span>monsterId<span class="token operator">=</span><span class="token char">'10'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token char">'蜈蚣精'</span><span class="token punctuation">,</span> skill<span class="token operator">=</span><span class="token char">'哲人'</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-bean创建顺序"><a href="#2-bean创建顺序" class="headerlink" title="2.bean创建顺序"></a>2.bean创建顺序</h3><h4 id="①beans-xml解析顺序"><a href="#①beans-xml解析顺序" class="headerlink" title="①beans.xml解析顺序"></a>①beans.xml解析顺序</h4><p>Test1类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test1</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Test1构造器被调用..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Test2类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test2</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token class-name">Test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Test2构造器被调用..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><u><strong>在Spring的ioc容器中，默认是按照配置的顺序创建bean对象。</strong></u></p><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--ioc容器中，默认是按照配置的顺序创建bean对象(创建t1->创建t2)--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>t1<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Test1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>t2<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Test2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getBeanByCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Test1</span>构造器被调用<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token class-name">Test2</span>构造器被调用<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><u><strong>根据<code>depends-on</code>标签，可指定bean初始化的顺序(依赖关系)。</strong></u></p><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--depends-on="t2"标签:先创建t2->再创建t1--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>t1<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Test1<span class="token punctuation">"</span></span> <span class="token attr-name">depends-on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>t2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>t2<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Test2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getBeanByCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">Test2</span>构造器被调用<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token class-name">Test1</span>构造器被调用<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="②bean对象の创建顺序"><a href="#②bean对象の创建顺序" class="headerlink" title="②bean对象の创建顺序"></a>②bean对象の创建顺序</h4><p><strong>分析两个bean创建的顺序是什么？</strong></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--配置MemberDao对象--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.dao.MemberDAOImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberDAO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.Service.MemberServiceImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberDAO<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberDAO<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li><strong>先创建 id&#x3D;memberDAO</strong></li><li><strong>再创建 id&#x3D;memberService</strong></li><li><strong>再调用memberService.setMemberDAO()完成引用</strong></li></ol><p><strong>分析两个bean创建的顺序是什么？</strong></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.Service.MemberServiceImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberService<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberDAO<span class="token punctuation">"</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberDAO<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token comment">&lt;!--配置MemberDao对象--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.dao.MemberDAOImpl<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>memberDAO<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li><strong>先创建 id&#x3D;memberService</strong></li><li><strong>再创建 id&#x3D;memberDAO</strong></li><li><strong>再调用memberService.setMemberDAO()完成引用</strong></li></ol><blockquote><p><strong>总结：先按xml顺序创建bean对象；再通过反射，根据属性引用调用setter方法(防止空引用)</strong></p></blockquote><h3 id="3-bean的单例-多例"><a href="#3-bean的单例-多例" class="headerlink" title="3.bean的单例&amp;多例"></a>3.bean的单例&amp;多例</h3><p>以以下测试文件为例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">Integer</span> id<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">Cat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"构造器被调用.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setId</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> id<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Cat&#123;"</span> <span class="token operator">+</span>                <span class="token string">"id="</span> <span class="token operator">+</span> id <span class="token operator">+</span>                <span class="token string">", name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>                <span class="token char">'&#125;'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">getBeanBySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"cat0"</span><span class="token punctuation">,</span> <span class="token class-name">Cat</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><code>单例模式</code>：在spring的ioc容器，在默认是按照单例创建(<code>scope=&quot;singleton&quot;</code>)的，即配置一个bean对象后，ioc容器只会创建一个bean实例。</strong></p><p>beans.xml</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>默认情况下，scope<span class="token operator">=</span><span class="token string">"singleton"</span><span class="token punctuation">(</span>单例<span class="token punctuation">)</span><span class="token operator">--</span><span class="token operator">></span><span class="token operator">&lt;</span>bean id<span class="token operator">=</span><span class="token string">"cat0"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.lhyedu.spring.bean.Cat"</span><span class="token operator">></span>    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"id"</span> value<span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">/</span><span class="token operator">></span>    <span class="token operator">&lt;</span>property name<span class="token operator">=</span><span class="token string">"name"</span> value<span class="token operator">=</span><span class="token string">"小花猫"</span><span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>bean<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>运行结果：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">构造器被调用<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment">//只创造了一个Cat对象</span><span class="token class-name">Cat</span><span class="token punctuation">&#123;</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token char">'小花猫'</span><span class="token punctuation">&#125;</span><span class="token class-name">Cat</span><span class="token punctuation">&#123;</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token char">'小花猫'</span><span class="token punctuation">&#125;</span><span class="token class-name">Cat</span><span class="token punctuation">&#123;</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token char">'小花猫'</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong><code>多例模式</code>：如果希望ioc容器配置某个bean对象，是以多个实例形式创建的则可以通过配置<code>scope=&quot;prototype&quot;</code></strong></p><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--scope="prototype"(原型)，每次getBean都创建一个新对象--></span><span class="token comment">&lt;!--懒加载默认为false ==> lazy-init="false"--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>cat0<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Cat<span class="token punctuation">"</span></span> <span class="token attr-name">scope</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prototype<span class="token punctuation">"</span></span> <span class="token attr-name">lazy-init</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>小花猫<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>补充：<code>lazy-init(懒加载)</code>：ioc容器初始化时不创建，getBean方法调用时才创建</strong></p></blockquote><p> 运行结果：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java">构造器被调用<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token comment">//创建多个Cat对象</span><span class="token class-name">Cat</span><span class="token punctuation">&#123;</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token char">'小花猫'</span><span class="token punctuation">&#125;</span><span class="token comment">//且可以看出：Cat对象创建是在getBean方法调用时，而非ioc初始化时</span>构造器被调用<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token class-name">Cat</span><span class="token punctuation">&#123;</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token char">'小花猫'</span><span class="token punctuation">&#125;</span>构造器被调用<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token class-name">Cat</span><span class="token punctuation">&#123;</span>id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token char">'小花猫'</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-bean的生命周期-重点"><a href="#4-bean的生命周期-重点" class="headerlink" title="4.bean的生命周期(重点)"></a>4.bean的生命周期(重点)</h3><p><strong>bean对象的创建是由JVM完成的，然后执行如下方法：</strong></p><ol><li><strong>执行构造器</strong></li><li><strong>执行setter方法</strong></li><li><strong>调用bean的初始化方法(需要配置<code>init-method</code>标签)</strong></li><li><strong>使用bean</strong></li><li><strong>当容器关闭时，调用bean的销毁方法(需要配置<code>destroy-method</code>标签)</strong></li></ol><p>House类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">House</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">House</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"House() 构造器"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"setXx()方法被调用.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"House init().."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"House destroy().."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--init-method="init":指定init函数为bean初始化方法    destroy-method="destroy":指定destroy函数为bean销毁方法--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>house<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.House<span class="token punctuation">"</span></span>       <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>init<span class="token punctuation">"</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>destroy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>北京豪宅<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">BeanLife</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">House</span> house <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"house"</span><span class="token punctuation">,</span> <span class="token class-name">House</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"使用bean = "</span> <span class="token operator">+</span> house<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//ioc编译类型：ApplicationContext(无close方法)</span>        <span class="token comment">//ioc运行类型：ClassPathXmlApplicationContext(有close方法)</span>        <span class="token comment">//ioc编译类型->向下转型，再调用close方法</span>        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">)</span> ioc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">House</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 构造器<span class="token function">setXx</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法被调用<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token class-name">House</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span>使用bean <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span>House</span><span class="token annotation punctuation">@7e6f74c</span><span class="token class-name">House</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="后置处理器-涉及AOP先不细讲"><a href="#后置处理器-涉及AOP先不细讲" class="headerlink" title="后置处理器(涉及AOP先不细讲)"></a>后置处理器(涉及AOP先不细讲)</h2><ul><li><strong>在spring的ioc容器中，可以配置bean的后置处理器（本质：一个bean对象，作用比较特殊）</strong></li><li><strong>该处理器(&#x2F;对象)会在bean初始化方法(<code>init-method</code>)调用前和初始化方法调用后被调用</strong></li><li><strong>程序员可以在后置处理器中编写自己的代码</strong></li></ul><p>House类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">House</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">House</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"House() 构造器"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"setXx()方法被调用.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"House init().."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"House destroy().."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>后置处理器(implements BeanPostProcessor并要重写两个方法)</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span></span><span class="token class-name">BeansException</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">BeanPostProcessor</span></span><span class="token punctuation">;</span><span class="token comment">//后置处理器</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyBeanPostProcessor</span> <span class="token keyword">implements</span> <span class="token class-name">BeanPostProcessor</span> <span class="token punctuation">&#123;</span>    <span class="token comment">/**     * 什么时候被调用：在bean的init-method方法前会被调用     * @param bean：传入的在ioc容器中 配置的bean对象     * @param beanName：传入的在ioc容器中创建/配置bean的id     * @return 程序员对传入的bean进行修改/处理，再返回     * @throws BeansException     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessBeforeInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span>            <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"postProcessBeforeInitialization被调用。bean="</span> <span class="token operator">+</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">/**     * 什么时候被调用：在bean的init-method方法后会被调用     * 其他同上     */</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">postProcessAfterInitialization</span><span class="token punctuation">(</span><span class="token class-name">Object</span> bean<span class="token punctuation">,</span> <span class="token class-name">String</span> beanName<span class="token punctuation">)</span>            <span class="token keyword">throws</span> <span class="token class-name">BeansException</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"postProcessAfterInitialization被调用。bean="</span> <span class="token operator">+</span> beanName<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> bean<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>beans.xml</strong></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--重点：配置后续处理器类bean->该bean初始化后作用于其他bean的初始化(切面编程AOP)--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.MyBeanPostProcessor<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>mbpp<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>        <span class="token comment">&lt;!--包含后置处理器处理的bean的生命周期--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>house<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.House<span class="token punctuation">"</span></span>          <span class="token attr-name">init-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>init<span class="token punctuation">"</span></span> <span class="token attr-name">destroy-method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>destroy<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>北京豪宅<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">BeanPostProcessorTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">House</span> house <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"house"</span><span class="token punctuation">,</span> <span class="token class-name">House</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">)</span> ioc<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">House</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 构造器<span class="token function">setXx</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法被调用<span class="token punctuation">.</span><span class="token punctuation">.</span>postProcessBeforeInitialization被调用。bean<span class="token operator">=</span>house<span class="token comment">//init-method前被调用</span><span class="token class-name">House</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span>postProcessAfterInitialization被调用。bean<span class="token operator">=</span>house<span class="token comment">//init-method后被调用</span><span class="token class-name">House</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>说明：</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240113153614549.png"></p></blockquote><hr><h2 id="基于注解"><a href="#基于注解" class="headerlink" title="基于注解"></a>基于注解</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/137F684734D3DBF1ECE25CD7A9B3B803.png"></p><h3 id="1-快速入门"><a href="#1-快速入门" class="headerlink" title="1.快速入门"></a>1.快速入门</h3><p><strong>使用注解的方式来配置<code>Controller</code>&#x2F;<code>Service</code>&#x2F;<code>Respository</code>&#x2F;<code>Component</code>。</strong></p><ul><li>引入<code>spring-aop-5.3.8.jar</code>，在<code>spring/libs</code>下拷贝即可</li><li>创建<code>UserController.java</code>，<code>UserService.java</code>，<code>UserDao.java</code>，<code>MyComponent.java</code></li></ul><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240113192508746.png" alt="" style="zoom: 50%;" /><p>UserDao类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span></span><span class="token punctuation">;</span><span class="token comment">//@Repository:标记为一个持久化的类，通常用于Dao类</span><span class="token annotation punctuation">@Repository</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDao</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>UserService类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span><span class="token comment">//@Service：表示是一个处理业务逻辑的类，通常用于Service类</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>UserController类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token comment">//@Controller：标识是一个控制器，通常用于Servlet</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>MyComponent类</p><pre class="line-numbers language-Java" data-language="Java"><code class="language-Java">import org.springframework.stereotype.Component;&#x2F;&#x2F;@Component：标识是一个组件(通用注解，扫描到该标识自动创建)@Componentpublic class MyComponent &#123;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>beans.xml（指定注解扫描范围）</strong></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--不能忘！！配置自动扫描的包，注意需要加入context名称空间--></span><span class="token comment">&lt;!--base-package：ioc初始化时，递归扫描指定的包，创建标有注解的bean对象--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.component<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanByAnnotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//断点</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>debug发现，四个注解标识的类在ioc容器初始化时即创建成功！</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240113200814466.png" alt="" style="zoom:67%;" /><h3 id="2-注意事项"><a href="#2-注意事项" class="headerlink" title="2.注意事项"></a>2.注意事项</h3><ul><li><p><strong>需要导入spring-aop-5.3.8.jar</strong></p></li><li><p><strong>必须在spring配置文件中指定”指定扫描的包及子包”(<code>base-package=&quot;~.*&quot;</code>)，IOC容器才能检测到当前项目中哪些类被标识了注解</strong></p></li><li><p><strong>Spring的IOC容器不能检测一个使用了@Controller注解的类到底是不是一个真正的控制器。注解的名称是用于程序员自己识别当前标识的是什么组件。其它的@Service@Repository也是一样的道理【也就是说spring的IOC容器只要检查到注解就会生成对象，但是这个注解的含义spring不会识别，注解是给程序员编程方便看的】</strong></p></li><li><pre><code class="xml">    &lt;context:component-scan base-package=&quot;com.lhyedu.spring.component&quot;                             resource-pattern=&quot;User*.class&quot;/&gt;<pre class="line-numbers language-none"><code class="language-none">  **&#96;resource-pattern&#x3D;&quot;User*.class&quot;&#96;：表示只扫描满足需要的类**- **排除哪些类：&#96;exclude-filter&#96;**  **包括哪些类：&#96;include-filter&#96;**  &#96;&#96;&#96;xml  &lt;context:component-scan base-package&#x3D;&quot;com.lhyedu.spring.component&quot;&gt;  &lt;!--exclude-filter标签：过滤的注解，ioc初始化时不会创建；include-filter作用相反--&gt;      &lt;!--expression&#x3D;&quot;~&quot;：要排除注解的全类名--&gt;      &lt;context:exclude-filter type&#x3D;&quot;annotation&quot; expression&#x3D;&quot;org.springframework.stereotype.Service&quot;&#x2F;&gt;  &lt;&#x2F;context:component-scan&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></code></pre></li></ul><hr><h2 id="bean的自动装配-高频面试题"><a href="#bean的自动装配-高频面试题" class="headerlink" title="bean的自动装配(高频面试题)"></a>bean的自动装配(高频面试题)</h2><p><strong>在spring的ioc容器，可以实现自动装配bean</strong></p><h3 id="1-基于xml"><a href="#1-基于xml" class="headerlink" title="1.基于xml"></a>1.基于xml</h3><ul><li><p><strong><code>autowire=&quot;byType&quot;</code>：在创建bean对象时，通过 <u>类型</u> 给属性自动完成引用</strong></p><blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span>比如OrderService对象有 private OrderDao orderDao<span class="token operator">></span><span class="token number">2</span><span class="token punctuation">)</span>就会在容器中找 OrderDao类型 的对象。有<span class="token operator">-></span>自动装配；多个同类型<span class="token operator">-></span>报错<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></blockquote></li><li><p><strong><code>autowire=&quot;byName&quot;</code>：在创建bean对象时，通过 <u>bean的id</u> 给属性自动完成引用</strong></p><blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">)</span>比如OrderService对象有 private OrderDao orderDao<span class="token operator">></span><span class="token number">2</span><span class="token punctuation">)</span>再看属性的<span class="token function">setXxx</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法的<span class="token function">xxx</span><span class="token punctuation">(</span>重点<span class="token punctuation">)</span><span class="token operator">></span><span class="token number">3</span><span class="token punctuation">)</span>如果没有<span class="token operator">-></span>则装配失败<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></blockquote></li></ul><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/2BBE76BF9000858CEE336954BE414048.png" alt="img"></p><p>OrderDao类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>dao</span><span class="token punctuation">;</span><span class="token comment">//Dao层</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderDao</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//方法</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"保存 一个订单..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>OrderService类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span><span class="token class-name">OrderDao</span></span><span class="token punctuation">;</span><span class="token comment">//Service层</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderService</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//引用到Dao类为属性</span>    <span class="token keyword">private</span> <span class="token class-name">OrderDao</span> orderDao<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">OrderDao</span> <span class="token function">getOrderDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> orderDao<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOrderDao</span><span class="token punctuation">(</span><span class="token class-name">OrderDao</span> orderDao<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>orderDao <span class="token operator">=</span> orderDao<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>OrderAction类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span><span class="token class-name">Service</span><span class="token punctuation">.</span><span class="token class-name">OrderService</span></span><span class="token punctuation">;</span><span class="token comment">//Controller层</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OrderAction</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//引用到Service类为属性</span>    <span class="token keyword">private</span> <span class="token class-name">OrderService</span> orderService<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token class-name">OrderService</span> <span class="token function">getOrderService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> orderService<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setOrderService</span><span class="token punctuation">(</span><span class="token class-name">OrderService</span> orderService<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>orderService <span class="token operator">=</span> orderService<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>beans.xml（自动装配bean属性：<code>autowire</code>标签）</strong></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--配置OrderDao对象--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.dao.OrderDao<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>orderDao<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment">&lt;!--配置OrderService对象，但不对属性进行&lt;property>引用赋值->自动装配--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.Service.OrderService<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>orderService<span class="token punctuation">"</span></span> <span class="token attr-name">autowire</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>byType<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token comment">&lt;!--配置OrderAction对象，但不对属性进行&lt;property>引用赋值->自动装配--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.web.OrderAction<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>orderAction<span class="token punctuation">"</span></span> <span class="token attr-name">autowire</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>byName<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setBeanByAutowried</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">OrderAction</span> oa <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"orderAction"</span><span class="token punctuation">,</span> <span class="token class-name">OrderAction</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">OrderService</span> os <span class="token operator">=</span> oa<span class="token punctuation">.</span><span class="token function">getOrderService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>os<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//验证OrderAction是否成功装配OrderService</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span><span class="token function">getOrderDao</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//验证OrderService是否成功装配OrderDao</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span></span>Service<span class="token punctuation">.</span>OrderService</span><span class="token annotation punctuation">@34123d65</span><span class="token comment">//Action的Service属性装配成功</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>dao<span class="token punctuation">.</span></span>OrderDao</span><span class="token annotation punctuation">@59474f18</span><span class="token comment">//Service的Dao属性装配成功</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="2-基于注解"><a href="#2-基于注解" class="headerlink" title="2.基于注解"></a>2.基于注解</h3><p><strong>基于注解配置bean，也可实现自动装配，使用的注解是：@Autowired或@Resource</strong></p><blockquote><p><strong>重点：除了泛型依赖注入的情况用：@Autowired；其他大多数情况下都用：@Resource</strong></p></blockquote><h4 id="①-Autowired"><a href="#①-Autowired" class="headerlink" title="①@Autowired"></a>①@Autowired</h4><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/9AD44BEEA0E3B23AE32A1BA9CEFE7FDF.png"></p><p>UserService类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>component</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span><span class="token comment">//@Service：表示是一个处理业务逻辑的类，通常用于Service类</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"UserService hi()~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>UserController类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>component</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token comment">//@Controller：标识是一个控制器，通常用于Servlet</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//自动装配</span>    <span class="token comment">//1)在IOC容器中查找带装配组件的类型，如果有唯一bean匹配(按类型)->装配</span>    <span class="token comment">//2)若带装配类型在ioc容器有多个，则根据带装配属性属性名作为id查找</span>    <span class="token annotation punctuation">@Autowired</span>    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"UserController 的sayOk()~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        userService<span class="token punctuation">.</span><span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//调用Service层属性的方法</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>beans.xml</p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">context:</span>component-scan</span> <span class="token attr-name">base-package</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.component<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.component.UserService<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>service<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProByAutowired</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UserController</span> userController <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"userController"</span><span class="token punctuation">,</span> <span class="token class-name">UserController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        userController<span class="token punctuation">.</span><span class="token function">sayOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">UserController</span> 的<span class="token function">sayOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">~</span><span class="token class-name">UserService</span> <span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">~</span><span class="token comment">//UserController的UserService属性的hi()调用成功->装配成功</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h4 id="②-Resource"><a href="#②-Resource" class="headerlink" title="②@Resource"></a>②@Resource</h4><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/46AFBEF7DAC9335D09DB228F1F564B76.png"></p><p>UserService类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>component</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Service</span></span><span class="token punctuation">;</span><span class="token comment">//@Service：表示是一个处理业务逻辑的类，通常用于Service类</span><span class="token annotation punctuation">@Service</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"UserService hi()~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>UserController类</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>component</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Controller</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Resource</span></span><span class="token punctuation">;</span><span class="token comment">//@Controller：标识是一个控制器，通常用于Servlet</span><span class="token annotation punctuation">@Controller</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">&#123;</span>    <span class="token comment">//@Resource两个作用属性：name和type(类似xml配置下的autowired标签)</span>    <span class="token comment">//1)没指定 -> 默认byName注入，没找到在使用byType注入</span>    <span class="token comment">//2)@Resource(type=UserService.class)->要求容器中只能有1个该类型对象</span>    <span class="token annotation punctuation">@Resource</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"service200"</span><span class="token punctuation">)</span><span class="token comment">//bean中引用的id</span>    <span class="token keyword">private</span> <span class="token class-name">UserService</span> userServiceWuYiYi<span class="token punctuation">;</span><span class="token comment">//此时这里的变量名无意义！</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"UserController 的sayOk()~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        userServiceWuYiYi<span class="token punctuation">.</span><span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//调用Service层属性的方法</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>beans.xml</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token operator">&lt;</span>context<span class="token operator">:</span>component<span class="token operator">-</span>scan base<span class="token operator">-</span><span class="token keyword">package</span><span class="token operator">=</span><span class="token string">"com.lhyedu.spring.component"</span><span class="token operator">/</span><span class="token operator">></span><span class="token operator">&lt;</span>bean <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"com.lhyedu.spring.component.UserService"</span> id<span class="token operator">=</span><span class="token string">"service200"</span><span class="token operator">/</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setProByResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">UserController</span> userController <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"userController"</span><span class="token punctuation">,</span> <span class="token class-name">UserController</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        userController<span class="token punctuation">.</span><span class="token function">sayOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">UserController</span> 的<span class="token function">sayOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">~</span><span class="token class-name">UserService</span> <span class="token function">hi</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">~</span><span class="token comment">//装配成功</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ioc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring容器结构剖析</title>
      <link href="/2024/02/16/Spring%E5%AE%B9%E5%99%A8%E7%BB%93%E6%9E%84%E5%89%96%E6%9E%90/"/>
      <url>/2024/02/16/Spring%E5%AE%B9%E5%99%A8%E7%BB%93%E6%9E%84%E5%89%96%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring容器结构剖析"><a href="#Spring容器结构剖析" class="headerlink" title="Spring容器结构剖析"></a>Spring容器结构剖析</h1><p>[TOC]</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Monster</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">ClassPathXmlApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">Monster</span> monster01 <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"monster01"</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>monster01<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//断点</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110223306082.png"></p><hr><h2 id="beanDefinitionMap"><a href="#beanDefinitionMap" class="headerlink" title="beanDefinitionMap"></a>beanDefinitionMap</h2><blockquote><p>该类的所有属性</p></blockquote><p><code>ioc</code> -&gt; <code>beanfactory</code></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110223503783.png"></p><p><code>beanfactory</code> -&gt; <code>beanDefinitionMap</code></p><blockquote><p><strong>注意：beanDefinitionMap的数据类型是：ConcurrentHashMap</strong></p></blockquote><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110223757080.png"></p><hr><h2 id="beanDefinitionMap的-属性"><a href="#beanDefinitionMap的-属性" class="headerlink" title="beanDefinitionMap的 属性"></a>beanDefinitionMap的 属性</h2><h3 id="①table-数组"><a href="#①table-数组" class="headerlink" title="①table[]数组"></a>①table[]数组</h3><p><strong>保存配置的<u>bean信息</u>。</strong></p><blockquote><p><strong>table[]数组的数据类型是：ConcurrentHashMap的内部类：ConcurrentHashMap$Node</strong></p></blockquote><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110230125665.png"></p><h3 id="②propertyValues"><a href="#②propertyValues" class="headerlink" title="②propertyValues"></a>②propertyValues</h3><p><strong>保存配置<u>bean的”属性”信息</u>。</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110230908336.png"></p><hr><h2 id="singletonObjects"><a href="#singletonObjects" class="headerlink" title="singletonObjects"></a>singletonObjects</h2><blockquote><p><strong>注意：singletonObjects的数据类型也是：ConcurrentHashMap</strong></p></blockquote><p><strong>也维护一个table[]属性，保存<u>创建出来的对象</u>。</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110231757802.png"></p><hr><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110232915695.png"></p><hr><h2 id="xml不指定id"><a href="#xml不指定id" class="headerlink" title="xml不指定id"></a>xml不指定id</h2><p><strong>在beans.xml文件中，注入两个Monster对象，但均不指定id：</strong></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterId<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>牛魔王<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>skill<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>牛魔王拳<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Monster<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterId<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>白骨精<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>skill<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>吃人<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>运行会不会报错？</strong></p><p><u><strong>答：不会。系统会默认分配id，分配规则是<code>全类名#1</code>，<code>全类名#2</code>，<code>全类名#n</code>。</strong></u></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">ClassPathXmlApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1.创建IOC容器对象</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//BeanDefinitionNames[]:保存对象的变量名，便于查找</span>        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> beanDefinitionNames <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBeanDefinitionNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> s <span class="token operator">:</span> beanDefinitionNames<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span>Monster</span>#<span class="token number">0</span><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span>Monster</span>#<span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ioc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>引言</title>
      <link href="/2024/02/16/%E5%BC%95%E8%A8%80/"/>
      <url>/2024/02/16/%E5%BC%95%E8%A8%80/</url>
      
        <content type="html"><![CDATA[<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>[TOC]</p><h2 id="Spring核心学习内容"><a href="#Spring核心学习内容" class="headerlink" title="Spring核心学习内容"></a>Spring核心学习内容</h2><ol><li><strong><code>IOC(Inversion Of Controller控制反转)</code>：管理 Java对象</strong></li><li><strong><code>AOP(切面编程)</code></strong></li><li><strong><code>JdbcTemplate</code>：是Spring提供的一套访问数据库的技术(应用性强)</strong></li><li><strong><code>声明式事务</code>：基于IOC&#x2F;AOP实现事务管理(理解较困难)</strong></li></ol><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110191915708.png" alt="" style="zoom:67%;" /><hr><h2 id="Spring几个重要概念"><a href="#Spring几个重要概念" class="headerlink" title="Spring几个重要概念"></a>Spring几个重要概念</h2><h3 id="Spring可以整合其他框架"><a href="#Spring可以整合其他框架" class="headerlink" title="Spring可以整合其他框架"></a>Spring可以整合其他框架</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110194939562.png" alt="" style="zoom: 33%;" /><h3 id="Spring的2个核心概念-IOC-AOP"><a href="#Spring的2个核心概念-IOC-AOP" class="headerlink" title="Spring的2个核心概念:IOC&amp;AOP"></a>Spring的2个核心概念:IOC&amp;AOP</h3><p><u><strong>传统开发模式：JdbcUtils&#x2F;反射</strong></u></p><ul><li>程序员编写程序，在程序中读取配置信息</li><li>创建对象，new ObjectXxx() &#x2F; 反射创建对象</li><li>使用对象完成任务</li></ul><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110195157780.png"></p><p><u><strong>IOC开发模式：[EmpAction EmpService EmpDao Emp]</strong></u></p><ul><li>Spring根据配置文件(xml&#x2F;注解)，创建对象，并放到容器(ConcurrentHaspMap)中，并完成对象间的依赖</li><li>当需要创建某个对象实例时，就直接从容器中获取即可</li><li>程序员更关注相应业务(而非new 对象)</li></ul><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110195900586.png" alt="" style="zoom: 50%;" /><h3 id="Spring核心价值"><a href="#Spring核心价值" class="headerlink" title="Spring核心价值"></a>Spring核心价值</h3><p><font color="red" size=3>通过配置，给程序提供需要使用的web层[Servlet(Action&#x2F;Controller)] &#x2F; Service &#x2F; Dao &#x2F; [JavaBean&#x2F;entity] 对象</font></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110201426657.png" alt="" style="zoom: 67%;" /><hr><h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/56978B79DCB6704E251BBEB235CC4F29.png"></p><p><strong>在项目下创建<code>lib</code>目录，在包中将以下5个<code>.jar</code>包复制并加入目录(add as library)</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110202626370.png" alt="" style="zoom: 67%;" /><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110202900432.png" alt="" style="zoom: 67%;" /><p><strong>左键<code>src</code>-&gt; <code>New</code> -&gt; <code>XML Configuration File</code> -&gt; <code>Spring Config</code> -&gt; <code>beans.xml</code></strong></p><p><strong>beans.xml文件</strong></p><pre class="line-numbers language-markup" data-language="markup"><code class="language-markup"><span class="token comment">&lt;!--配置Monster对象        1.class:类的全路径        2.id:该类创建的对象的 变量名--></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.lhyedu.spring.bean.Monster<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monster01<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token comment">&lt;!--        &lt;property>&lt;/property>:配置类的 属性标签        1)name:属性名        2)value:赋值--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>monsterId<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>牛魔王<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>skill<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>牛魔王拳<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Monster类</strong></p><blockquote><p><strong>注意：反射创建对象时会用到&#x3D;&#x3D;无参构造器&#x3D;&#x3D;与&#x3D;&#x3D;set方法&#x3D;&#x3D;，定义类时必须写上！！！</strong></p></blockquote><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean</span><span class="token punctuation">;</span><span class="token comment">/** * javaBean/Entity */</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Monster</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> monsterId<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token class-name">String</span> skill<span class="token punctuation">;</span>    <span class="token comment">//无参构造器一定要写，反射时需要使用无参构造器！！！</span>    <span class="token keyword">public</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span><span class="token class-name">String</span> monsterId<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">String</span> skill<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>monsterId <span class="token operator">=</span> monsterId<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>skill <span class="token operator">=</span> skill<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//set方法一定要写，反射时用这个方法初始化类的属性！！！</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setMonsterId</span><span class="token punctuation">(</span><span class="token class-name">String</span> monsterId<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>monsterId <span class="token operator">=</span> monsterId<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setName</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setSkill</span><span class="token punctuation">(</span><span class="token class-name">String</span> skill<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">this</span><span class="token punctuation">.</span>skill <span class="token operator">=</span> skill<span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token annotation punctuation">@Override</span>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token string">"Monster&#123;"</span> <span class="token operator">+</span>                <span class="token string">"monsterId='"</span> <span class="token operator">+</span> monsterId <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>                <span class="token string">", name='"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>                <span class="token string">", skill='"</span> <span class="token operator">+</span> skill <span class="token operator">+</span> <span class="token char">'\''</span> <span class="token operator">+</span>                <span class="token char">'&#125;'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>lhyedu<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>bean<span class="token punctuation">.</span></span><span class="token class-name">Monster</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">ApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span><span class="token class-name">ClassPathXmlApplicationContext</span></span><span class="token punctuation">;</span><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">testFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//1.创建IOC容器对象</span>        <span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>                <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">//2.提供getBean获取对应对象，参数是&lt;bean>的id</span>        <span class="token class-name">Monster</span> monster01 <span class="token operator">=</span> ioc<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">"monster01"</span><span class="token punctuation">,</span> <span class="token class-name">Monster</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>monster01<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110205214273.png"></p><hr><h2 id="类加载路径"><a href="#类加载路径" class="headerlink" title="类加载路径"></a>类加载路径</h2><p><strong>问题：为什么</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token class-name">ApplicationContext</span> ioc <span class="token operator">=</span>        <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">"beans.xml"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>即&#x3D;&#x3D;可读取beans.xml文件？&#x3D;&#x3D;</strong></p><p><strong>classPath()：来获取&#x3D;&#x3D;<code>类加载路径</code>，即：运行时的实际工作路径&#x3D;&#x3D;</strong></p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SpringBeanTest</span> <span class="token punctuation">&#123;</span>    <span class="token annotation punctuation">@Test</span>    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">classPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">//获取："类加载路径"</span>        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240110211828700.png"></p>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ioc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>函数调用过程具体分析</title>
      <link href="/2024/02/06/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B%E5%85%B7%E4%BD%93%E5%88%86%E6%9E%90/"/>
      <url>/2024/02/06/%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B%E5%85%B7%E4%BD%93%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<h1 id="函数调用"><a href="#函数调用" class="headerlink" title="函数调用"></a>函数调用</h1><p><strong>本文使用如下源程序对函数的嵌套调用进行讲解：</strong></p><p><code>stack.c</code></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">N</span> <span class="token expression"><span class="token number">5</span></span></span><span class="token keyword">int</span> <span class="token function">abs</span><span class="token punctuation">(</span><span class="token keyword">int</span> num<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>        <span class="token keyword">return</span> num <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> num<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">get_arr_abs_sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        sum <span class="token operator">+=</span> <span class="token function">abs</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"arr's abs sum = %d\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> arr<span class="token punctuation">[</span>N<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>    <span class="token function">get_arr_abs_sum</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>编译生成可重定位目标文件<code>stack.o</code>：</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 ctest<span class="token punctuation">]</span><span class="token comment"># gcc -c stack.c -o stack.o -g</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>通过对<code>stack.o</code>文件进行反编译，得到汇编代码，再惊进行深入分析</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 ctest<span class="token punctuation">]</span><span class="token comment"># objdump -d stack.o</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">stack.o：     文件格式 elf64-x86-64Disassembly of section .text:0000000000000000 &lt;abs&gt;:   0:55                   push   %rbp   1:48 89 e5             mov    %rsp,%rbp   4:89 7d fc             mov    %edi,-0x4(%rbp)   7:83 7d fc 00          cmpl   $0x0,-0x4(%rbp)   b:79 07                jns    14 &lt;abs+0x14&gt;   d:8b 45 fc             mov    -0x4(%rbp),%eax  10:f7 d8                neg    %eax  12:eb 03                jmp    17 &lt;abs+0x17&gt;  14:8b 45 fc             mov    -0x4(%rbp),%eax  17:5d                   pop    %rbp  18:c3                   retq   0000000000000019 &lt;get_arr_abs_sum&gt;:  19:55                   push   %rbp  1a:48 89 e5             mov    %rsp,%rbp  1d:48 83 ec 20          sub    $0x20,%rsp  21:48 89 7d e8          mov    %rdi,-0x18(%rbp)  25:89 75 e4             mov    %esi,-0x1c(%rbp)  28:c7 45 fc 00 00 00 00 movl   $0x0,-0x4(%rbp)  2f:c7 45 f8 00 00 00 00 movl   $0x0,-0x8(%rbp)  36:eb 22                jmp    5a &lt;get_arr_abs_sum+0x41&gt;  38:8b 45 f8             mov    -0x8(%rbp),%eax  3b:48 98                cltq     3d:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx  44:00   45:48 8b 45 e8          mov    -0x18(%rbp),%rax  49:48 01 d0             add    %rdx,%rax  4c:8b 00                mov    (%rax),%eax  4e:99                   cltd     4f:31 d0                xor    %edx,%eax  51:29 d0                sub    %edx,%eax  53:01 45 fc             add    %eax,-0x4(%rbp)  56:83 45 f8 01          addl   $0x1,-0x8(%rbp)  5a:8b 45 f8             mov    -0x8(%rbp),%eax  5d:3b 45 e4             cmp    -0x1c(%rbp),%eax  60:7c d6                jl     38 &lt;get_arr_abs_sum+0x1f&gt;  62:8b 45 fc             mov    -0x4(%rbp),%eax  65:89 c6                mov    %eax,%esi  67:bf 00 00 00 00       mov    $0x0,%edi  6c:b8 00 00 00 00       mov    $0x0,%eax  71:e8 00 00 00 00       callq  76 &lt;get_arr_abs_sum+0x5d&gt;  76:90                   nop  77:c9                   leaveq   78:c3                   retq   0000000000000079 &lt;main&gt;:  79:55                   push   %rbp  7a:48 89 e5             mov    %rsp,%rbp  7d:48 83 ec 30          sub    $0x30,%rsp  81:89 7d dc             mov    %edi,-0x24(%rbp)  84:48 89 75 d0          mov    %rsi,-0x30(%rbp)  88:c7 45 e0 ff ff ff ff movl   $0xffffffff,-0x20(%rbp)  8f:c7 45 e4 02 00 00 00 movl   $0x2,-0x1c(%rbp)  96:c7 45 e8 fd ff ff ff movl   $0xfffffffd,-0x18(%rbp)  9d:c7 45 ec 04 00 00 00 movl   $0x4,-0x14(%rbp)  a4:c7 45 f0 fb ff ff ff movl   $0xfffffffb,-0x10(%rbp)  ab:48 8d 45 e0          lea    -0x20(%rbp),%rax  af:be 05 00 00 00       mov    $0x5,%esi  b4:48 89 c7             mov    %rax,%rdi  b7:e8 00 00 00 00       callq  bc &lt;main+0x43&gt;  bc:b8 00 00 00 00       mov    $0x0,%eax  c1:c9                   leaveq   c2:c3                   retq <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="进程的虚拟地址空间"><a href="#进程的虚拟地址空间" class="headerlink" title="进程的虚拟地址空间"></a>进程的虚拟地址空间</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240206211348674.png" alt="进程的虚拟地址空间"></p><hr><h2 id="分析main函数"><a href="#分析main函数" class="headerlink" title="分析main函数"></a>分析main函数</h2><p><strong>step1：先保存<code>存栈基bp</code>和<code>栈帧sp</code>，为main函数预分配48B栈空间</strong></p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">79:55                   push   %rbp7a:48 89 e5             mov    %rsp,%rbp7d:48 83 ec 30          sub    $0x30,%rsp #0x30即48B地址空间<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>step2：在x86-64中，函数的第一个参数通常被传递给 <code>%edi</code> 寄存器；函数的第二个参数通常被传递给 <code>%rsi</code> 寄存器</strong></p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">81:89 7d dc             mov    %edi,-0x24(%rbp)84:48 89 75 d0          mov    %rsi,-0x30(%rbp)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>step3：初始化arr数组</strong></p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">88:c7 45 e0 ff ff ff ff movl   $0xffffffff,-0x20(%rbp) #arr的首地址8f:c7 45 e4 02 00 00 00 movl   $0x2,-0x1c(%rbp)96:c7 45 e8 fd ff ff ff movl   $0xfffffffd,-0x18(%rbp)9d:c7 45 ec 04 00 00 00 movl   $0x4,-0x14(%rbp)a4:c7 45 f0 fb ff ff ff movl   $0xfffffffb,-0x10(%rbp)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>step4：即将进行函数调用，先将get_arr_abs_sum(int * arr, int len)的参数放入寄存器中。<code>%esi</code>存放的是len；<code>%rax</code>和<code>%rdi</code>存放的是arr的地址</strong></p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">ab:48 8d 45 e0          lea    -0x20(%rbp),%raxaf:be 05 00 00 00       mov    $0x5,%esib4:48 89 c7             mov    %rax,%rdi<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240207104839753.png"></p><hr><h2 id="main调用get-arr-abs-sum"><a href="#main调用get-arr-abs-sum" class="headerlink" title="main调用get_arr_abs_sum"></a>main调用get_arr_abs_sum</h2><p><strong>step1：<code>call</code>指令实现函数<code>跳转</code>&amp;<code>返回</code>：</strong></p><ol><li><strong>将<code>call</code>指令的下一条地址入栈</strong></li><li><strong><code>%rip</code>指向<code>main+0x43</code>处</strong></li></ol><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">b7:e8 00 00 00 00       callq  bc &lt;main+0x43&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240207105119113.png" alt="call指令的2步操作"></p><p><strong>step2：get_arr_abs_sum函数开始执行。<code>push   %rbp</code>将<code>%rbp</code>指向栈顶，且内容为上层函数的栈基址<code>bp</code>。再开辟32B的栈空间作为get_arr_abs_sum函数的栈帧。</strong></p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">0000000000000019 &lt;get_arr_abs_sum&gt;:  19:55                   push   %rbp  1a:48 89 e5             mov    %rsp,%rbp  1d:48 83 ec 20          sub    $0x20,%rsp<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240207111709789.png"></p><p><strong>step3：get_arr_abs_sum循环调用abs函数</strong></p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">21:48 89 7d e8          mov    %rdi,-0x18(%rbp)25:89 75 e4             mov    %esi,-0x1c(%rbp)28:c7 45 fc 00 00 00 00 movl   $0x0,-0x4(%rbp)2f:c7 45 f8 00 00 00 00 movl   $0x0,-0x8(%rbp)36:eb 22                jmp    5a &lt;get_arr_abs_sum+0x41&gt;38:8b 45 f8             mov    -0x8(%rbp),%eax3b:48 98                cltq   3d:48 8d 14 85 00 00 00 lea    0x0(,%rax,4),%rdx44:00 45:48 8b 45 e8          mov    -0x18(%rbp),%rax49:48 01 d0             add    %rdx,%rax4c:8b 00                mov    (%rax),%eax4e:99                   cltd   4f:31 d0                xor    %edx,%eax51:29 d0                sub    %edx,%eax53:01 45 fc             add    %eax,-0x4(%rbp)56:83 45 f8 01          addl   $0x1,-0x8(%rbp)5a:8b 45 f8             mov    -0x8(%rbp),%eax5d:3b 45 e4             cmp    -0x1c(%rbp),%eax60:7c d6                jl     38 &lt;get_arr_abs_sum+0x1f&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240207122222011.png"></p><hr><h2 id="get-arr-abs-sum调用abs结束"><a href="#get-arr-abs-sum调用abs结束" class="headerlink" title="get_arr_abs_sum调用abs结束"></a>get_arr_abs_sum调用abs结束</h2><blockquote><p>假设此时是for循环的最后一次调用</p></blockquote><p><strong>step1：abs执行<code>ret</code>指令：</strong></p><ol><li><strong>释放栈空间，再将栈顶的返回地址<code>get_arr_abs_sum_call_next_ip</code>从栈中弹出，</strong></li><li><strong>并写入<code>%rip</code>寄存器中</strong></li></ol><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">18:c3                   retq   <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240207123243410.png"></p><hr><h2 id="main调用get-arr-abs-sum结束"><a href="#main调用get-arr-abs-sum结束" class="headerlink" title="main调用get_arr_abs_sum结束"></a>main调用get_arr_abs_sum结束</h2><p><strong>step1：get_arr_abs_sum执行<code>ret</code>指令：</strong></p><ol><li><strong>释放栈空间，再将栈顶的返回地址<code>main_call_next_ip</code>从栈中弹出，</strong></li><li><strong>并写入<code>%rip</code>寄存器中</strong></li></ol><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">78:c3                   retq  <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240207123632744.png"></p><hr><h2 id="进程结束，返回结果给进程调度器"><a href="#进程结束，返回结果给进程调度器" class="headerlink" title="进程结束，返回结果给进程调度器"></a>进程结束，返回结果给进程调度器</h2><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">bc:b8 00 00 00 00       mov    $0x0,%eaxc1:c9                   leaveq c2:c3                   retq <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> C语言 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>gdb调试</title>
      <link href="/2024/02/05/gdb%E8%B0%83%E8%AF%95/"/>
      <url>/2024/02/05/gdb%E8%B0%83%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="gdb调试"><a href="#gdb调试" class="headerlink" title="gdb调试"></a>gdb调试</h1><p><strong>本文以如下源代码为例讲述gdb调试工具的基本使用：</strong></p><p><code>test.c</code></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">N</span> <span class="token expression"><span class="token number">10</span></span></span><span class="token keyword">char</span> <span class="token operator">*</span> str <span class="token operator">=</span> <span class="token string">"hello "</span><span class="token punctuation">;</span><span class="token keyword">int</span> var <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">init_arr</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i<span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">20</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">select_sort</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k<span class="token punctuation">,</span> tmp<span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        k <span class="token operator">=</span> i<span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>j <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">></span> arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>                k <span class="token operator">=</span> j<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">!=</span> k<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            tmp <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> arr<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>            arr<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">void</span> <span class="token function">print_arr</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span> arr<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> i<span class="token punctuation">;</span>    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"arr[%d] = %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> arr<span class="token punctuation">[</span>N<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">char</span> <span class="token operator">*</span> p <span class="token operator">=</span> <span class="token string">"hellod"</span><span class="token punctuation">;</span>    <span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">init_arr</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_arr</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>    p<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'M'</span><span class="token punctuation">;</span>    <span class="token function">select_sort</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"----------------after sort-----------------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">print_arr</span><span class="token punctuation">(</span>arr<span class="token punctuation">,</span> N<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><hr><h2 id="编译时加上-g参数得到的可执行文件，内部包含调试信息"><a href="#编译时加上-g参数得到的可执行文件，内部包含调试信息" class="headerlink" title="编译时加上-g参数得到的可执行文件，内部包含调试信息"></a>编译时加上<code>-g</code>参数得到的可执行文件，内部包含调试信息</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 gdbtest<span class="token punctuation">]</span><span class="token comment"># gcc test.c -o a.out -g</span><span class="token punctuation">[</span>root@lhyEdu01 gdbtest<span class="token punctuation">]</span><span class="token comment"># gcc test.c -o a_no_debug.out</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240205230037483.png" alt="多出来的部分为编译时产生的调试信息" style="zoom:67%;" /><p><strong>显然，编译带有调试信息的目标文件占用空间更大。</strong></p><h2 id="开启gdb"><a href="#开启gdb" class="headerlink" title="开启gdb"></a>开启gdb</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gdb a.out<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/%E5%BC%80%E5%90%AFgdb.gif" alt="开启gdb" style="zoom:67%;" /><hr><h2 id="显示源码-默认10行"><a href="#显示源码-默认10行" class="headerlink" title="显示源码(默认10行)"></a>显示源码(默认10行)</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">list line_number<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/gdb_list.gif" alt="显示源码(默认10行)" style="zoom:67%;" /><h2 id="继续显示"><a href="#继续显示" class="headerlink" title="继续显示"></a>继续显示</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">list <span class="token comment">#可缩写</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/gdb_l2.gif" alt="继续显示" style="zoom:67%;" /><hr><h2 id="设置断点"><a href="#设置断点" class="headerlink" title="设置断点"></a>设置断点</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">break</span> line_number <span class="token comment">#可缩写</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/gdb_break.gif" alt="" style="zoom:67%;" /><h2 id="查看断点信息表"><a href="#查看断点信息表" class="headerlink" title="查看断点信息表"></a>查看断点信息表</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">info b<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/gdb_info.gif" style="zoom:67%;" /><h2 id="单步执行"><a href="#单步执行" class="headerlink" title="单步执行"></a>单步执行</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">run <span class="token comment">#可缩写</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/gdb_run.gif" alt="此时只是定位到断点，还未执行" style="zoom:67%;" /><h2 id="进入断点-step-into"><a href="#进入断点-step-into" class="headerlink" title="进入断点(step into)"></a>进入断点(step into)</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">step <span class="token comment">#可缩写</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/gdb_step.gif" alt="" style="zoom:67%;" /><h2 id="执行下一步-step-next"><a href="#执行下一步-step-next" class="headerlink" title="执行下一步(step next)"></a>执行下一步(step next)</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">next <span class="token comment">#可缩写</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/gdb_next.gif" alt="" style="zoom:67%;" /><h2 id="查看变量的值"><a href="#查看变量的值" class="headerlink" title="查看变量的值"></a>查看变量的值</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">p 变量名 <span class="token comment">#print缩写</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/gdb_p.gif" alt="" style="zoom:67%;" /><h2 id="查看变量类型"><a href="#查看变量类型" class="headerlink" title="查看变量类型"></a>查看变量类型</h2><pre class="line-numbers language-none"><code class="language-none">ptype 变量名 #print缩写<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/gdb_ptype.gif" style="zoom:67%;" /><h2 id="查看当前存活的栈帧列表"><a href="#查看当前存活的栈帧列表" class="headerlink" title="查看当前存活的栈帧列表"></a>查看当前存活的栈帧列表</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">bt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240206105542177.png" alt="" style="zoom:67%;" /><p>[细节内容查看：过程调用](<a href="https://www.bilibili.com/video/BV19X4y1P7Pn/?spm_id_from=333.337.search-card.all.click&vd_source=59094c15e7c1087c27f04ff9f927d393">【CSAPP-深入理解计算机系统】3-7. 过程（函数调用）_哔哩哔哩_bilibili</a>)</p><h2 id="切换栈帧"><a href="#切换栈帧" class="headerlink" title="切换栈帧"></a>切换栈帧</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">frame bt指令得到的栈帧编号<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/gdb_frame.gif" alt="" style="zoom:67%;" /><h2 id="跳出断点-step-out"><a href="#跳出断点-step-out" class="headerlink" title="跳出断点(step out)"></a>跳出断点(step out)</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">finsih<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/gdb_finish.gif" alt="" style="zoom:67%;" /><hr><h2 id="跳出断点并继续执行"><a href="#跳出断点并继续执行" class="headerlink" title="跳出断点并继续执行"></a>跳出断点并继续执行</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">continue</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240205225520944.png" alt="" style="zoom: 67%;" /><hr><h2 id="处理段错误-无行号提示"><a href="#处理段错误-无行号提示" class="headerlink" title="处理段错误(无行号提示)"></a>处理段错误(无行号提示)</h2><p>以<code>test.c</code>源程序为例，在main函数内添加如下错误，</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240206093814809.png" alt="常量区数据不可被修改" style="zoom: 67%;" /><p>编译后运行，<strong>报错：<code>段错误</code>，且无提示行号，无法通过行号debug</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240206094111744.png" alt="" style="zoom: 67%;" /><p><strong>解决：开启gdb后直接执行<code>run</code>指令，程序停止处即为<code>段错误</code>位置</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/gdb_r2.gif" alt="" style="zoom:67%;" /><hr><h2 id="调试带有命令行参数的可执行文件"><a href="#调试带有命令行参数的可执行文件" class="headerlink" title="调试带有命令行参数的可执行文件"></a>调试带有命令行参数的可执行文件</h2><p>修改<code>test.c</code>源程序的main函数，</p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240206100409832.png"></p><h3 id="直接运行："><a href="#直接运行：" class="headerlink" title="直接运行："></a>直接运行：</h3><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240206100937068.png" alt="" style="zoom: 67%;" /><h3 id="gdb调试中运行："><a href="#gdb调试中运行：" class="headerlink" title="gdb调试中运行："></a>gdb调试中运行：</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">set</span> args argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/gdb_set_args.gif" alt="" style="zoom:67%;" /><hr><h2 id="退出gdb"><a href="#退出gdb" class="headerlink" title="退出gdb"></a>退出gdb</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">quit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> C语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C语言工具链 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>chapter7—链接</title>
      <link href="/2024/02/04/chapter7%E2%80%94%E9%93%BE%E6%8E%A5/"/>
      <url>/2024/02/04/chapter7%E2%80%94%E9%93%BE%E6%8E%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="chapter7—链接"><a href="#chapter7—链接" class="headerlink" title="chapter7—链接"></a>chapter7—链接</h1><p>已知一个main.c文件</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"> <span class="token number">1</span> #include<span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">></span> <span class="token number">2</span> <span class="token comment">//count和value两个全局变量</span> <span class="token number">3</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token number">4</span> <span class="token keyword">int</span> value<span class="token punctuation">;</span> <span class="token number">5</span>  <span class="token number">6</span> <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">int</span> sum<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token number">7</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sum is:%d\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">8</span> <span class="token punctuation">&#125;</span> <span class="token number">9</span> <span class="token number">10</span><span class="token number">11</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token number">12</span>         <span class="token keyword">static</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token number">13</span>         <span class="token keyword">static</span> <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token number">14</span>         <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token number">15</span> <span class="token number">16</span>         <span class="token function">func</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">17</span>         <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token number">18</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过<code>gcc -c main.c</code>得到可重定位二进制文件，再根据<code>wc -c main.o</code>查看main.o文件的大小</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># gcc <span class="token operator">-</span>c main<span class="token punctuation">.</span>c<span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># wc <span class="token operator">-</span>c main<span class="token punctuation">.</span>o<span class="token number">1856</span> main<span class="token punctuation">.</span>o<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>使用<code>readelf -h main.o</code>查看ELF可重定位目标文件的ELF头(ELF Header)的具体内容</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">readelf <span class="token operator">-</span>h main<span class="token punctuation">.</span>o<span class="token comment">//-h：只显示ELF Header的信息</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># readelf <span class="token operator">-</span>h main<span class="token punctuation">.</span>oELF 头：  Magic：  <span class="token number">7f</span> <span class="token number">45</span> <span class="token number">4</span>c <span class="token number">46</span> <span class="token number">02</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>   类别<span class="token operator">:</span>                              ELF64  数据<span class="token operator">:</span>                              <span class="token number">2</span> 补码，小端序 <span class="token punctuation">(</span>little endian<span class="token punctuation">)</span>  版本<span class="token operator">:</span>                              <span class="token number">1</span> <span class="token punctuation">(</span>current<span class="token punctuation">)</span>  OS<span class="token operator">/</span>ABI<span class="token operator">:</span>                            UNIX <span class="token operator">-</span> System V  ABI 版本<span class="token operator">:</span>                          <span class="token number">0</span>  类型<span class="token operator">:</span>                              <span class="token function">REL</span> <span class="token punctuation">(</span>可重定位文件<span class="token punctuation">)</span>  系统架构<span class="token operator">:</span>                          Advanced Micro Devices X86<span class="token operator">-</span><span class="token number">64</span>  版本<span class="token operator">:</span>                              <span class="token number">0x1</span>  入口点地址：              <span class="token number">0x0</span>  程序头起点：              <span class="token number">0</span> <span class="token punctuation">(</span>bytes into file<span class="token punctuation">)</span>  Start of section headers<span class="token operator">:</span>          <span class="token number">1024</span> <span class="token punctuation">(</span>bytes into file<span class="token punctuation">)</span>  标志：             <span class="token number">0x0</span>  本头的大小：       <span class="token number">64</span> <span class="token punctuation">(</span>字节<span class="token punctuation">)</span>  程序头大小：       <span class="token number">0</span> <span class="token punctuation">(</span>字节<span class="token punctuation">)</span>  Number of program headers<span class="token operator">:</span>         <span class="token number">0</span>  节头大小：         <span class="token number">64</span> <span class="token punctuation">(</span>字节<span class="token punctuation">)</span>  节头数量：         <span class="token number">13</span>  字符串表索引节头： <span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="可重定位目标文件-ELF文件"><a href="#可重定位目标文件-ELF文件" class="headerlink" title="可重定位目标文件(ELF文件)"></a>可重定位目标文件(ELF文件)</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20231228190228140.png" alt="ELF文件"></p><h2 id="section-节-的具体内容"><a href="#section-节-的具体内容" class="headerlink" title="section(节)的具体内容"></a>section(节)的具体内容</h2><ol><li><strong><code>.text</code>：已编译程序的及其代码</strong></li><li><strong><code>.rodata</code>：只读数据，如：prinf函数内的格式串</strong></li><li><strong><code>.data</code>：<u>已初始化</u>的全局和静态C变量</strong></li><li><strong><code>.bss(Better Save Space)</code>：<u>未初始化</u>的全局和静态C变量</strong></li><li><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20231228191717559.png" style="zoom: 33%;" /></li></ol><h2 id="符号-符号表-symtab）"><a href="#符号-符号表-symtab）" class="headerlink" title="符号&amp;符号表(.symtab）"></a>符号&amp;符号表(.symtab）</h2><p><strong>对于每一个可重定位目标文件(ELF)m，都有一个符号表(.symtab节中)。在链接器的上下文中，有三种不同的符号：</strong></p><ol><li><strong><code>全局符号(Global Symbols)</code>：模块m定义+能被其他模块引用</strong></li><li><strong><code>外部符号(Externals Symbols)</code>：其他模块定义+能被模块m引用</strong></li><li><strong><code>局部符号(Local Symbols)</code>：只被模块m定义+其他模块不能引用。如：任何带有static修饰的全局变量或函数 都是模块私有的，其他模块不能访问，类似Java的private关键字</strong></li></ol><blockquote><p><strong>注：</strong>.symtab节的符号表不包含<strong>本地非静态局部变量</strong>，因为其在<strong>栈中被管理</strong>！</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># readelf <span class="token operator">-</span>s main<span class="token punctuation">.</span>oSymbol table <span class="token char">'.symtab'</span> contains <span class="token number">16</span> entries<span class="token operator">:</span>   Num<span class="token operator">:</span>    Value          Size Type    Bind   Vis      Ndx Name     <span class="token number">0</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> NOTYPE  LOCAL  DEFAULT  UND      <span class="token number">1</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> FILE    LOCAL  DEFAULT  ABS main<span class="token punctuation">.</span>c     <span class="token number">2</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> SECTION LOCAL  DEFAULT    <span class="token number">1</span>      <span class="token number">3</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> SECTION LOCAL  DEFAULT    <span class="token number">3</span>      <span class="token number">4</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> SECTION LOCAL  DEFAULT    <span class="token number">4</span>      <span class="token number">5</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> SECTION LOCAL  DEFAULT    <span class="token number">5</span>      <span class="token number">6</span><span class="token operator">:</span> <span class="token number">0000000000000004</span>     <span class="token number">4</span> OBJECT  LOCAL  DEFAULT    <span class="token number">3</span> a<span class="token punctuation">.</span><span class="token number">2185</span>     <span class="token number">7</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">4</span> OBJECT  LOCAL  DEFAULT    <span class="token number">4</span> b<span class="token punctuation">.</span><span class="token number">2186</span>     <span class="token number">8</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> SECTION LOCAL  DEFAULT    <span class="token number">7</span>      <span class="token number">9</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> SECTION LOCAL  DEFAULT    <span class="token number">8</span>     <span class="token number">10</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> SECTION LOCAL  DEFAULT    <span class="token number">6</span>     <span class="token number">11</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">4</span> OBJECT  GLOBAL DEFAULT    <span class="token number">3</span> count    <span class="token number">12</span><span class="token operator">:</span> <span class="token number">0000000000000004</span>     <span class="token number">4</span> OBJECT  GLOBAL DEFAULT  COM value    <span class="token number">13</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>    <span class="token number">33</span> FUNC    GLOBAL DEFAULT    <span class="token number">1</span> func    <span class="token number">14</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> NOTYPE  GLOBAL DEFAULT  UND printf    <span class="token number">15</span><span class="token operator">:</span> <span class="token number">0000000000000021</span>    <span class="token number">55</span> FUNC    GLOBAL DEFAULT    <span class="token number">1</span> main<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>Type：FUNC-函数、OBJECT-变量数组等数据对象</p><p>Value：表示函数相对于.text section起始位置的偏移量</p><p>Bind：作用范围。局部&#x2F;全局</p><p>Ndx：表示节头部表的section的数组索引。如：Ndx&#x3D;1表示在.text节；Ndx&#x3D;3表示在.data节</p><blockquote><p>Ndx表示中有<strong>3个伪节：</strong></p></blockquote><blockquote><ul><li><strong><code>ABS</code>：不该被重定位的符号</strong></li><li><strong><code>UNDEF</code>：未定义的符号</strong></li><li><strong><code>COMMON</code>：未被分配位置的初始化的数据目标</strong></li></ul></blockquote><blockquote><p><strong>注意：变量count和value属于不同section的原因：count初始化了，value没有初始化</strong></p></blockquote><blockquote><p><strong>COMMON：未初始化的全局变量；.bss节：未初始化的静态变量+初始化为0的静态&#x2F;全局变量</strong></p></blockquote></blockquote><h3 id="符号解析"><a href="#符号解析" class="headerlink" title="符号解析"></a>符号解析</h3><p>对以下源文件进行编译linkerror.c进行编译汇编，生成二进制文件linkerror.o。</p><p>其中，该代码<strong>仅对函数foo进行声明</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>gcc -c linkerror.c </code>，编译可以通过！<font size=3 color=red>当编译器遇到一个不是在当前模块定义的符号(变量&#x2F;函数名)时，会假设该符号是在在其他模块在定义的。</font></p><p><font size=3 color=red>但是链接器(ld)无法解析对foo的引用时，就会终止！</font></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># gcc <span class="token operator">-</span>Wall <span class="token operator">-</span>Og <span class="token operator">-</span>o linkerror linkerror<span class="token punctuation">.</span>c<span class="token operator">/</span>tmp<span class="token operator">/</span>cc5EcYAf<span class="token punctuation">.</span>o：在函数‘main’中：linkerror<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token number">0x5</span><span class="token punctuation">)</span>：对‘foo’未定义的引用collect2<span class="token operator">:</span> 错误：ld 返回 <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><font size=4 color=red>引出问题：”全局符号”在多个可重定位目标文件中【同名定义】，如何处理？</font></p><p><strong>编译时，编译器向汇编器输出每个全局符号的类型：</strong></p><ul><li><strong><code>Strong symbols(强符号)</code>：函数和已初始化的全局变量</strong></li><li><strong><code>Weak symbols(弱符号)</code>：未初始化的全局变量</strong></li></ul><p><strong>汇编时，汇编器将强弱信息隐含地编码在ELF的符号表(.symtab)里</strong></p><p><strong>链接时，链接器根据以下3种情况处理多重定义的全局符号：</strong></p><ol><li><p><strong>规则1：不允许有多个同名的强符号</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/*foo1.c*/</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*bar1.c*/</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># gcc foo1<span class="token punctuation">.</span>c bar1<span class="token punctuation">.</span>c<span class="token operator">/</span>tmp<span class="token operator">/</span>ccSHeCo9<span class="token punctuation">.</span>o：在函数‘main’中：bar1<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token number">0x0</span><span class="token punctuation">)</span><span class="token operator">:</span> main 的多重定义<span class="token operator">/</span>tmp<span class="token operator">/</span>ccnLYE7L<span class="token punctuation">.</span>o<span class="token operator">:</span>foo1<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token number">0x0</span><span class="token punctuation">)</span>：第一次在此定义collect2<span class="token operator">:</span> 错误：ld 返回 <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>规则2：一个强符号与多个弱符号同名，那么选择强符号</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/*foo2.c*/</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">15213</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"x = %d\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*bar2.c*/</span><span class="token keyword">int</span> x<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        x <span class="token operator">=</span> <span class="token number">15212</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># gcc foo2<span class="token punctuation">.</span>c bar2<span class="token punctuation">.</span>c<span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># <span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>outx <span class="token operator">=</span> <span class="token number">15212</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>函数f将x的值由15213改为15212。一个模块(bar2.c)里的x未初始化(弱符号)，链接器会安静地选择其他模块(foo2.c)里定义的强符号</p></li><li><p><strong>规则3：如果有多个弱符号同名，任意选择一个</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/*foo3.c*/</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">15212</span><span class="token punctuation">;</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">15213</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"x = 0x%x y = 0x%x\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*bar3.c*/</span><span class="token keyword">double</span> x<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># gcc foo3<span class="token punctuation">.</span>c bar3<span class="token punctuation">.</span>c<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ld<span class="token operator">:</span> Warning<span class="token operator">:</span> alignment <span class="token number">4</span> of symbol `x' in <span class="token operator">/</span>tmp<span class="token operator">/</span>ccWPcPGG<span class="token punctuation">.</span>o is smaller than <span class="token number">8</span> in <span class="token operator">/</span>tmp<span class="token operator">/</span>cc3MhEaU<span class="token punctuation">.</span>o<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><h4 id="静态库-static-library"><a href="#静态库-static-library" class="headerlink" title="静态库(static library)"></a>静态库(static library)</h4><p>在共享库出现之前，<strong>公用功能(atoi&#x2F;printf&#x2F;scanf&#x2F;strcpy&#x2F;rand等)<strong>是以</strong>静态库</strong>的形式存在的，它把<strong>通用功能模块的多个目标文件打包在一起形成<code>*.a</code>的文件(如libc.a)<strong>，用到它的程序只需要在链接时指定这个库文件，</strong>链接器就会从这个库中抽取出用到的功能代码拷贝到目标程序中</strong>，而不需要每次都对这些通用功能代码重新编译。</p><p><strong>对文件<em>addvec.c</em>和<em>multvec.c</em>进行编译<code>gcc -c addvec.c multvec.c</code>，得到目标模块</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> addcnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">addvec</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span> z<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> i<span class="token punctuation">;</span>                addcnt<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> multcnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">multvec</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span> z<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> i<span class="token punctuation">;</span>                multcnt<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>使用<code>AR工具</code>将两个目标模块<em>addvec.o multvec.o</em>打包成静态库(<code>ar rcs libxxx.a xxx.o xxx.o</code>)</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># ar rcs linvector<span class="token punctuation">.</span>a addvec<span class="token punctuation">.</span>o multvec<span class="token punctuation">.</span>o<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>以main2.c文件为例</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"vector.h"</span></span><span class="token keyword">int</span> x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">int</span> y<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">int</span> z<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">addvec</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"z = [%d %d]\n"</span><span class="token punctuation">,</span> z<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> z<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中”vector.h”中包含对addvec函数的声明：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">addvec</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span> z<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>编译和链接输入文件main2.o和libvector.a</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/1125E426BCF8DCF854B292C45FC50D8A.jpg" style="zoom:20%;" /><blockquote><p><strong>链接器判断main2.o引用了addvec.o定义的addvec符号，所以复制addvec.o到可执行文件。</strong></p><p><strong>因为程序未引用multvec.0定义的符号，所以链接器就不会复制这个模块到可执行文件。</strong></p><p><strong>此外，链接器还会复制libc.a中的printf.o等C系统运行时的其他模块。</strong></p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># gcc <span class="token operator">-</span>c main2<span class="token punctuation">.</span>c<span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># gcc <span class="token operator">-</span><span class="token keyword">static</span> <span class="token operator">-</span>o prog2c main2<span class="token punctuation">.</span>o <span class="token punctuation">.</span><span class="token operator">/</span>libvector<span class="token punctuation">.</span>a<span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># <span class="token punctuation">.</span><span class="token operator">/</span>prog2c z <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span> <span class="token number">6</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="重定位"><a href="#重定位" class="headerlink" title="重定位"></a>重定位</h3><p>当汇编器生成一个目标模块时，它并不知道数据和代码最终将放在内存中的什么位置。也不知道本模块引用的外部定义函数或全局变量的最终位置。</p><p><strong><font size=3 color=red>因此，汇编器遇到对最终位置未知的目标引用，就会生成一个【重定位条目】，告诉链接器再将目标文件合并为可执行文件时如何修改这个引用。</font></strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/*重定位条目-数据结构*/</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span><span class="token keyword">long</span> offset<span class="token punctuation">;</span><span class="token comment">//被修改的引用的节偏移量</span><span class="token keyword">long</span> type<span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token comment">//告知链接器如何修改新的引用</span>    <span class="token comment">//主要两种：1.R_X86_64_PC32(PC相对地址)2.R_X86_64_32(绝对地址)</span>symbol<span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">;</span><span class="token comment">//表示被修改的引用是哪个符号</span><span class="token keyword">long</span> addend<span class="token punctuation">;</span><span class="token comment">//有符号数，一些类型的重定位要使用它对被修改引用的值做偏移调整(指令长度)</span><span class="token punctuation">&#125;</span> ELF_Rela<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>代码的重定位条目存放在<code>.rel.text</code>中</strong></p><p><strong>已初始化数据的重定位条目存放在<code>.rel.data</code>中</strong></p></blockquote><h4 id="重定位算法"><a href="#重定位算法" class="headerlink" title="重定位算法"></a>重定位算法</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c">foreach section s <span class="token punctuation">&#123;</span>foreach relocation entry r <span class="token punctuation">&#123;</span>refptr <span class="token operator">=</span> s <span class="token operator">+</span> r<span class="token punctuation">.</span>offset<span class="token punctuation">;</span><span class="token comment">/*1.重定位PC相对引用*/</span><span class="token keyword">if</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>type <span class="token operator">==</span> R_X86_64_PC32<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>refaddr <span class="token operator">=</span> <span class="token function">ADDR</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>offset<span class="token punctuation">;</span><span class="token comment">/*refaddr:引用的运行时地址*/</span><span class="token operator">*</span>refptr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">ADDR</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>symbol<span class="token punctuation">)</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>addend <span class="token operator">-</span> refaddr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*2.重定位绝对引用*/</span><span class="token keyword">if</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>type <span class="token operator">==</span> R_X86_64_32<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token operator">*</span>refptr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">ADDR</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>symbol<span class="token punctuation">)</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>addend<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="①重定位PC相对引用"><a href="#①重定位PC相对引用" class="headerlink" title="①重定位PC相对引用"></a>①重定位PC相对引用</h5><p><strong>例：对源文件<em>main.c</em>和<em>sum.c</em>进行反汇编：</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> array<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> i<span class="token punctuation">,</span> s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                s <span class="token operator">+=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>再用<code>objdump -dx main.o</code>对main,o进行反编译后结果：</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># objdump <span class="token operator">-</span>dx main<span class="token punctuation">.</span>o<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20231229213448474.png" style="zoom: 50%;" /><p><strong>函数main调用sum函数，sum函数是在sum.o模块中定义的，sum的重定位条目为：</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c">r<span class="token punctuation">,</span>offset <span class="token operator">=</span> <span class="token number">0xf</span>r<span class="token punctuation">.</span>symbol <span class="token operator">=</span> sumr<span class="token punctuation">.</span>type   <span class="token operator">=</span> R_X86_64_PC32r<span class="token punctuation">.</span>addend <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong><u>这些字段告诉链接器修改开始于0xf处的32位PC相对引用，这样在运行时它会指向sum例程</u>。假设链接器已确定：</strong></p><ul><li><strong><code>ADDR(s) = ADDR(.text)</code> &#x3D; 0x400d0</strong></li><li><strong><code>ADDR(r.symbol) = ADDR(sum)</code> &#x3D; 0x400e8</strong></li></ul><p><strong>使用<code>重定位算法</code>知：</strong></p><ol><li><p><strong>链接器首先算出引用的<u>运行时地址</u>：</strong></p><p><strong>ref_addr &#x3D; ADDR(s) + r.offset &#x3D; 0x4004d0 + 0xf &#x3D; 0x4004df</strong> </p></li><li><p><strong>然后更新该引用，使得它再运行时指向sum程序(实际就是求PC的offset)</strong></p><p><strong>ref_ptr &#x3D; ADDR(sum) - ref_addr + r.addend &#x3D; 0x4004e8 - 0x4004df +(-4) &#x3D; 0x5</strong></p></li></ol><p>得到的可执行文件中，call指令由如下形式：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token number">4004</span>de<span class="token operator">:</span>e8 <span class="token number">05</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>       callq  <span class="token number">4004e8</span> <span class="token operator">&lt;</span>sum<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="②重定位绝对引用"><a href="#②重定位绝对引用" class="headerlink" title="②重定位绝对引用"></a>②重定位绝对引用</h5><p><strong>mov指令将array地址(32位立即数)复制到寄存器%edi中，sum函数是在sum.o模块中定义的，sum的重定位条目为：</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c">r<span class="token punctuation">,</span>offset <span class="token operator">=</span> <span class="token number">0xa</span>r<span class="token punctuation">.</span>symbol <span class="token operator">=</span> arrayr<span class="token punctuation">.</span>type   <span class="token operator">=</span> R_X86_64_32r<span class="token punctuation">.</span>addend <span class="token operator">=</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这些字段告诉链接器修改开始于0xa处的32位绝对引用，这样在运行时它会指向array的第一个字节。假设链接器已确定：</p><ul><li><strong><code>ADDR(r.symbol) = ADDR(array)</code> &#x3D; 0x601018</strong></li></ul><p>链接器修改第13行的引用：</p><p>*<strong>ref_ptr &#x3D; (unsigned) ((ADDR(r.symbol) + r.addend)) &#x3D; (unsigned) (0x601018 + 0) &#x3D; 0x601018</strong></p><p>得到的可执行文件中，机器指令由如下形式：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token number">4004</span>d9<span class="token operator">:</span>bf <span class="token number">18</span> <span class="token number">10</span> <span class="token number">60</span> <span class="token number">00</span>       mov $<span class="token number">0x601018</span><span class="token punctuation">,</span> <span class="token operator">%</span>edi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/D0D016AAD0F392AC3C3FFCEFEFAA42CC.jpg"></p><h3 id="可执行目标文件-加载过程"><a href="#可执行目标文件-加载过程" class="headerlink" title="可执行目标文件&amp;加载过程"></a>可执行目标文件&amp;加载过程</h3>]]></content>
      
      
      <categories>
          
          <category> C语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> csapp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>静态库与共享库</title>
      <link href="/2024/02/04/%E9%9D%99%E6%80%81%E5%BA%93%E4%B8%8E%E5%85%B1%E4%BA%AB%E5%BA%93/"/>
      <url>/2024/02/04/%E9%9D%99%E6%80%81%E5%BA%93%E4%B8%8E%E5%85%B1%E4%BA%AB%E5%BA%93/</url>
      
        <content type="html"><![CDATA[<h1 id="静态库与共享库"><a href="#静态库与共享库" class="headerlink" title="静态库与共享库"></a>静态库与共享库</h1><blockquote><p>所谓<code>&quot;程序库&quot;</code>，就是<strong>包含了数据和执行码的文件。其不能单独执行，可以作为其他程序的一部分完成某些功能</strong>。</p><p>库的存在，可以使程序模块化，加快程序的再编译，可以实现代码重用，可以使得程序便于升级。</p><p><strong>程序库可分为<code>静态库(static library)</code>和<code>共享库(shared object)</code>。两者本质区别：该库是否被编译进目标（程序）内部。</strong></p></blockquote><hr><h2 id="静态库"><a href="#静态库" class="headerlink" title="静态库"></a>静态库</h2><p>这类库在<strong>编译的时候</strong>会直接整合到目标程序中，所以利用静态函数库编译成的文件会比较大。<strong>应用于对空间要求低，时间要求高的程序中</strong>。</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240204092840853.png" alt="静态库文件50MB,100个程序则占用50GB空间" style="zoom: 40%;" /><ul><li>优点：编译成功的可执行文件可以独立运行，而不再需要向外部要求读取函数库的内容</li><li>缺点：相同的库文件数据可能在内存中被加载多份，消耗系统资源，浪费内存；函数库更新，需要重新编译</li></ul><h3 id="应用实例—生成静态库"><a href="#应用实例—生成静态库" class="headerlink" title="应用实例—生成静态库"></a>应用实例—生成静态库</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/*add.c*/</span><span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*sub.c*/</span><span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*div.c*/</span><span class="token keyword">int</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> a <span class="token operator">/</span> b<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>step1：对<code>add.c</code>和<code>sub.c</code>和<code>div.c</code>三个文件进行编译，得到3个<strong>可重定位目标文件</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240204100758657.png" alt="3个可重定位目标文件" style="zoom: 67%;" /><p>step2：使用<code>ar工具</code>将3个可重定位目标文件生成为1个<strong>静态库</strong><code>libmymath.a</code>。</p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240204101129292.png" alt="ar rcs libxxx.a xxx.o ... xx.o" style="zoom:67%;" /><p>step3：**在<code>math.c</code>程序编译过程中使用静态库<code>libmymath.a</code>**。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d + %d = %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d - %d = %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d / %d = %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token function">div</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240204110237451.png" alt="gcc math.c libmymath.a -o math" style="zoom:67%;" /><h3 id="隐式声明"><a href="#隐式声明" class="headerlink" title="隐式声明"></a>隐式声明</h3><p>在C语言中，函数在调用前不一定非要声明。如果没有声明，那么<strong>编译器会自动按照一种隐式声明的规则，为调用函数的C代码产生汇编代码</strong>。</p><p>单纯的编译上述<code>math.c</code>源代码，并没有任何报错，只是在链接阶段若找不到名为add&#x2F;sub&#x2F;div的函数体则报错。之所以编译不会报错，是因为C语言规定，<strong>对于没有声明的函数，自动使用隐式声明</strong>。</p><p>编译<code>math.c</code>源代码，加上警告信息<code>gcc math.c libmymath.a -o math -Wall</code>：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 staticLib<span class="token punctuation">]</span><span class="token comment"># gcc math.c libmymath.a -o math -Wall</span>math.c: 在函数‘main’中:math.c:6:2: 警告：隐式声明函数‘add’ <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>  printf<span class="token punctuation">(</span><span class="token string">"%d + %d = %d<span class="token entity" title="\n">\n</span>"</span>, a, b, add<span class="token punctuation">(</span>a, b<span class="token punctuation">))</span><span class="token punctuation">;</span>  ^math.c:7:2: 警告：隐式声明函数‘sub’ <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>  printf<span class="token punctuation">(</span><span class="token string">"%d - %d = %d<span class="token entity" title="\n">\n</span>"</span>, a, b, sub<span class="token punctuation">(</span>a, b<span class="token punctuation">))</span><span class="token punctuation">;</span>  ^math.c:8:2: 警告：隐式声明函数‘div’ <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>  printf<span class="token punctuation">(</span><span class="token string">"%d / %d = %d<span class="token entity" title="\n">\n</span>"</span>, a, b, div<span class="token punctuation">(</span>a, b<span class="token punctuation">))</span><span class="token punctuation">;</span>  ^<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>编译通过！并没有任何报错，只是在链接阶段若找不到名为add&#x2F;sub&#x2F;div的函数体则报错。</p><p>之所以编译不会报错，是因为C语言规定，<strong>对于没有声明&#x2F;定义的函数，自动使用隐式声明</strong>。相当于变成了如下代码：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token comment">//编译器的隐式声明:int function_name(int, ... parameter_type);</span><span class="token comment">//默认返回值为int类型，对函数参数不关心，若函数实际返回值为其他类型，则链接时报错</span><span class="token comment">//隐式声明的函数原型与库函数完全相同，则链接运行没有问题(如本例)</span><span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d + %d = %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d - %d = %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d / %d = %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token function">div</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="显示声明"><a href="#显示声明" class="headerlink" title="显示声明"></a>显示声明</h3><p>隐式声明给程序员带来了各种困惑，给程序的稳定性带来了非常坏的影响。一般使用显示声明，将函数定义&#x2F;声明放入头文件中，在程序中引入头文件：</p><p>头文件<code>mymath.h</code></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/* * 加入的三行：头文件守卫 *多个c程序都包含该头文件引用，编译时带来大量声明冲突 * 加入头文件首位：避免多次包含 * */</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_MYMATH_H_</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">_MYMATH_H_</span></span><span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">div</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>源程序<code>math.c</code></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"mymath.h"</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d + %d = %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d - %d = %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d / %d = %d\n"</span><span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token function">div</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240204171348932.png" alt="编译运行正常" style="zoom: 67%;" /><hr><h2 id="动态库"><a href="#动态库" class="headerlink" title="动态库"></a>动态库</h2><p>动态函数库在<strong>编译的时候，在程序里只有一个“指向”的位置而已</strong>，也就是说当可执行文件需要使用到函数库的机制时，程序才会去读取函数库来使用。<strong>应用于对时间要求低，空间要求高的程序中。</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240204093255920.png" alt="100个程序运行时共同使用1个500MB的共享库" style="zoom:35%;" /><ul><li>优点：可实现不同进程间的资源共享；动态库升级简单，只需要替换库文件，无需重新编译应用程序</li><li>缺点：加载速度比静态库慢；发布程序需要提供依赖的动态库</li></ul><h3 id="应用实例"><a href="#应用实例" class="headerlink" title="应用实例"></a>应用实例</h3><p>step1：对<code>add.c</code>和<code>sub.c</code>和<code>div.c</code>三个文件进行编译，得到3个<strong>可重定位目标文件(.o)</strong></p><blockquote><p><strong>注意：动态库所需的可重定位目标文件与静态库所需的可重定位目标文件不同！</strong></p><ul><li>静态库所用的<code>.o</code>文件中的调用函数地址：<strong>编译时生成(相对于main的相对寻址)</strong></li><li>动态库所用的<code>.o</code>文件中的调用函数地址：<strong>运行时生成！</strong></li></ul><p><strong>因此编译时需要加上参数：<code>-fPIC</code>!!!!</strong></p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 dymamicLib<span class="token punctuation">]</span><span class="token comment"># gcc -c add.c -o add.o -fPIC</span><span class="token punctuation">[</span>root@lhyEdu01 dymamicLib<span class="token punctuation">]</span><span class="token comment"># gcc -c sub.c -o sub.o -fPIC</span><span class="token punctuation">[</span>root@lhyEdu01 dymamicLib<span class="token punctuation">]</span><span class="token comment"># gcc -c div.c -o div.o -fPIC</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240204223416243.png" alt="查看结果：编译成功！" style="zoom:80%;" /><p>step2：<strong>使用<code>gcc -shared -o libxxx.so xxx.o xxx.o</code>制作动态库</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 dynamicLib<span class="token punctuation">]</span><span class="token comment"># gcc -shared -o libmymath.so add.o sub.o div.o</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240204224939797.png" alt="动态库libmymath.so制作成功" style="zoom:80%;" /><p>step3：编译可执行程序时，指定所用的动态库<code>gcc myth.c -o a.out -lmymath -L ./ 头文件 </code>。</p><blockquote><p><strong>-l：指定库名（libxxx.so的xxx是库名）</strong></p><p><strong>-L：指定库路径</strong></p></blockquote><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 dynamicLib<span class="token punctuation">]</span><span class="token comment"># gcc math.c -o math.out -lmymath -L./ mymath.h</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240204225104876.png" alt="编译成功:math.out"></p><p>step4：<code>math.out</code>运行…<strong>失败！</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240204225710207.png" alt="运行失败！！！"></p><blockquote><p><strong>下文分析运行失败原因</strong></p></blockquote><h3 id="原因：链接器-动态链接器"><a href="#原因：链接器-动态链接器" class="headerlink" title="原因：链接器&amp;动态链接器"></a>原因：链接器&amp;动态链接器</h3><blockquote><p><strong>链接器&amp;动态链接器的关系：张三和张三丰、雷锋和雷峰塔，没有关系</strong></p><ul><li><strong>链接器</strong>：工作于链接阶段，工作时需要 -l 和 -L</li><li><strong>动态链接器</strong>：工作于程序运行阶段，工作时需要提供动态库所在目录位置。<strong>通过改变环境变量：<code>export LD_LIBRARY_PATH=动态库所在路径</code>；或者动态库使用绝对路径</strong></li></ul></blockquote><p><strong>方法1：通过改变环境变量</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 dynamicLib<span class="token punctuation">]</span><span class="token comment"># export LD_LIBRARY_PATH=/unix/dynamicLib</span><span class="token comment">#注意：环境变量只是暂时生效，终端重启后失效！</span><span class="token comment">#永久改变需要更爱配置文件:vim ~/.bashrc</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240204231119298.png" alt="运行成功" style="zoom: 67%;" /><p><strong>方法2：动态库使用绝对路径</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240204232632451.png" alt="运行成功"></p><hr><h2 id="扩展讲解：程序的地址空间"><a href="#扩展讲解：程序的地址空间" class="headerlink" title="扩展讲解：程序的地址空间"></a>扩展讲解：程序的地址空间</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240205092822703.png" alt="程序的虚拟内存空间"></p><p><a href="https://aqua555552st.github.io/2024/02/04/chapter7%E2%80%94%E9%93%BE%E6%8E%A5/">细节请参考：chapter7—链接 | aqua555552st’s script</a></p><h3 id="代码演示"><a href="#代码演示" class="headerlink" title="代码演示"></a>代码演示</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span><span class="token keyword">int</span> init_val <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span><span class="token comment">//已初始化数据</span><span class="token keyword">int</span> uninit_val<span class="token punctuation">;</span><span class="token comment">//未初始化数据</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> env<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> s <span class="token operator">=</span> <span class="token string">"abcd"</span><span class="token punctuation">;</span><span class="token comment">//只读常量</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"代码区(.text):%p\n"</span><span class="token punctuation">,</span> main<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"只读常量区(.rodata):%p\n"</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"初始化数据(.data):%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>init_val<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"未初始化数据(.bss):%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>uninit_val<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token operator">*</span> p1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token operator">*</span> p2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token operator">*</span> p3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">int</span> <span class="token operator">*</span> p4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//堆区</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"heap addr(p1):%p\n"</span><span class="token punctuation">,</span> p1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"heap addr(p2):%p\n"</span><span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"heap addr(p3):%p\n"</span><span class="token punctuation">,</span> p3<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"heap addr(p4):%p\n"</span><span class="token punctuation">,</span> p4<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//栈区</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"stack addr(p1):%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"stack addr(p2):%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"stack addr(p3):%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>p3<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"stack addr(p4):%p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>p4<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//命令行参数地址</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"命令行参数地址:%p\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//环境变量地址</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"环境变量地址:%p\n"</span><span class="token punctuation">,</span> env<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240205101847459.png" alt="运行结果分析-结合程序的虚拟地址空间"></p>]]></content>
      
      
      <categories>
          
          <category> C语言 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> apue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>基于CentOS-7配置apue.h库文件</title>
      <link href="/2024/02/03/%E5%9F%BA%E4%BA%8ECentOS-7%E9%85%8D%E7%BD%AEapue-h%E5%BA%93%E6%96%87%E4%BB%B6/"/>
      <url>/2024/02/03/%E5%9F%BA%E4%BA%8ECentOS-7%E9%85%8D%E7%BD%AEapue-h%E5%BA%93%E6%96%87%E4%BB%B6/</url>
      
        <content type="html"><![CDATA[<h1 id="基于CentOS-7配置apue-h库文件"><a href="#基于CentOS-7配置apue-h库文件" class="headerlink" title="基于CentOS-7配置apue.h库文件"></a>基于CentOS-7配置apue.h库文件</h1><blockquote><p>在学习<strong>《UNIX环境高级编程》</strong>一书中，提供的代码用例需要先配置好书中提供的apue.h库文件后，才能正常运行。<strong>本文详细说明apue.h库文件的配置</strong>。</p></blockquote><h2 id="建立apue-h库文件的存放路径"><a href="#建立apue-h库文件的存放路径" class="headerlink" title="建立apue.h库文件的存放路径"></a>建立apue.h库文件的存放路径</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 /<span class="token punctuation">]</span><span class="token comment"># mkdir apue</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="创建文件夹"><a href="#创建文件夹" class="headerlink" title="创建文件夹"></a>创建文件夹</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 /<span class="token punctuation">]</span><span class="token comment"># cd apue/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="下载apue-h库文件"><a href="#下载apue-h库文件" class="headerlink" title="下载apue.h库文件"></a>下载apue.h库文件</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 apue<span class="token punctuation">]</span><span class="token comment"># http://www.apuebook.com/src.3e.tar.gz</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 apue<span class="token punctuation">]</span><span class="token comment"># tar -zxvf src.3e.tar.gz</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 apue<span class="token punctuation">]</span><span class="token comment"># ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240203185303773.png" alt="ls指令查看目录中的文件：解压成功"></p><h2 id="cd-到apue-3e目录下"><a href="#cd-到apue-3e目录下" class="headerlink" title="cd 到apue.3e目录下"></a>cd 到apue.3e目录下</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 apue<span class="token punctuation">]</span><span class="token comment"># cd apue.3e/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="CentOS-7下缺少相关的库，下载Fedora的资源进行安装："><a href="#CentOS-7下缺少相关的库，下载Fedora的资源进行安装：" class="headerlink" title="CentOS-7下缺少相关的库，下载Fedora的资源进行安装："></a>CentOS-7下缺少相关的库，下载Fedora的资源进行安装：</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 apue.3e<span class="token punctuation">]</span><span class="token comment"># yum install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="然后执行："><a href="#然后执行：" class="headerlink" title="然后执行："></a>然后执行：</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 apue.3e<span class="token punctuation">]</span><span class="token comment"># yum install libbsd libbsd-devel</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="执行make语句"><a href="#执行make语句" class="headerlink" title="执行make语句"></a>执行make语句</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 apue.3e<span class="token punctuation">]</span><span class="token comment"># make</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="把make生成的apue-h与静态链接库libapue-a放到系统指定寻找的地方"><a href="#把make生成的apue-h与静态链接库libapue-a放到系统指定寻找的地方" class="headerlink" title="把make生成的apue.h与静态链接库libapue.a放到系统指定寻找的地方"></a>把make生成的apue.h与静态链接库libapue.a放到系统指定寻找的地方</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 apue.3e<span class="token punctuation">]</span><span class="token comment"># cp ./include/apue.h /usr/include/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 apue.3e<span class="token punctuation">]</span><span class="token comment"># cp ./lib/libapue.a /usr/local/lib/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><p><strong>现在就可以使用《Unix环境高级编程》中的apue.h库了！！！下文提供测试用例</strong></p><hr><h2 id="测试用例"><a href="#测试用例" class="headerlink" title="测试用例"></a>测试用例</h2><p><strong>在根目录下创建<code>unix</code>目录，将apue学习过程中的测试用例和相关代码存放至此</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 apue.3e<span class="token punctuation">]</span><span class="token comment"># cd /</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 /<span class="token punctuation">]</span><span class="token comment"># mkdir unix</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>编写测试程序:<code>vim test.c</code>:</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 unix<span class="token punctuation">]</span><span class="token comment"># vim test.c</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>test.c程序：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"apue.h"</span></span><span class="token keyword">int</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">chdir</span><span class="token punctuation">(</span><span class="token string">"/tmp"</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>                <span class="token function">err_sys</span><span class="token punctuation">(</span><span class="token string">"chdir failed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"chdir to /tmp successed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>编译：</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 unix<span class="token punctuation">]</span><span class="token comment"># gcc test.c</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 unix<span class="token punctuation">]</span><span class="token comment"># ls</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240203190837564.png" alt="ls指令查看编译后结果"></p><p><strong>运行：</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token punctuation">[</span>root@lhyEdu01 unix<span class="token punctuation">]</span><span class="token comment"># ./a.out</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240203191426759.png" alt="执行成功！"></p><hr><p><strong>运行无异常，配置成功！</strong></p>]]></content>
      
      
      <categories>
          
          <category> 操作系统 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> apue </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1.5计算机网络的性能指标</title>
      <link href="/2024/02/03/1-5%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%9A%84%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87/"/>
      <url>/2024/02/03/1-5%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E7%9A%84%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87/</url>
      
        <content type="html"><![CDATA[<h1 id="1-5计算机网络的性能指标"><a href="#1-5计算机网络的性能指标" class="headerlink" title="1.5计算机网络的性能指标"></a>1.5计算机网络的性能指标</h1><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/89BB0CDA479AFB37D8D39F2352F32642.png" alt="img"></p><p>计算机网络的性能指标被用来**从不同方面&#x3D;&#x3D;度量计算机网络的性能&#x3D;&#x3D;**。</p><h2 id="1-5-1速率-b-s"><a href="#1-5-1速率-b-s" class="headerlink" title="1.5.1速率(b&#x2F;s)"></a>1.5.1速率(b&#x2F;s)</h2><blockquote><p>前置知识：</p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20230122162733246.png" alt="image-20230122162733246"></p></blockquote><p>&#x3D;&#x3D;<strong><code>速率:</code>数据的传送速率</strong>(每秒传送多少比特)，又称 **”数据率”<strong>，</strong>“比特率”**。&#x3D;&#x3D;</p><h3 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20230122163209554.png" alt="image-20230122163209554"></p><hr><h2 id="1-5-2带宽-b-s"><a href="#1-5-2带宽-b-s" class="headerlink" title="1.5.2带宽(b&#x2F;s)"></a>1.5.2带宽(b&#x2F;s)</h2><p><code>带宽(Hz)在模拟信号系统中的意义：</code>某个信号所包含的各种不同频率成分所占据的频率范围。</p><p>&#x3D;&#x3D;<strong><code>带宽(b/s)在计算机网络中的意义：</code><strong>网络的通信线路 <strong>传送数据的能力</strong>。(</strong>&#x3D;MAX IN{主机接口速率，线路速率，交换机&#x2F;路由器速录}</strong>)&#x3D;&#x3D;</p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20230122164104410.png" alt="image-20230122164104410"></p><hr><h2 id="1-5-3吞吐量-b-s"><a href="#1-5-3吞吐量-b-s" class="headerlink" title="1.5.3吞吐量(b&#x2F;s)"></a>1.5.3吞吐量(b&#x2F;s)</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20230122164756547.png" alt="image-20230122164756547"></p><p>&#x3D;&#x3D;<strong><code>吞吐量：</code>单位时间内</strong>，通过网络或接口的 <strong>总数据量</strong>（$&lt;&#x3D;带宽$）&#x3D;&#x3D;</p><hr><h2 id="1-5-4时延"><a href="#1-5-4时延" class="headerlink" title="1.5.4时延"></a>1.5.4时延</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/AEB34CC0FFE61504D5F570E4094AE08F.png" alt="img"></p><p>&#x3D;&#x3D;<strong><code>时延：</code><strong>数据(1或n个分组) 从</strong>网络一端到另一端所用时间 (4部分构成)</strong>&#x3D;&#x3D;</p><h3 id="发送时延"><a href="#发送时延" class="headerlink" title="发送时延"></a>发送时延</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/271CD7C5ED082307D02EA1E67C751696.png" alt="img"></p><p><strong>主机&#x2F;路由器 <u>发送分组</u>耗费时间</strong>。从第一个比特发送开始到最后一个比特发送完毕所用时间。</p><p>​$公式:发送时延t_发 &#x3D; \frac{分组长度(b)}{发送速率(b&#x2F;s)} \quad$</p><h3 id="传播时延"><a href="#传播时延" class="headerlink" title="传播时延"></a>传播时延</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/18620FEE0A5D0CF8FCA0EF70A22A4972.png" alt="img"></p><p>电磁波在 <strong><u>数据链路上传播</u> 耗费的时间</strong></p><p>​$公式:传播时延t_传 &#x3D; \frac{链路长度(m)}{链路上的传播速率(m&#x2F;s)} \quad$</p><h3 id="处理时延"><a href="#处理时延" class="headerlink" title="处理时延"></a>处理时延</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/8AFF626A14CB2D47326DA52106E86BD9-1674378695281-6.png" alt="img"></p><p><strong><u>路由器</u></strong> “<strong>检查分组的首部是否误码、提取分组首部中的目的地址、为分组查找相应的转发接口以及修改分组首部中的部分内容（例如生存时间）</strong>“ 等耗费的时间。</p><p><strong>处理时延一般无法用一个简单的公式进行计算。</strong></p><h3 id="排队时延"><a href="#排队时延" class="headerlink" title="排队时延"></a>排队时延</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/8AFF626A14CB2D47326DA52106E86BD9.png" alt="img"></p><p>分组**<u>在路由器</u><strong>确定了分组的转发接口后，</strong>在输出队列中排队缓存并等待转发**所耗费的时间。</p><p><strong>排队时延一般无法用一个简单的公式进行计算。</strong></p><h3 id="推广结论"><a href="#推广结论" class="headerlink" title="&#x3D;&#x3D;推广结论&#x3D;&#x3D;"></a>&#x3D;&#x3D;推广结论&#x3D;&#x3D;</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/85BA4992905C2F0F1360C75659DEF5E3.png" alt="img"></p><p>由上图☝️归纳总结，网络两端通过$n$个路由器，转发$m$个分组消耗的<strong>总时延</strong>为多少？</p><p>​$总时延 &#x3D; m * t_发 + n * t_发 + (n + 1) * t_传$</p><p>​&#x3D;&#x3D;$&#x3D; (m + n) * t_发 + (n + 1) * t_传$&#x3D;&#x3D;</p><h4 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h4><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/D4BC64C6B4FD2564D2C20A61C9A44790.png" alt="img"></p><hr><h2 id="1-5-5时延带宽积-b"><a href="#1-5-5时延带宽积-b" class="headerlink" title="1.5.5时延带宽积(b)"></a>1.5.5时延带宽积(b)</h2><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/4343A07F829D8C8F66959E6EE4419230.png" alt="img" style="zoom: 25%;" /><p>&#x3D;&#x3D;**<code>时延带宽积:</code>传播时延(s) * 带宽(b&#x2F;s)**。又称为”<strong>以比特为单位的链路长度</strong>“。&#x3D;&#x3D;</p><hr><h2 id="1-5-6往返时间RTT"><a href="#1-5-6往返时间RTT" class="headerlink" title="1.5.6往返时间RTT"></a>1.5.6往返时间RTT</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/7EF992825B00E03A72765C5F71D543FF.png" alt="img"></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20230122180423074.png" alt="image-20230122180423074"></p><p>&#x3D;&#x3D;<strong><code>往返时间：</code>发送端发送数据分组</strong>开始，到发送端<strong>又接收到确认分组</strong>为止，共耗费的时间。($&#x3D;传播时延 * 2$)&#x3D;&#x3D;</p><hr><h2 id="1-5-7利用率"><a href="#1-5-7利用率" class="headerlink" title="1.5.7利用率"></a>1.5.7利用率</h2><p>​&#x3D;&#x3D;$$ 利用率&#x3D;\begin{cases}<br>信道利用率：\frac{有数据通过时间t}{(有+无) 数据通过时间t} \quad \<br>网络利用率：全网络的信道利用率的加权平均<br>\end{cases}$$&#x3D;&#x3D;</p><blockquote><p><strong>注意</strong>：信道利用率 <strong>并非越高越好！</strong></p><p>解释：根据排队论：<strong>信道利用率$U$越高，该信道引起的时延$D$也会迅速增加</strong></p><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/8746B666B4014D79A01A252F6C1F7A65.png" alt="img"></p></blockquote><hr><h2 id="1-5-8丢包率"><a href="#1-5-8丢包率" class="headerlink" title="1.5.8丢包率"></a>1.5.8丢包率</h2><p>&#x3D;&#x3D;<strong><code>丢包率：</code><strong>在一定的时间范围内，传输过程中</strong>丢失的分组数量</strong>与<strong>总分组数量</strong>的<strong>比例</strong>(反应网络拥塞情况)。&#x3D;&#x3D;具体可分为接口丢包率、节点丢包率、链路丢包率、路径丢包率以及网络丢包率等。</p><h3 id="分组丢失的两种情况"><a href="#分组丢失的两种情况" class="headerlink" title="分组丢失的两种情况"></a>分组丢失的两种情况</h3><ol><li>产生<strong>误码</strong>，被路由器丢弃</li><li>分组到达一台队列已满的分组交换机时，被交换机丢弃；在通信量较大时可能造成<strong>网络拥塞</strong>。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 计算机网络 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>gcc—工具链</title>
      <link href="/2024/02/02/gcc%E2%80%94%E5%B7%A5%E5%85%B7%E9%93%BE/"/>
      <url>/2024/02/02/gcc%E2%80%94%E5%B7%A5%E5%85%B7%E9%93%BE/</url>
      
        <content type="html"><![CDATA[<h1 id="gcc工具链"><a href="#gcc工具链" class="headerlink" title="gcc工具链"></a>gcc工具链</h1><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20240202000746320.png" alt="目录结构"></p><h2 id="一、gcc四步骤"><a href="#一、gcc四步骤" class="headerlink" title="一、gcc四步骤"></a>一、gcc四步骤</h2><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/C9577FD85681FA27D4706612B317E577.png" alt="gcc4部操作"></p><h3 id="1-预处理"><a href="#1-预处理" class="headerlink" title="1.预处理"></a>1.预处理</h3><p>预处理器处理C语言源代码，<strong>扫描程序中所有的#开头的预编译指令，并将它们替换成相应的文本</strong>。预编译指令可以包括头文件包含、条件编译等等。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">gcc <span class="token operator">-</span>E hello<span class="token punctuation">.</span>c <span class="token operator">-</span>o hello<span class="token punctuation">.</span>i<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-编译"><a href="#2-编译" class="headerlink" title="2.编译"></a>2.编译</h3><blockquote><p><strong>消耗时间和系统资源最多</strong></p></blockquote><p>编译器将预处理器处理后的代码<strong>转换成汇编代码</strong>。它会对代码进行语法和语义分析，检查程序的语法错误和类型错误，并生成汇编代码</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">gcc <span class="token operator">-</span>S hello<span class="token punctuation">.</span>i <span class="token operator">-</span>o hello<span class="token punctuation">.</span>s<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-汇编"><a href="#3-汇编" class="headerlink" title="3.汇编"></a>3.汇编</h3><p>汇编器将汇编代码转换成机器码。它会将<strong>汇编代码转换为可执行代码</strong>，同时还会生成调试信息和符号表。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">gcc <span class="token operator">-</span>c hello<span class="token punctuation">.</span>s <span class="token operator">-</span>o hello<span class="token punctuation">.</span>o<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="4-链接"><a href="#4-链接" class="headerlink" title="4.链接"></a>4.链接</h3><p>链接器将编译器生成的目标代码以及可能的库文件合并成最终的可执行文件。链接器<strong>将所有代码段和数据段链接起来，解析所有的符号引用，将地址回填。生成可执行文件</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c">gcc hello<span class="token punctuation">.</span>o <span class="token operator">-</span>o hello<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="二、gcc编译常用参数"><a href="#二、gcc编译常用参数" class="headerlink" title="二、gcc编译常用参数"></a>二、gcc编译常用参数</h2><h3 id="1-头文件跨目录依赖"><a href="#1-头文件跨目录依赖" class="headerlink" title="1.头文件跨目录依赖"></a>1.头文件跨目录依赖</h3><p><strong>源文件与头文件不在同一个目录下</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20231228150656571.png" alt="当前目录结构"  /><pre class="line-numbers language-c" data-language="c"><code class="language-c">gcc <span class="token operator">-</span>I<span class="token punctuation">.</span><span class="token operator">/</span>newdir<span class="token operator">/</span> gcctest<span class="token punctuation">.</span>c <span class="token operator">-</span>o gcctest <span class="token comment">//-I后面表示头文件所在路径(绝对/相对)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="2-只做预处理-编译-汇编"><a href="#2-只做预处理-编译-汇编" class="headerlink" title="2.只做预处理+编译+汇编"></a>2.只做预处理+编译+汇编</h3><p><em><em>得到</em>.o的二进制文件</em>*</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">gcc <span class="token operator">-</span>c gcctest <span class="token operator">-</span>o gcctest<span class="token punctuation">.</span>o<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="3-编译时添加调试语句"><a href="#3-编译时添加调试语句" class="headerlink" title="3.编译时添加调试语句"></a>3.编译时添加调试语句</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c">gcc <span class="token operator">-</span>g gcctest<span class="token punctuation">.</span>c <span class="token operator">-</span>o gcctest2<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>显然，编译出来的可执行文件大小变大了，多了可调试文件在内</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20231228152301962.png" alt="添加调试语句-文件变大" style="zoom:67%;" /><hr><h2 id="三、csapp—chapter7-链接"><a href="#三、csapp—chapter7-链接" class="headerlink" title="三、csapp—chapter7:链接"></a>三、csapp—chapter7:链接</h2><p>已知一个main.c文件</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"> <span class="token number">1</span> #include<span class="token operator">&lt;</span>stdio<span class="token punctuation">.</span>h<span class="token operator">></span> <span class="token number">2</span> <span class="token comment">//count和value两个全局变量</span> <span class="token number">3</span> <span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token number">4</span> <span class="token keyword">int</span> value<span class="token punctuation">;</span> <span class="token number">5</span>  <span class="token number">6</span> <span class="token keyword">void</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token keyword">int</span> sum<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token number">7</span>         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sum is:%d\n"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token number">8</span> <span class="token punctuation">&#125;</span> <span class="token number">9</span> <span class="token number">10</span><span class="token number">11</span> <span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token number">12</span>         <span class="token keyword">static</span> <span class="token keyword">int</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token number">13</span>         <span class="token keyword">static</span> <span class="token keyword">int</span> b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token number">14</span>         <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token number">15</span> <span class="token number">16</span>         <span class="token function">func</span><span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token number">17</span>         <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token number">18</span> <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过<code>gcc -c main.c</code>得到可重定位二进制文件，再根据<code>wc -c main.o</code>查看main.o文件的大小</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># gcc <span class="token operator">-</span>c main<span class="token punctuation">.</span>c<span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># wc <span class="token operator">-</span>c main<span class="token punctuation">.</span>o<span class="token number">1856</span> main<span class="token punctuation">.</span>o<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>使用<code>readelf -h main.o</code>查看ELF可重定位目标文件的ELF头(ELF Header)的具体内容</p><pre class="line-numbers language-c" data-language="c"><code class="language-c">readelf <span class="token operator">-</span>h main<span class="token punctuation">.</span>o<span class="token comment">//-h：只显示ELF Header的信息</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># readelf <span class="token operator">-</span>h main<span class="token punctuation">.</span>oELF 头：  Magic：  <span class="token number">7f</span> <span class="token number">45</span> <span class="token number">4</span>c <span class="token number">46</span> <span class="token number">02</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>   类别<span class="token operator">:</span>                              ELF64  数据<span class="token operator">:</span>                              <span class="token number">2</span> 补码，小端序 <span class="token punctuation">(</span>little endian<span class="token punctuation">)</span>  版本<span class="token operator">:</span>                              <span class="token number">1</span> <span class="token punctuation">(</span>current<span class="token punctuation">)</span>  OS<span class="token operator">/</span>ABI<span class="token operator">:</span>                            UNIX <span class="token operator">-</span> System V  ABI 版本<span class="token operator">:</span>                          <span class="token number">0</span>  类型<span class="token operator">:</span>                              <span class="token function">REL</span> <span class="token punctuation">(</span>可重定位文件<span class="token punctuation">)</span>  系统架构<span class="token operator">:</span>                          Advanced Micro Devices X86<span class="token operator">-</span><span class="token number">64</span>  版本<span class="token operator">:</span>                              <span class="token number">0x1</span>  入口点地址：              <span class="token number">0x0</span>  程序头起点：              <span class="token number">0</span> <span class="token punctuation">(</span>bytes into file<span class="token punctuation">)</span>  Start of section headers<span class="token operator">:</span>          <span class="token number">1024</span> <span class="token punctuation">(</span>bytes into file<span class="token punctuation">)</span>  标志：             <span class="token number">0x0</span>  本头的大小：       <span class="token number">64</span> <span class="token punctuation">(</span>字节<span class="token punctuation">)</span>  程序头大小：       <span class="token number">0</span> <span class="token punctuation">(</span>字节<span class="token punctuation">)</span>  Number of program headers<span class="token operator">:</span>         <span class="token number">0</span>  节头大小：         <span class="token number">64</span> <span class="token punctuation">(</span>字节<span class="token punctuation">)</span>  节头数量：         <span class="token number">13</span>  字符串表索引节头： <span class="token number">12</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-可重定位目标文件-ELF文件"><a href="#1-可重定位目标文件-ELF文件" class="headerlink" title="1.可重定位目标文件(ELF文件)"></a>1.可重定位目标文件(ELF文件)</h3><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20231228190228140.png" alt="ELF文件"></p><h3 id="2-section-节-的具体内容"><a href="#2-section-节-的具体内容" class="headerlink" title="2.section(节)的具体内容"></a>2.section(节)的具体内容</h3><ol><li><strong><code>.text</code>：已编译程序的及其代码</strong></li><li><strong><code>.rodata</code>：只读数据，如：prinf函数内的格式串</strong></li><li><strong><code>.data</code>：<u>已初始化</u>的全局和静态C变量</strong></li><li><strong><code>.bss(Better Save Space)</code>：<u>未初始化</u>的全局和静态C变量</strong></li><li><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20231228191717559.png" style="zoom: 33%;" /></li></ol><h3 id="3-符号-符号表-symtab）"><a href="#3-符号-符号表-symtab）" class="headerlink" title="3.符号&amp;符号表(.symtab）"></a>3.符号&amp;符号表(.symtab）</h3><p><strong>对于每一个可重定位目标文件(ELF)m，都有一个符号表(.symtab节中)。在链接器的上下文中，有三种不同的符号：</strong></p><ol><li><strong><code>全局符号(Global Symbols)</code>：模块m定义+能被其他模块引用</strong></li><li><strong><code>外部符号(Externals Symbols)</code>：其他模块定义+能被模块m引用</strong></li><li><strong><code>局部符号(Local Symbols)</code>：只被模块m定义+其他模块不能引用。如：任何带有static修饰的全局变量或函数 都是模块私有的，其他模块不能访问，类似Java的private关键字</strong></li></ol><blockquote><p><strong>注：</strong>.symtab节的符号表不包含<strong>本地非静态局部变量</strong>，因为其在<strong>栈中被管理</strong>！</p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># readelf <span class="token operator">-</span>s main<span class="token punctuation">.</span>oSymbol table <span class="token char">'.symtab'</span> contains <span class="token number">16</span> entries<span class="token operator">:</span>   Num<span class="token operator">:</span>    Value          Size Type    Bind   Vis      Ndx Name     <span class="token number">0</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> NOTYPE  LOCAL  DEFAULT  UND      <span class="token number">1</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> FILE    LOCAL  DEFAULT  ABS main<span class="token punctuation">.</span>c     <span class="token number">2</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> SECTION LOCAL  DEFAULT    <span class="token number">1</span>      <span class="token number">3</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> SECTION LOCAL  DEFAULT    <span class="token number">3</span>      <span class="token number">4</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> SECTION LOCAL  DEFAULT    <span class="token number">4</span>      <span class="token number">5</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> SECTION LOCAL  DEFAULT    <span class="token number">5</span>      <span class="token number">6</span><span class="token operator">:</span> <span class="token number">0000000000000004</span>     <span class="token number">4</span> OBJECT  LOCAL  DEFAULT    <span class="token number">3</span> a<span class="token punctuation">.</span><span class="token number">2185</span>     <span class="token number">7</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">4</span> OBJECT  LOCAL  DEFAULT    <span class="token number">4</span> b<span class="token punctuation">.</span><span class="token number">2186</span>     <span class="token number">8</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> SECTION LOCAL  DEFAULT    <span class="token number">7</span>      <span class="token number">9</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> SECTION LOCAL  DEFAULT    <span class="token number">8</span>     <span class="token number">10</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> SECTION LOCAL  DEFAULT    <span class="token number">6</span>     <span class="token number">11</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">4</span> OBJECT  GLOBAL DEFAULT    <span class="token number">3</span> count    <span class="token number">12</span><span class="token operator">:</span> <span class="token number">0000000000000004</span>     <span class="token number">4</span> OBJECT  GLOBAL DEFAULT  COM value    <span class="token number">13</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>    <span class="token number">33</span> FUNC    GLOBAL DEFAULT    <span class="token number">1</span> func    <span class="token number">14</span><span class="token operator">:</span> <span class="token number">0000000000000000</span>     <span class="token number">0</span> NOTYPE  GLOBAL DEFAULT  UND printf    <span class="token number">15</span><span class="token operator">:</span> <span class="token number">0000000000000021</span>    <span class="token number">55</span> FUNC    GLOBAL DEFAULT    <span class="token number">1</span> main<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>Type：FUNC-函数、OBJECT-变量数组等数据对象</p><p>Value：表示函数相对于.text section起始位置的偏移量</p><p>Bind：作用范围。局部&#x2F;全局</p><p>Ndx：表示节头部表的section的数组索引。如：Ndx&#x3D;1表示在.text节；Ndx&#x3D;3表示在.data节</p><blockquote><p>Ndx表示中有<strong>3个伪节：</strong></p></blockquote><blockquote><ul><li><strong><code>ABS</code>：不该被重定位的符号</strong></li><li><strong><code>UNDEF</code>：未定义的符号</strong></li><li><strong><code>COMMON</code>：未被分配位置的初始化的数据目标</strong></li></ul></blockquote><blockquote><p><strong>注意：变量count和value属于不同section的原因：count初始化了，value没有初始化</strong></p></blockquote><blockquote><p><strong>COMMON：未初始化的全局变量；.bss节：未初始化的静态变量+初始化为0的静态&#x2F;全局变量</strong></p></blockquote></blockquote><h3 id="4-符号解析"><a href="#4-符号解析" class="headerlink" title="4.符号解析"></a>4.符号解析</h3><p>对以下源文件进行编译linkerror.c进行编译汇编，生成二进制文件linkerror.o。</p><p>其中，该代码<strong>仅对函数foo进行声明</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>gcc -c linkerror.c </code>，编译可以通过！<font size=3 color=red>当编译器遇到一个不是在当前模块定义的符号(变量&#x2F;函数名)时，会假设该符号是在在其他模块在定义的。</font></p><p><font size=3 color=red>但是链接器(ld)无法解析对foo的引用时，就会终止！</font></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># gcc <span class="token operator">-</span>Wall <span class="token operator">-</span>Og <span class="token operator">-</span>o linkerror linkerror<span class="token punctuation">.</span>c<span class="token operator">/</span>tmp<span class="token operator">/</span>cc5EcYAf<span class="token punctuation">.</span>o：在函数‘main’中：linkerror<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token number">0x5</span><span class="token punctuation">)</span>：对‘foo’未定义的引用collect2<span class="token operator">:</span> 错误：ld 返回 <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><font size=4 color=red>引出问题：”全局符号”在多个可重定位目标文件中【同名定义】，如何处理？</font></p><p><strong>编译时，编译器向汇编器输出每个全局符号的类型：</strong></p><ul><li><strong><code>Strong symbols(强符号)</code>：函数和已初始化的全局变量</strong></li><li><strong><code>Weak symbols(弱符号)</code>：未初始化的全局变量</strong></li></ul><p><strong>汇编时，汇编器将强弱信息隐含地编码在ELF的符号表(.symtab)里</strong></p><p><strong>链接时，链接器根据以下3种情况处理多重定义的全局符号：</strong></p><ol><li><p><strong>规则1：不允许有多个同名的强符号</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/*foo1.c*/</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*bar1.c*/</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># gcc foo1<span class="token punctuation">.</span>c bar1<span class="token punctuation">.</span>c<span class="token operator">/</span>tmp<span class="token operator">/</span>ccSHeCo9<span class="token punctuation">.</span>o：在函数‘main’中：bar1<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token number">0x0</span><span class="token punctuation">)</span><span class="token operator">:</span> main 的多重定义<span class="token operator">/</span>tmp<span class="token operator">/</span>ccnLYE7L<span class="token punctuation">.</span>o<span class="token operator">:</span>foo1<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token number">0x0</span><span class="token punctuation">)</span>：第一次在此定义collect2<span class="token operator">:</span> 错误：ld 返回 <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p><strong>规则2：一个强符号与多个弱符号同名，那么选择强符号</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/*foo2.c*/</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">15213</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"x = %d\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*bar2.c*/</span><span class="token keyword">int</span> x<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        x <span class="token operator">=</span> <span class="token number">15212</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># gcc foo2<span class="token punctuation">.</span>c bar2<span class="token punctuation">.</span>c<span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># <span class="token punctuation">.</span><span class="token operator">/</span>a<span class="token punctuation">.</span>outx <span class="token operator">=</span> <span class="token number">15212</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>函数f将x的值由15213改为15212。一个模块(bar2.c)里的x未初始化(弱符号)，链接器会安静地选择其他模块(foo2.c)里定义的强符号</p></li><li><p><strong>规则3：如果有多个弱符号同名，任意选择一个</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/*foo3.c*/</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">15212</span><span class="token punctuation">;</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">15213</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"x = 0x%x y = 0x%x\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*bar3.c*/</span><span class="token keyword">double</span> x<span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># gcc foo3<span class="token punctuation">.</span>c bar3<span class="token punctuation">.</span>c<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>ld<span class="token operator">:</span> Warning<span class="token operator">:</span> alignment <span class="token number">4</span> of symbol `x' in <span class="token operator">/</span>tmp<span class="token operator">/</span>ccWPcPGG<span class="token punctuation">.</span>o is smaller than <span class="token number">8</span> in <span class="token operator">/</span>tmp<span class="token operator">/</span>cc3MhEaU<span class="token punctuation">.</span>o<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></li></ol><h4 id="静态库-static-library"><a href="#静态库-static-library" class="headerlink" title="静态库(static library)"></a>静态库(static library)</h4><p>在共享库出现之前，<strong>公用功能(atoi&#x2F;printf&#x2F;scanf&#x2F;strcpy&#x2F;rand等)<strong>是以</strong>静态库</strong>的形式存在的，它把<strong>通用功能模块的多个目标文件打包在一起形成<code>*.a</code>的文件(如libc.a)<strong>，用到它的程序只需要在链接时指定这个库文件，</strong>链接器就会从这个库中抽取出用到的功能代码拷贝到目标程序中</strong>，而不需要每次都对这些通用功能代码重新编译。</p><p><strong>对文件<em>addvec.c</em>和<em>multvec.c</em>进行编译<code>gcc -c addvec.c multvec.c</code>，得到目标模块</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> addcnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">addvec</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span> z<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> i<span class="token punctuation">;</span>                addcnt<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> multcnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">multvec</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span> z<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> i<span class="token punctuation">;</span>                multcnt<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                z<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> y<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>使用<code>AR工具</code>将两个目标模块<em>addvec.o multvec.o</em>打包成静态库(<code>ar rcs libxxx.a xxx.o xxx.o</code>)</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># ar rcs linvector<span class="token punctuation">.</span>a addvec<span class="token punctuation">.</span>o multvec<span class="token punctuation">.</span>o<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>以main2.c文件为例</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"vector.h"</span></span><span class="token keyword">int</span> x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">int</span> y<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">int</span> z<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token function">addvec</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> z<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"z = [%d %d]\n"</span><span class="token punctuation">,</span> z<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> z<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中”vector.h”中包含对addvec函数的声明：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">addvec</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> <span class="token operator">*</span> z<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>编译和链接输入文件main2.o和libvector.a</strong></p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/1125E426BCF8DCF854B292C45FC50D8A.jpg" style="zoom:20%;" /><blockquote><p><strong>链接器判断main2.o引用了addvec.o定义的addvec符号，所以复制addvec.o到可执行文件。</strong></p><p><strong>因为程序未引用multvec.0定义的符号，所以链接器就不会复制这个模块到可执行文件。</strong></p><p><strong>此外，链接器还会复制libc.a中的printf.o等C系统运行时的其他模块。</strong></p></blockquote><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># gcc <span class="token operator">-</span>c main2<span class="token punctuation">.</span>c<span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># gcc <span class="token operator">-</span><span class="token keyword">static</span> <span class="token operator">-</span>o prog2c main2<span class="token punctuation">.</span>o <span class="token punctuation">.</span><span class="token operator">/</span>libvector<span class="token punctuation">.</span>a<span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># <span class="token punctuation">.</span><span class="token operator">/</span>prog2c z <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">4</span> <span class="token number">6</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-重定位"><a href="#5-重定位" class="headerlink" title="5.重定位"></a>5.重定位</h3><p>当汇编器生成一个目标模块时，它并不知道数据和代码最终将放在内存中的什么位置。也不知道本模块引用的外部定义函数或全局变量的最终位置。</p><p><strong><font size=3 color=red>因此，汇编器遇到对最终位置未知的目标引用，就会生成一个【重定位条目】，告诉链接器再将目标文件合并为可执行文件时如何修改这个引用。</font></strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/*重定位条目-数据结构*/</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span><span class="token keyword">long</span> offset<span class="token punctuation">;</span><span class="token comment">//被修改的引用的节偏移量</span><span class="token keyword">long</span> type<span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token comment">//告知链接器如何修改新的引用</span>    <span class="token comment">//主要两种：1.R_X86_64_PC32(PC相对地址)2.R_X86_64_32(绝对地址)</span>symbol<span class="token operator">:</span><span class="token number">32</span><span class="token punctuation">;</span><span class="token comment">//表示被修改的引用是哪个符号</span><span class="token keyword">long</span> addend<span class="token punctuation">;</span><span class="token comment">//有符号数，一些类型的重定位要使用它对被修改引用的值做偏移调整(指令长度)</span><span class="token punctuation">&#125;</span> ELF_Rela<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p><strong>代码的重定位条目存放在<code>.rel.text</code>中</strong></p><p><strong>已初始化数据的重定位条目存放在<code>.rel.data</code>中</strong></p></blockquote><h4 id="重定位算法"><a href="#重定位算法" class="headerlink" title="重定位算法"></a>重定位算法</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c">foreach section s <span class="token punctuation">&#123;</span>foreach relocation entry r <span class="token punctuation">&#123;</span>refptr <span class="token operator">=</span> s <span class="token operator">+</span> r<span class="token punctuation">.</span>offset<span class="token punctuation">;</span><span class="token comment">/*1.重定位PC相对引用*/</span><span class="token keyword">if</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>type <span class="token operator">==</span> R_X86_64_PC32<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>refaddr <span class="token operator">=</span> <span class="token function">ADDR</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>offset<span class="token punctuation">;</span><span class="token comment">/*refaddr:引用的运行时地址*/</span><span class="token operator">*</span>refptr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">ADDR</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>symbol<span class="token punctuation">)</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>addend <span class="token operator">-</span> refaddr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token comment">/*2.重定位绝对引用*/</span><span class="token keyword">if</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>type <span class="token operator">==</span> R_X86_64_32<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token operator">*</span>refptr <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">ADDR</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>symbol<span class="token punctuation">)</span> <span class="token operator">+</span> r<span class="token punctuation">.</span>addend<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="①重定位PC相对引用"><a href="#①重定位PC相对引用" class="headerlink" title="①重定位PC相对引用"></a>①重定位PC相对引用</h4><p><strong>例：对源文件<em>main.c</em>和<em>sum.c</em>进行反汇编：</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">int</span> array<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> val <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>array<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span> a<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">int</span> i<span class="token punctuation">,</span> s <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                s <span class="token operator">+=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>再用<code>objdump -dx main.o</code>对main,o进行反编译后结果：</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">[</span>root@lhyEdu01 link<span class="token punctuation">]</span># objdump <span class="token operator">-</span>dx main<span class="token punctuation">.</span>o<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/image-20231229213448474.png" style="zoom: 50%;" /><p><strong>函数main调用sum函数，sum函数是在sum.o模块中定义的，sum的重定位条目为：</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c">r<span class="token punctuation">,</span>offset <span class="token operator">=</span> <span class="token number">0xf</span>r<span class="token punctuation">.</span>symbol <span class="token operator">=</span> sumr<span class="token punctuation">.</span>type   <span class="token operator">=</span> R_X86_64_PC32r<span class="token punctuation">.</span>addend <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong><u>这些字段告诉链接器修改开始于0xf处的32位PC相对引用，这样在运行时它会指向sum例程</u>。假设链接器已确定：</strong></p><ul><li><strong><code>ADDR(s) = ADDR(.text)</code> &#x3D; 0x400d0</strong></li><li><strong><code>ADDR(r.symbol) = ADDR(sum)</code> &#x3D; 0x400e8</strong></li></ul><p><strong>使用<code>重定位算法</code>知：</strong></p><ol><li><p><strong>链接器首先算出引用的<u>运行时地址</u>：</strong></p><p><strong>ref_addr &#x3D; ADDR(s) + r.offset &#x3D; 0x4004d0 + 0xf &#x3D; 0x4004df</strong> </p></li><li><p><strong>然后更新该引用，使得它再运行时指向sum程序(实际就是求PC的offset)</strong></p><p><strong>ref_ptr &#x3D; ADDR(sum) - ref_addr + r.addend &#x3D; 0x4004e8 - 0x4004df +(-4) &#x3D; 0x5</strong></p></li></ol><p>得到的可执行文件中，call指令由如下形式：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token number">4004</span>de<span class="token operator">:</span>e8 <span class="token number">05</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span>       callq  <span class="token number">4004e8</span> <span class="token operator">&lt;</span>sum<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="②重定位绝对引用"><a href="#②重定位绝对引用" class="headerlink" title="②重定位绝对引用"></a>②重定位绝对引用</h4><p><strong>mov指令将array地址(32位立即数)复制到寄存器%edi中，sum函数是在sum.o模块中定义的，sum的重定位条目为：</strong></p><pre class="line-numbers language-c" data-language="c"><code class="language-c">r<span class="token punctuation">,</span>offset <span class="token operator">=</span> <span class="token number">0xa</span>r<span class="token punctuation">.</span>symbol <span class="token operator">=</span> arrayr<span class="token punctuation">.</span>type   <span class="token operator">=</span> R_X86_64_32r<span class="token punctuation">.</span>addend <span class="token operator">=</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这些字段告诉链接器修改开始于0xa处的32位绝对引用，这样在运行时它会指向array的第一个字节。假设链接器已确定：</p><ul><li><strong><code>ADDR(r.symbol) = ADDR(array)</code> &#x3D; 0x601018</strong></li></ul><p>链接器修改第13行的引用：</p><p>*<strong>ref_ptr &#x3D; (unsigned) ((ADDR(r.symbol) + r.addend)) &#x3D; (unsigned) (0x601018 + 0) &#x3D; 0x601018</strong></p><p>得到的可执行文件中，机器指令由如下形式：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token number">4004</span>d9<span class="token operator">:</span>bf <span class="token number">18</span> <span class="token number">10</span> <span class="token number">60</span> <span class="token number">00</span>       mov $<span class="token number">0x601018</span><span class="token punctuation">,</span> <span class="token operator">%</span>edi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://typora-lhy-cs.oss-cn-nanjing.aliyuncs.com/D0D016AAD0F392AC3C3FFCEFEFAA42CC.jpg"></p><h3 id="6-可执行目标文件-加载过程"><a href="#6-可执行目标文件-加载过程" class="headerlink" title="6.可执行目标文件&amp;加载过程"></a>6.可执行目标文件&amp;加载过程</h3>]]></content>
      
      
      <categories>
          
          <category> C语言 </category>
          
      </categories>
      
      
    </entry>
    
    
  
  
</search>
